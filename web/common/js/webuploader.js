(function(e,t){var r={},n=function(e,t){var r,n,i;if(typeof e==="string"){return s(e)}else{r=[];for(n=e.length,i=0;i<n;i++){r.push(s(e[i]))}return t.apply(null,r)}},i=function(e,t,r){if(arguments.length===2){r=t;t=null}n(t||[],function(){a(e,r,arguments)})},a=function(e,t,i){var a={exports:t},s;if(typeof t==="function"){i.length||(i=[n,a.exports,a]);s=t.apply(null,i);s!==undefined&&(a.exports=s)}r[e]=a.exports},s=function(t){var n=r[t]||e[t];if(!n){throw new Error("`"+t+"` is undefined")}return n},o=function(e){var t,n,i,a,s,o;o=function(e){return e&&e.charAt(0).toUpperCase()+e.substr(1)};for(t in r){n=e;if(!r.hasOwnProperty(t)){continue}i=t.split("/");s=o(i.pop());while(a=o(i.shift())){n[a]=n[a]||{};n=n[a]}n[s]=r[t]}return e},u=function(r){e.__dollar=r;return o(t(e,i,n))},f;if(typeof module==="object"&&typeof module.exports==="object"){module.exports=u()}else if(typeof define==="function"&&define.amd){define(["jquery"],u)}else{f=e.WebUploader;e.WebUploader=u();e.WebUploader.noConflict=function(){e.WebUploader=f}}})(window,function(e,t,r){t("dollar-third",[],function(){var t=e.__dollar||e.jQuery||e.Zepto;if(!t){throw new Error("jQuery or Zepto not found!")}return t});t("dollar",["dollar-third"],function(e){return e});t("promise-third",["dollar"],function(e){return{Deferred:e.Deferred,when:e.when,isPromise:function(e){return e&&typeof e.then==="function"}}});t("promise",["promise-third"],function(e){return e});t("base",["dollar","promise"],function(t,r){var n=function(){},i=Function.call;function a(e){return function(){return i.apply(e,arguments)}}function s(e,t){return function(){return e.apply(t,arguments)}}function o(e){var t;if(Object.create){return Object.create(e)}else{t=function(){};t.prototype=e;return new t}}return{version:"0.1.5",$:t,Deferred:r.Deferred,isPromise:r.isPromise,when:r.when,browser:function(e){var t={},r=e.match(/WebKit\/([\d.]+)/),n=e.match(/Chrome\/([\d.]+)/)||e.match(/CriOS\/([\d.]+)/),i=e.match(/MSIE\s([\d\.]+)/)||e.match(/(?:trident)(?:.*rv:([\w.]+))?/i),a=e.match(/Firefox\/([\d.]+)/),s=e.match(/Safari\/([\d.]+)/),o=e.match(/OPR\/([\d.]+)/);r&&(t.webkit=parseFloat(r[1]));n&&(t.chrome=parseFloat(n[1]));i&&(t.ie=parseFloat(i[1]));a&&(t.firefox=parseFloat(a[1]));s&&(t.safari=parseFloat(s[1]));o&&(t.opera=parseFloat(o[1]));return t}(navigator.userAgent),os:function(e){var t={},r=e.match(/(?:Android);?[\s\/]+([\d.]+)?/),n=e.match(/(?:iPad|iPod|iPhone).*OS\s([\d_]+)/);r&&(t.android=parseFloat(r[1]));n&&(t.ios=parseFloat(n[1].replace(/_/g,".")));return t}(navigator.userAgent),inherits:function(e,r,n){var i;if(typeof r==="function"){i=r;r=null}else if(r&&r.hasOwnProperty("constructor")){i=r.constructor}else{i=function(){return e.apply(this,arguments)}}t.extend(true,i,e,n||{});i.__super__=e.prototype;i.prototype=o(e.prototype);r&&t.extend(true,i.prototype,r);return i},noop:n,bindFn:s,log:function(){if(e.console){return s(console.log,console)}return n}(),nextTick:function(){return function(e){setTimeout(e,1)}}(),slice:a([].slice),guid:function(){var e=0;return function(t){var r=(+new Date).toString(32),n=0;for(;n<5;n++){r+=Math.floor(Math.random()*65535).toString(32)}return(t||"wu_")+r+(e++).toString(32)}}(),formatSize:function(e,t,r){var n;r=r||["B","K","M","G","TB"];while((n=r.shift())&&e>1024){e=e/1024}return(n==="B"?e:e.toFixed(t||2))+n}}});t("mediator",["base"],function(e){var t=e.$,r=[].slice,n=/\s+/,i;function a(e,r,n,i){return t.grep(e,function(e){return e&&(!r||e.e===r)&&(!n||e.cb===n||e.cb._cb===n)&&(!i||e.ctx===i)})}function s(e,r,i){t.each((e||"").split(n),function(e,t){i(t,r)})}function o(e,t){var r=false,n=-1,i=e.length,a;while(++n<i){a=e[n];if(a.cb.apply(a.ctx2,t)===false){r=true;break}}return!r}i={on:function(e,t,r){var n=this,i;if(!t){return this}i=this._events||(this._events=[]);s(e,t,function(e,t){var a={e:e};a.cb=t;a.ctx=r;a.ctx2=r||n;a.id=i.length;i.push(a)});return this},once:function(e,t,r){var n=this;if(!t){return n}s(e,t,function(e,t){var i=function(){n.off(e,i);return t.apply(r||n,arguments)};i._cb=t;n.on(e,i,r)});return n},off:function(e,r,n){var i=this._events;if(!i){return this}if(!e&&!r&&!n){this._events=[];return this}s(e,r,function(e,r){t.each(a(i,e,r,n),function(){delete i[this.id]})});return this},trigger:function(e){var t,n,i;if(!this._events||!e){return this}t=r.call(arguments,1);n=a(this._events,e);i=a(this._events,"all");return o(n,t)&&o(i,arguments)}};return t.extend({installTo:function(e){return t.extend(e,i)}},i)});t("uploader",["base","mediator"],function(e,t){var r=e.$;function n(e){this.options=r.extend(true,{},n.options,e);this._init(this.options)}n.options={};t.installTo(n.prototype);r.each({upload:"start-upload",stop:"stop-upload",getFile:"get-file",getFiles:"get-files",addFile:"add-file",addFiles:"add-file",sort:"sort-files",removeFile:"remove-file",cancelFile:"cancel-file",skipFile:"skip-file",retry:"retry",isInProgress:"is-in-progress",makeThumb:"make-thumb",md5File:"md5-file",getDimension:"get-dimension",addButton:"add-btn",predictRuntimeType:"predict-runtime-type",refresh:"refresh",disable:"disable",enable:"enable",reset:"reset"},function(e,t){n.prototype[e]=function(){return this.request(t,arguments)}});r.extend(n.prototype,{state:"pending",_init:function(e){var t=this;t.request("init",e,function(){t.state="ready";t.trigger("ready")})},option:function(e,t){var n=this.options;if(arguments.length>1){if(r.isPlainObject(t)&&r.isPlainObject(n[e])){r.extend(n[e],t)}else{n[e]=t}}else{return e?n[e]:n}},getStats:function(){var e=this.request("get-stats");return e?{successNum:e.numOfSuccess,progressNum:e.numOfProgress,cancelNum:e.numOfCancel,invalidNum:e.numOfInvalid,uploadFailNum:e.numOfUploadFailed,queueNum:e.numOfQueue,interruptNum:e.numofInterrupt}:{}},trigger:function(e){var n=[].slice.call(arguments,1),i=this.options,a="on"+e.substring(0,1).toUpperCase()+e.substring(1);if(t.trigger.apply(this,arguments)===false||r.isFunction(i[a])&&i[a].apply(this,n)===false||r.isFunction(this[a])&&this[a].apply(this,n)===false||t.trigger.apply(t,[this,e].concat(n))===false){return false}return true},destroy:function(){this.request("destroy",arguments);this.off()},request:e.noop});e.create=n.create=function(e){return new n(e)};e.Uploader=n;return n});t("runtime/runtime",["base","mediator"],function(e,t){var r=e.$,n={},i=function(e){for(var t in e){if(e.hasOwnProperty(t)){return t}}return null};function a(t){this.options=r.extend({container:document.body},t);this.uid=e.guid("rt_")}r.extend(a.prototype,{getContainer:function(){var e=this.options,t,n;if(this._container){return this._container}t=r(e.container||document.body);n=r(document.createElement("div"));n.attr("id","rt_"+this.uid);n.css({position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"});t.append(n);t.addClass("webuploader-container");this._container=n;this._parent=t;return n},init:e.noop,exec:e.noop,destroy:function(){this._container&&this._container.remove();this._parent&&this._parent.removeClass("webuploader-container");this.off()}});a.orders="html5,flash";a.addRuntime=function(e,t){n[e]=t};a.hasRuntime=function(e){return!!(e?n[e]:i(n))};a.create=function(e,t){var s,o;t=t||a.orders;r.each(t.split(/\s*,\s*/g),function(){if(n[this]){s=this;return false}});s=s||i(n);if(!s){throw new Error("Runtime Error")}o=new n[s](e);return o};t.installTo(a.prototype);return a});t("runtime/client",["base","mediator","runtime/runtime"],function(e,t,r){var n;n=function(){var e={};return{add:function(t){e[t.uid]=t},get:function(t,r){var n;if(t){return e[t]}for(n in e){if(r&&e[n].__standalone){continue}return e[n]}return null},remove:function(t){delete e[t.uid]}}}();function i(t,i){var a=e.Deferred(),s;this.uid=e.guid("client_");this.runtimeReady=function(e){return a.done(e)};this.connectRuntime=function(t,o){if(s){throw new Error("already connected!")}a.done(o);if(typeof t==="string"&&n.get(t)){s=n.get(t)}s=s||n.get(null,i);if(!s){s=r.create(t,t.runtimeOrder);s.__promise=a.promise();s.once("ready",a.resolve);s.init();n.add(s);s.__client=1}else{e.$.extend(s.options,t);s.__promise.then(a.resolve);s.__client++}i&&(s.__standalone=i);return s};this.getRuntime=function(){return s};this.disconnectRuntime=function(){if(!s){return}s.__client--;if(s.__client<=0){n.remove(s);delete s.__promise;s.destroy()}s=null};this.exec=function(){if(!s){return}var r=e.slice(arguments);t&&r.unshift(t);return s.exec.apply(this,r)};this.getRuid=function(){return s&&s.uid};this.destroy=function(e){return function(){e&&e.apply(this,arguments);this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()}}(this.destroy)}t.installTo(i.prototype);return i});t("lib/dnd",["base","mediator","runtime/client"],function(e,t,r){var n=e.$;function i(e){e=this.options=n.extend({},i.options,e);e.container=n(e.container);if(!e.container.length){return}r.call(this,"DragAndDrop")}i.options={accept:null,disableGlobalDnd:false};e.inherits(r,{constructor:i,init:function(){var e=this;e.connectRuntime(e.options,function(){e.exec("init");e.trigger("ready")})}});t.installTo(i.prototype);return i});t("widgets/widget",["base","uploader"],function(e,t){var r=e.$,n=t.prototype._init,i=t.prototype.destroy,a={},s=[];function o(e){if(!e){return false}var t=e.length,n=r.type(e);if(e.nodeType===1&&t){return true}return n==="array"||n!=="function"&&n!=="string"&&(t===0||typeof t==="number"&&t>0&&t-1 in e)}function u(e){this.owner=e;this.options=e.options}r.extend(u.prototype,{init:e.noop,invoke:function(e,t){var n=this.responseMap;if(!n||!(e in n)||!(n[e]in this)||!r.isFunction(this[n[e]])){return a}return this[n[e]].apply(this,t)},request:function(){return this.owner.request.apply(this.owner,arguments)}});r.extend(t.prototype,{_init:function(){var e=this,t=e._widgets=[],i=e.options.disableWidgets||"";r.each(s,function(r,n){(!i||!~i.indexOf(n._name))&&t.push(new n(e))});return n.apply(e,arguments)},request:function(t,r,n){var i=0,s=this._widgets,u=s&&s.length,f=[],l=[],c,h,d,p;r=o(r)?r:[r];for(;i<u;i++){c=s[i];h=c.invoke(t,r);if(h!==a){if(e.isPromise(h)){l.push(h)}else{f.push(h)}}}if(n||l.length){d=e.when.apply(e,l);p=d.pipe?"pipe":"then";return d[p](function(){var t=e.Deferred(),r=arguments;if(r.length===1){r=r[0]}setTimeout(function(){t.resolve(r)},1);return t.promise()})[n?p:"done"](n||e.noop)}else{return f[0]}},destroy:function(){i.apply(this,arguments);this._widgets=null}});t.register=u.register=function(t,n){var i={init:"init",destroy:"destroy",name:"anonymous"},a;if(arguments.length===1){n=t;r.each(n,function(e){if(e[0]==="_"||e==="name"){e==="name"&&(i.name=n.name);return}i[e.replace(/[A-Z]/g,"-$&").toLowerCase()]=e})}else{i=r.extend(i,t)}n.responseMap=i;a=e.inherits(u,n);a._name=i.name;s.push(a);return a};t.unRegister=u.unRegister=function(e){if(!e||e==="anonymous"){return}for(var t=s.length;t--;){if(s[t]._name===e){s.splice(t,1)}}};return u});t("widgets/filednd",["base","uploader","lib/dnd","widgets/widget"],function(e,t,r){var n=e.$;t.options.dnd="";return t.register({name:"dnd",init:function(t){if(!t.dnd||this.request("predict-runtime-type")!=="html5"){return}var i=this,a=e.Deferred(),s=n.extend({},{disableGlobalDnd:t.disableGlobalDnd,container:t.dnd,accept:t.accept}),o;this.dnd=o=new r(s);o.once("ready",a.resolve);o.on("drop",function(e){i.request("add-file",[e])});o.on("accept",function(e){return i.owner.trigger("dndAccept",e)});o.init();return a.promise()},destroy:function(){this.dnd&&this.dnd.destroy()}})});t("lib/filepaste",["base","mediator","runtime/client"],function(e,t,r){var n=e.$;function i(e){e=this.options=n.extend({},e);e.container=n(e.container||document.body);r.call(this,"FilePaste")}e.inherits(r,{constructor:i,init:function(){var e=this;e.connectRuntime(e.options,function(){e.exec("init");e.trigger("ready")})}});t.installTo(i.prototype);return i});t("widgets/filepaste",["base","uploader","lib/filepaste","widgets/widget"],function(e,t,r){var n=e.$;return t.register({name:"paste",init:function(t){if(!t.paste||this.request("predict-runtime-type")!=="html5"){return}var i=this,a=e.Deferred(),s=n.extend({},{container:t.paste,accept:t.accept}),o;this.paste=o=new r(s);o.once("ready",a.resolve);o.on("paste",function(e){i.owner.request("add-file",[e])});o.init();return a.promise()},destroy:function(){this.paste&&this.paste.destroy()}})});t("lib/blob",["base","runtime/client"],function(e,t){function r(e,r){var n=this;n.source=r;n.ruid=e;this.size=r.size||0;if(!r.type&&this.ext&&~"jpg,jpeg,png,gif,bmp".indexOf(this.ext)){this.type="image/"+(this.ext==="jpg"?"jpeg":this.ext)}else{this.type=r.type||"application/octet-stream"}t.call(n,"Blob");this.uid=r.uid||this.uid;if(e){n.connectRuntime(e)}}e.inherits(t,{constructor:r,slice:function(e,t){return this.exec("slice",e,t)},getSource:function(){return this.source}});return r});t("lib/file",["base","lib/blob"],function(e,t){var r=1,n=/\.([^.]+)$/;function i(e,i){var a;this.name=i.name||"untitled"+r++;a=n.exec(i.name)?RegExp.$1.toLowerCase():"";if(!a&&i.type){a=/\/(jpg|jpeg|png|gif|bmp)$/i.exec(i.type)?RegExp.$1.toLowerCase():"";this.name+="."+a}this.ext=a;this.lastModifiedDate=i.lastModifiedDate||(new Date).toLocaleString();t.apply(this,arguments)}return e.inherits(t,i)});t("lib/filepicker",["base","runtime/client","lib/file"],function(t,r,n){var i=t.$;function a(e){e=this.options=i.extend({},a.options,e);e.container=i(e.id);if(!e.container.length){throw new Error("按钮指定错误")}e.innerHTML=e.innerHTML||e.label||e.container.html()||"";e.button=i(e.button||document.createElement("div"));e.button.html(e.innerHTML);e.container.html(e.button);r.call(this,"FilePicker",true)}a.options={button:null,container:null,label:null,innerHTML:null,multiple:true,accept:null,name:"file"};t.inherits(r,{constructor:a,init:function(){var r=this,a=r.options,s=a.button;s.addClass("webuploader-pick");r.on("all",function(e){var t;switch(e){case"mouseenter":s.addClass("webuploader-pick-hover");break;case"mouseleave":s.removeClass("webuploader-pick-hover");break;case"change":t=r.exec("getFiles");r.trigger("select",i.map(t,function(e){e=new n(r.getRuid(),e);e._refer=a.container;return e}),a.container);break}});r.connectRuntime(a,function(){r.refresh();r.exec("init",a);r.trigger("ready")});this._resizeHandler=t.bindFn(this.refresh,this);i(e).on("resize",this._resizeHandler)},refresh:function(){var e=this.getRuntime().getContainer(),t=this.options.button,r=t.outerWidth?t.outerWidth():t.width(),n=t.outerHeight?t.outerHeight():t.height(),i=t.offset();r&&n&&e.css({bottom:"auto",right:"auto",width:r+"px",height:n+"px"}).offset(i)},enable:function(){var e=this.options.button;e.removeClass("webuploader-pick-disable");this.refresh()},disable:function(){var e=this.options.button;this.getRuntime().getContainer().css({top:"-99999px"});e.addClass("webuploader-pick-disable")},destroy:function(){var t=this.options.button;i(e).off("resize",this._resizeHandler);t.removeClass("webuploader-pick-disable webuploader-pick-hover "+"webuploader-pick")}});return a});t("widgets/filepicker",["base","uploader","lib/filepicker","widgets/widget"],function(e,t,r){var n=e.$;n.extend(t.options,{pick:null,accept:null});return t.register({name:"picker",init:function(e){this.pickers=[];return e.pick&&this.addBtn(e.pick)},refresh:function(){n.each(this.pickers,function(){this.refresh()})},addBtn:function(t){var i=this,a=i.options,s=a.accept,o=[];if(!t){return}n.isPlainObject(t)||(t={id:t});n(t.id).each(function(){var u,f,l;l=e.Deferred();u=n.extend({},t,{accept:n.isPlainObject(s)?[s]:s,swf:a.swf,runtimeOrder:a.runtimeOrder,id:this});f=new r(u);f.once("ready",l.resolve);f.on("select",function(e){i.owner.request("add-file",[e])});f.init();i.pickers.push(f);o.push(l.promise())});return e.when.apply(e,o)},disable:function(){n.each(this.pickers,function(){this.disable()})},enable:function(){n.each(this.pickers,function(){this.enable()})},destroy:function(){n.each(this.pickers,function(){this.destroy()});this.pickers=null}})});t("lib/image",["base","runtime/client","lib/blob"],function(e,t,r){var n=e.$;function i(e){this.options=n.extend({},i.options,e);t.call(this,"Image");this.on("load",function(){this._info=this.exec("info");this._meta=this.exec("meta")})}i.options={quality:90,crop:false,preserveHeaders:false,allowMagnify:false};e.inherits(t,{constructor:i,info:function(e){if(e){this._info=e;return this}return this._info},meta:function(e){if(e){this._meta=e;return this}return this._meta},loadFromBlob:function(e){var t=this,r=e.getRuid();this.connectRuntime(r,function(){t.exec("init",t.options);t.exec("loadFromBlob",e)})},resize:function(){var t=e.slice(arguments);return this.exec.apply(this,["resize"].concat(t))},crop:function(){var t=e.slice(arguments);return this.exec.apply(this,["crop"].concat(t))},getAsDataUrl:function(e){return this.exec("getAsDataUrl",e)},getAsBlob:function(e){var t=this.exec("getAsBlob",e);return new r(this.getRuid(),t)}});return i});t("widgets/image",["base","uploader","lib/image","widgets/widget"],function(e,t,r){var n=e.$,i;i=function(e){var t=0,r=[],n=function(){var n;while(r.length&&t<e){n=r.shift();t+=n[0];n[1]()}};return function(e,i,a){r.push([i,a]);e.once("destroy",function(){t-=i;setTimeout(n,1)});setTimeout(n,1)}}(5*1024*1024);n.extend(t.options,{thumb:{width:110,height:110,quality:70,allowMagnify:true,crop:true,preserveHeaders:false,type:"image/jpeg"},compress:{width:1600,height:1600,quality:90,allowMagnify:false,crop:false,preserveHeaders:true}});return t.register({name:"image",makeThumb:function(e,t,a,s){var o,u;e=this.request("get-file",e);if(!e.type.match(/^image/)){t(true);return}o=n.extend({},this.options.thumb);if(n.isPlainObject(a)){o=n.extend(o,a);a=null}a=a||o.width;s=s||o.height;u=new r(o);u.once("load",function(){e._info=e._info||u.info();e._meta=e._meta||u.meta();if(a<=1&&a>0){a=e._info.width*a}if(s<=1&&s>0){s=e._info.height*s}u.resize(a,s)});u.once("complete",function(){t(false,u.getAsDataUrl(o.type));u.destroy()});u.once("error",function(e){t(e||true);u.destroy()});i(u,e.source.size,function(){e._info&&u.info(e._info);e._meta&&u.meta(e._meta);u.loadFromBlob(e.source)})},beforeSendFile:function(t){var i=this.options.compress||this.options.resize,a=i&&i.compressSize||0,s=i&&i.noCompressIfLarger||false,o,u;t=this.request("get-file",t);if(!i||!~"image/jpeg,image/jpg".indexOf(t.type)||t.size<a||t._compressed){return}i=n.extend({},i);u=e.Deferred();o=new r(i);u.always(function(){o.destroy();o=null});o.once("error",u.reject);o.once("load",function(){var e=i.width,r=i.height;t._info=t._info||o.info();t._meta=t._meta||o.meta();if(e<=1&&e>0){e=t._info.width*e}if(r<=1&&r>0){r=t._info.height*r}o.resize(e,r)});o.once("complete",function(){var e,r;try{e=o.getAsBlob(i.type);r=t.size;if(!s||e.size<r){t.source=e;t.size=e.size;t.trigger("resize",e.size,r)}t._compressed=true;u.resolve()}catch(n){u.resolve()}});t._info&&o.info(t._info);t._meta&&o.meta(t._meta);o.loadFromBlob(t.source);return u.promise()}})});t("file",["base","mediator"],function(e,t){var r=e.$,n="WU_FILE_",i=0,a=/\.([^.]+)$/,s={};function o(){return n+i++}function u(e){this.name=e.name||"Untitled";this.size=e.size||0;this.type=e.type||"application/octet-stream";this.lastModifiedDate=e.lastModifiedDate||new Date*1;this.id=o();this.ext=a.exec(this.name)?RegExp.$1:"";this.statusText="";s[this.id]=u.Status.INITED;this.source=e;this.loaded=0;this.on("error",function(e){this.setStatus(u.Status.ERROR,e)})}r.extend(u.prototype,{setStatus:function(e,t){var r=s[this.id];typeof t!=="undefined"&&(this.statusText=t);if(e!==r){s[this.id]=e;this.trigger("statuschange",e,r)}},getStatus:function(){return s[this.id]},getSource:function(){return this.source},destroy:function(){this.off();delete s[this.id]}});t.installTo(u.prototype);u.Status={INITED:"inited",QUEUED:"queued",PROGRESS:"progress",ERROR:"error",COMPLETE:"complete",CANCELLED:"cancelled",INTERRUPT:"interrupt",INVALID:"invalid"};return u});t("queue",["base","mediator","file"],function(e,t,r){var n=e.$,i=r.Status;function a(){this.stats={numOfQueue:0,numOfSuccess:0,numOfCancel:0,numOfProgress:0,numOfUploadFailed:0,numOfInvalid:0,numofDeleted:0,numofInterrupt:0};this._queue=[];this._map={}}n.extend(a.prototype,{append:function(e){this._queue.push(e);this._fileAdded(e);return this},prepend:function(e){this._queue.unshift(e);this._fileAdded(e);return this},getFile:function(e){if(typeof e!=="string"){return e}return this._map[e]},fetch:function(e){var t=this._queue.length,r,n;e=e||i.QUEUED;for(r=0;r<t;r++){n=this._queue[r];if(e===n.getStatus()){return n}}return null},sort:function(e){if(typeof e==="function"){this._queue.sort(e)}},getFiles:function(){var e=[].slice.call(arguments,0),t=[],r=0,i=this._queue.length,a;for(;r<i;r++){a=this._queue[r];if(e.length&&!~n.inArray(a.getStatus(),e)){continue}t.push(a)}return t},removeFile:function(e){var t=this,r=this._map[e.id];if(r){delete this._map[e.id];e.destroy();this.stats.numofDeleted++}},_fileAdded:function(e){var t=this,r=this._map[e.id];if(!r){this._map[e.id]=e;e.on("statuschange",function(e,r){t._onFileStatusChange(e,r)})}},_onFileStatusChange:function(e,t){var r=this.stats;switch(t){case i.PROGRESS:r.numOfProgress--;break;case i.QUEUED:r.numOfQueue--;break;case i.ERROR:r.numOfUploadFailed--;break;case i.INVALID:r.numOfInvalid--;break;case i.INTERRUPT:r.numofInterrupt--;break}switch(e){case i.QUEUED:r.numOfQueue++;break;case i.PROGRESS:r.numOfProgress++;break;case i.ERROR:r.numOfUploadFailed++;break;case i.COMPLETE:r.numOfSuccess++;break;case i.CANCELLED:r.numOfCancel++;break;case i.INVALID:r.numOfInvalid++;break;case i.INTERRUPT:r.numofInterrupt++;break}}});t.installTo(a.prototype);return a});t("widgets/queue",["base","uploader","queue","file","lib/file","runtime/client","widgets/widget"],function(e,t,r,n,i,a){var s=e.$,o=/\.\w+$/,u=n.Status;return t.register({name:"queue",init:function(t){var n=this,i,o,u,f,l,c,h;if(s.isPlainObject(t.accept)){t.accept=[t.accept]}if(t.accept){l=[];for(u=0,o=t.accept.length;u<o;u++){f=t.accept[u].extensions;f&&l.push(f)}if(l.length){c="\\."+l.join(",").replace(/,/g,"$|\\.").replace(/\*/g,".*")+"$"}n.accept=new RegExp(c,"i")}n.queue=new r;n.stats=n.queue.stats;if(this.request("predict-runtime-type")!=="html5"){return}i=e.Deferred();this.placeholder=h=new a("Placeholder");h.connectRuntime({runtimeOrder:"html5"},function(){n._ruid=h.getRuid();i.resolve()});return i.promise()},_wrapFile:function(e){if(!(e instanceof n)){if(!(e instanceof i)){if(!this._ruid){throw new Error("Can't add external files.")}e=new i(this._ruid,e)}e=new n(e)}return e},acceptFile:function(e){var t=!e||!e.size||this.accept&&o.exec(e.name)&&!this.accept.test(e.name);return!t},_addFile:function(e){var t=this;e=t._wrapFile(e);if(!t.owner.trigger("beforeFileQueued",e)){return}if(!t.acceptFile(e)){t.owner.trigger("error","Q_TYPE_DENIED",e);return}t.queue.append(e);t.owner.trigger("fileQueued",e);return e},getFile:function(e){return this.queue.getFile(e)},addFile:function(e){var t=this;if(!e.length){e=[e]}e=s.map(e,function(e){return t._addFile(e)});t.owner.trigger("filesQueued",e);if(t.options.auto){setTimeout(function(){t.request("start-upload")},20)}},getStats:function(){return this.stats},removeFile:function(e,t){var r=this;e=e.id?e:r.queue.getFile(e);this.request("cancel-file",e);if(t){this.queue.removeFile(e)}},getFiles:function(){return this.queue.getFiles.apply(this.queue,arguments)},fetchFile:function(){return this.queue.fetch.apply(this.queue,arguments)},retry:function(e,t){var r=this,n,i,a;if(e){e=e.id?e:r.queue.getFile(e);e.setStatus(u.QUEUED);t||r.request("start-upload");return}n=r.queue.getFiles(u.ERROR);i=0;a=n.length;for(;i<a;i++){e=n[i];e.setStatus(u.QUEUED)}r.request("start-upload")},sortFiles:function(){return this.queue.sort.apply(this.queue,arguments)},reset:function(){this.owner.trigger("reset");this.queue=new r;this.stats=this.queue.stats},destroy:function(){this.reset();this.placeholder&&this.placeholder.destroy()}})});t("widgets/runtime",["uploader","runtime/runtime","widgets/widget"],function(e,t){e.support=function(){return t.hasRuntime.apply(t,arguments)};return e.register({name:"runtime",init:function(){if(!this.predictRuntimeType()){throw Error("Runtime Error")}},predictRuntimeType:function(){var e=this.options.runtimeOrder||t.orders,r=this.type,n,i;if(!r){e=e.split(/\s*,\s*/g);for(n=0,i=e.length;n<i;n++){if(t.hasRuntime(e[n])){this.type=r=e[n];break}}}return r}})});t("lib/transport",["base","runtime/client","mediator"],function(e,t,r){var n=e.$;function i(e){var r=this;e=r.options=n.extend(true,{},i.options,e||{});t.call(this,"Transport");this._blob=null;this._formData=e.formData||{};this._headers=e.headers||{};this.on("progress",this._timeout);this.on("load error",function(){r.trigger("progress",1);clearTimeout(r._timer)})}i.options={server:"",method:"POST",withCredentials:false,fileVal:"file",timeout:2*60*1e3,formData:{},headers:{},sendAsBinary:false};n.extend(i.prototype,{appendBlob:function(e,t,r){var n=this,i=n.options;if(n.getRuid()){n.disconnectRuntime()}n.connectRuntime(t.ruid,function(){n.exec("init")});n._blob=t;i.fileVal=e||i.fileVal;i.filename=r||i.filename},append:function(e,t){if(typeof e==="object"){n.extend(this._formData,e)}else{this._formData[e]=t}},setRequestHeader:function(e,t){if(typeof e==="object"){n.extend(this._headers,e)}else{this._headers[e]=t}},send:function(e){this.exec("send",e);this._timeout()},abort:function(){clearTimeout(this._timer);return this.exec("abort")},destroy:function(){this.trigger("destroy");this.off();this.exec("destroy");this.disconnectRuntime()},getResponse:function(){return this.exec("getResponse")},getResponseAsJson:function(){return this.exec("getResponseAsJson")},getStatus:function(){return this.exec("getStatus")},_timeout:function(){var e=this,t=e.options.timeout;if(!t){return}clearTimeout(e._timer);e._timer=setTimeout(function(){e.abort();e.trigger("error","timeout")},t)}});r.installTo(i.prototype);return i});t("widgets/upload",["base","uploader","file","lib/transport","widgets/widget"],function(e,t,r,n){var i=e.$,a=e.isPromise,s=r.Status;i.extend(t.options,{prepareNextFile:false,chunked:false,chunkSize:5*1024*1024,chunkRetry:2,threads:3,formData:{}});function o(e,t){var r=[],n=e.source,i=n.size,a=t?Math.ceil(i/t):1,s=0,o=0,u,f;f={file:e,has:function(){return!!r.length},shift:function(){return r.shift()},unshift:function(e){r.unshift(e)}};while(o<a){u=Math.min(t,i-s);r.push({file:e,start:s,end:t?s+u:i,total:i,chunks:a,chunk:o++,cuted:f});s+=u}e.blocks=r.concat();e.remaning=r.length;return f}t.register({name:"upload",init:function(){var t=this.owner,r=this;this.runing=false;this.progress=false;t.on("startUpload",function(){r.progress=true}).on("uploadFinished",function(){r.progress=false});this.pool=[];this.stack=[];this.pending=[];this.remaning=0;this.__tick=e.bindFn(this._tick,this);t.on("uploadComplete",function(e){e.blocks&&i.each(e.blocks,function(e,t){t.transport&&(t.transport.abort(),t.transport.destroy());delete t.transport});delete e.blocks;delete e.remaning})},reset:function(){this.request("stop-upload",true);this.runing=false;this.pool=[];this.stack=[];this.pending=[];this.remaning=0;this._trigged=false;this._promise=null},startUpload:function(t){var r=this;i.each(r.request("get-files",s.INVALID),function(){r.request("remove-file",this)});if(t){t=t.id?t:r.request("get-file",t);if(t.getStatus()===s.INTERRUPT){i.each(r.pool,function(e,r){if(r.file!==t){return}r.transport&&r.transport.send()});t.setStatus(s.QUEUED)}else if(t.getStatus()===s.PROGRESS){return}else{t.setStatus(s.QUEUED)}}else{i.each(r.request("get-files",[s.INITED]),function(){this.setStatus(s.QUEUED)})}if(r.runing){return}r.runing=true;var n=[];i.each(r.pool,function(e,t){var i=t.file;if(i.getStatus()===s.INTERRUPT){n.push(i);r._trigged=false;t.transport&&t.transport.send()}});var t;while(t=n.shift()){t.setStatus(s.PROGRESS)}t||i.each(r.request("get-files",s.INTERRUPT),function(){this.setStatus(s.PROGRESS)});r._trigged=false;e.nextTick(r.__tick);r.owner.trigger("startUpload")},stopUpload:function(t,r){var n=this;if(t===true){r=t;t=null}if(n.runing===false){return}if(t){t=t.id?t:n.request("get-file",t);if(t.getStatus()!==s.PROGRESS&&t.getStatus()!==s.QUEUED){return}t.setStatus(s.INTERRUPT);i.each(n.pool,function(e,r){if(r.file!==t){return}r.transport&&r.transport.abort();n._putback(r);n._popBlock(r)});return e.nextTick(n.__tick)}n.runing=false;if(this._promise&&this._promise.file){this._promise.file.setStatus(s.INTERRUPT)}r&&i.each(n.pool,function(e,t){t.transport&&t.transport.abort();t.file.setStatus(s.INTERRUPT)});n.owner.trigger("stopUpload")},cancelFile:function(e){e=e.id?e:this.request("get-file",e);e.blocks&&i.each(e.blocks,function(e,t){var r=t.transport;if(r){r.abort();r.destroy();delete t.transport}});e.setStatus(s.CANCELLED);this.owner.trigger("fileDequeued",e)},isInProgress:function(){return!!this.progress},_getStats:function(){return this.request("get-stats")},skipFile:function(e,t){e=e.id?e:this.request("get-file",e);e.setStatus(t||s.COMPLETE);e.skipped=true;e.blocks&&i.each(e.blocks,function(e,t){var r=t.transport;if(r){r.abort();r.destroy();delete t.transport}});this.owner.trigger("uploadSkip",e)},_tick:function(){var t=this,r=t.options,n,i;if(t._promise){return t._promise.always(t.__tick)}if(t.pool.length<r.threads&&(i=t._nextBlock())){t._trigged=false;n=function(r){t._promise=null;r&&r.file&&t._startSend(r);e.nextTick(t.__tick)};t._promise=a(i)?i.always(n):n(i)}else if(!t.remaning&&!t._getStats().numOfQueue&&!t._getStats().numofInterrupt){t.runing=false;t._trigged||e.nextTick(function(){t.owner.trigger("uploadFinished")});t._trigged=true}},_putback:function(e){var t;e.cuted.unshift(e);t=this.stack.indexOf(e.cuted);if(!~t){this.stack.unshift(e.cuted)}},_getStack:function(){var e=0,t;while(t=this.stack[e++]){if(t.has()&&t.file.getStatus()===s.PROGRESS){return t}else if(!t.has()||t.file.getStatus()!==s.PROGRESS&&t.file.getStatus()!==s.INTERRUPT){this.stack.splice(--e,1)}}return null},_nextBlock:function(){var e=this,t=e.options,r,n,i,s;if(r=this._getStack()){if(t.prepareNextFile&&!e.pending.length){e._prepareNextFile()}return r.shift()}else if(e.runing){if(!e.pending.length&&e._getStats().numOfQueue){e._prepareNextFile()}n=e.pending.shift();i=function(n){if(!n){return null}r=o(n,t.chunked?t.chunkSize:0);e.stack.push(r);return r.shift()};if(a(n)){s=n.file;n=n[n.pipe?"pipe":"then"](i);n.file=s;return n}return i(n)}},_prepareNextFile:function(){var e=this,t=e.request("fetch-file"),r=e.pending,n;if(t){n=e.request("before-send-file",t,function(){if(t.getStatus()===s.PROGRESS||t.getStatus()===s.INTERRUPT){return t}return e._finishFile(t)});e.owner.trigger("uploadStart",t);t.setStatus(s.PROGRESS);n.file=t;n.done(function(){var e=i.inArray(n,r);~e&&r.splice(e,1,t)});n.fail(function(r){t.setStatus(s.ERROR,r);e.owner.trigger("uploadError",t,r);e.owner.trigger("uploadComplete",t)});r.push(n)}},_popBlock:function(e){var t=i.inArray(e,this.pool);this.pool.splice(t,1);e.file.remaning--;this.remaning--},_startSend:function(t){var r=this,n=t.file,i;if(n.getStatus()!==s.PROGRESS){if(n.getStatus()===s.INTERRUPT){r._putback(t)}return}r.pool.push(t);r.remaning++;t.blob=t.chunks===1?n.source:n.source.slice(t.start,t.end);i=r.request("before-send",t,function(){if(n.getStatus()===s.PROGRESS){r._doSend(t)}else{r._popBlock(t);e.nextTick(r.__tick)}});i.fail(function(){if(n.remaning===1){r._finishFile(n).always(function(){t.percentage=1;r._popBlock(t);r.owner.trigger("uploadComplete",n);e.nextTick(r.__tick)})}else{t.percentage=1;r.updateFileProgress(n);r._popBlock(t);e.nextTick(r.__tick)}})},_doSend:function(t){var r=this,a=r.owner,o=r.options,u=t.file,f=new n(o),l=i.extend({},o.formData),c=i.extend({},o.headers),h,d;t.transport=f;f.on("destroy",function(){delete t.transport;r._popBlock(t);e.nextTick(r.__tick)});f.on("progress",function(e){t.percentage=e;r.updateFileProgress(u)});h=function(e){var r;d=f.getResponseAsJson()||{};d._raw=f.getResponse();r=function(t){e=t};if(!a.trigger("uploadAccept",t,d,r)){e=e||"server"}return e};f.on("error",function(e,r){t.retried=t.retried||0;if(t.chunks>1&&~"http,abort".indexOf(e)&&t.retried<o.chunkRetry){
t.retried++;f.send()}else{if(!r&&e==="server"){e=h(e)}u.setStatus(s.ERROR,e);a.trigger("uploadError",u,e);a.trigger("uploadComplete",u)}});f.on("load",function(){var e;if(e=h()){f.trigger("error",e,true);return}if(u.remaning===1){r._finishFile(u,d)}else{f.destroy()}});l=i.extend(l,{id:u.id,name:u.name,type:u.type,lastModifiedDate:u.lastModifiedDate,size:u.size});t.chunks>1&&i.extend(l,{chunks:t.chunks,chunk:t.chunk});a.trigger("uploadBeforeSend",t,l,c);f.appendBlob(o.fileVal,t.blob,u.name);f.append(l);f.setRequestHeader(c);f.send()},_finishFile:function(e,t,r){var n=this.owner;return n.request("after-send-file",arguments,function(){e.setStatus(s.COMPLETE);n.trigger("uploadSuccess",e,t,r)}).fail(function(t){if(e.getStatus()===s.PROGRESS){e.setStatus(s.ERROR,t)}n.trigger("uploadError",e,t)}).always(function(){n.trigger("uploadComplete",e)})},updateFileProgress:function(e){var t=0,r=0;if(!e.blocks){return}i.each(e.blocks,function(e,t){r+=(t.percentage||0)*(t.end-t.start)});t=r/e.size;this.owner.trigger("uploadProgress",e,t||0)}})});t("widgets/validator",["base","uploader","file","widgets/widget"],function(e,t,r){var n=e.$,i={},a;a={addValidator:function(e,t){i[e]=t},removeValidator:function(e){delete i[e]}};t.register({name:"validator",init:function(){var t=this;e.nextTick(function(){n.each(i,function(){this.call(t.owner)})})}});a.addValidator("fileNumLimit",function(){var e=this,t=e.options,r=0,n=parseInt(t.fileNumLimit,10),i=true;if(!n){return}e.on("beforeFileQueued",function(e){if(r>=n&&i){i=false;this.trigger("error","Q_EXCEED_NUM_LIMIT",n,e);setTimeout(function(){i=true},1)}return r>=n?false:true});e.on("fileQueued",function(){r++});e.on("fileDequeued",function(){r--});e.on("reset",function(){r=0})});a.addValidator("fileSizeLimit",function(){var e=this,t=e.options,r=0,n=parseInt(t.fileSizeLimit,10),i=true;if(!n){return}e.on("beforeFileQueued",function(e){var t=r+e.size>n;if(t&&i){i=false;this.trigger("error","Q_EXCEED_SIZE_LIMIT",n,e);setTimeout(function(){i=true},1)}return t?false:true});e.on("fileQueued",function(e){r+=e.size});e.on("fileDequeued",function(e){r-=e.size});e.on("reset",function(){r=0})});a.addValidator("fileSingleSizeLimit",function(){var e=this,t=e.options,n=t.fileSingleSizeLimit;if(!n){return}e.on("beforeFileQueued",function(e){if(e.size>n){e.setStatus(r.Status.INVALID,"exceed_size");this.trigger("error","F_EXCEED_SIZE",n,e);return false}})});a.addValidator("duplicate",function(){var e=this,t=e.options,r={};if(t.duplicate){return}function n(e){var t=0,r=0,n=e.length,i;for(;r<n;r++){i=e.charCodeAt(r);t=i+(t<<6)+(t<<16)-t}return t}e.on("beforeFileQueued",function(e){var t=e.__hash||(e.__hash=n(e.name+e.size+e.lastModifiedDate));if(r[t]){this.trigger("error","F_DUPLICATE",e);return false}});e.on("fileQueued",function(e){var t=e.__hash;t&&(r[t]=true)});e.on("fileDequeued",function(e){var t=e.__hash;t&&delete r[t]});e.on("reset",function(){r={}})});return a});t("lib/md5",["runtime/client","mediator"],function(e,t){function r(){e.call(this,"Md5")}t.installTo(r.prototype);r.prototype.loadFromBlob=function(e){var t=this;if(t.getRuid()){t.disconnectRuntime()}t.connectRuntime(e.ruid,function(){t.exec("init");t.exec("loadFromBlob",e)})};r.prototype.getResult=function(){return this.exec("getResult")};return r});t("widgets/md5",["base","uploader","lib/md5","lib/blob","widgets/widget"],function(e,t,r,n){return t.register({name:"md5",md5File:function(t,i,a){var s=new r,o=e.Deferred(),u=t instanceof n?t:this.request("get-file",t).source;s.on("progress load",function(e){e=e||{};o.notify(e.total?e.loaded/e.total:1)});s.on("complete",function(){o.resolve(s.getResult())});s.on("error",function(e){o.reject(e)});if(arguments.length>1){i=i||0;a=a||0;i<0&&(i=u.size+i);a<0&&(a=u.size+a);a=Math.min(a,u.size);u=u.slice(i,a)}s.loadFromBlob(u);return o.promise()}})});t("runtime/compbase",[],function(){function e(e,t){this.owner=e;this.options=e.options;this.getRuntime=function(){return t};this.getRuid=function(){return t.uid};this.trigger=function(){return e.trigger.apply(e,arguments)}}return e});t("runtime/html5/runtime",["base","runtime/runtime","runtime/compbase"],function(t,r,n){var i="html5",a={};function s(){var e={},n=this,s=this.destroy;r.apply(n,arguments);n.type=i;n.exec=function(r,i){var s=this,o=s.uid,u=t.slice(arguments,2),f;if(a[r]){f=e[o]=e[o]||new a[r](s,n);if(f[i]){return f[i].apply(f,u)}}};n.destroy=function(){return s&&s.apply(this,arguments)}}t.inherits(r,{constructor:s,init:function(){var e=this;setTimeout(function(){e.trigger("ready")},1)}});s.register=function(e,r){var i=a[e]=t.inherits(n,r);return i};if(e.Blob&&e.FileReader&&e.DataView){r.addRuntime(i,s)}return s});t("runtime/html5/blob",["runtime/html5/runtime","lib/blob"],function(e,t){return e.register("Blob",{slice:function(e,r){var n=this.owner.source,i=n.slice||n.webkitSlice||n.mozSlice;n=i.call(n,e,r);return new t(this.getRuid(),n)}})});t("runtime/html5/dnd",["base","runtime/html5/runtime","lib/file"],function(e,t,r){var n=e.$,i="webuploader-dnd-";return t.register("DragAndDrop",{init:function(){var t=this.elem=this.options.container;this.dragEnterHandler=e.bindFn(this._dragEnterHandler,this);this.dragOverHandler=e.bindFn(this._dragOverHandler,this);this.dragLeaveHandler=e.bindFn(this._dragLeaveHandler,this);this.dropHandler=e.bindFn(this._dropHandler,this);this.dndOver=false;t.on("dragenter",this.dragEnterHandler);t.on("dragover",this.dragOverHandler);t.on("dragleave",this.dragLeaveHandler);t.on("drop",this.dropHandler);if(this.options.disableGlobalDnd){n(document).on("dragover",this.dragOverHandler);n(document).on("drop",this.dropHandler)}},_dragEnterHandler:function(e){var t=this,r=t._denied||false,n;e=e.originalEvent||e;if(!t.dndOver){t.dndOver=true;n=e.dataTransfer.items;if(n&&n.length){t._denied=r=!t.trigger("accept",n)}t.elem.addClass(i+"over");t.elem[r?"addClass":"removeClass"](i+"denied")}e.dataTransfer.dropEffect=r?"none":"copy";return false},_dragOverHandler:function(e){var t=this.elem.parent().get(0);if(t&&!n.contains(t,e.currentTarget)){return false}clearTimeout(this._leaveTimer);this._dragEnterHandler.call(this,e);return false},_dragLeaveHandler:function(){var e=this,t;t=function(){e.dndOver=false;e.elem.removeClass(i+"over "+i+"denied")};clearTimeout(e._leaveTimer);e._leaveTimer=setTimeout(t,100);return false},_dropHandler:function(e){var t=this,a=t.getRuid(),s=t.elem.parent().get(0),o,u;if(s&&!n.contains(s,e.currentTarget)){return false}e=e.originalEvent||e;o=e.dataTransfer;try{u=o.getData("text/html")}catch(f){}if(u){return}t._getTansferFiles(o,function(e){t.trigger("drop",n.map(e,function(e){return new r(a,e)}))});t.dndOver=false;t.elem.removeClass(i+"over");return false},_getTansferFiles:function(t,r){var n=[],i=[],a,s,o,u,f,l,c;a=t.items;s=t.files;c=!!(a&&a[0].webkitGetAsEntry);for(f=0,l=s.length;f<l;f++){o=s[f];u=a&&a[f];if(c&&u.webkitGetAsEntry().isDirectory){i.push(this._traverseDirectoryTree(u.webkitGetAsEntry(),n))}else{n.push(o)}}e.when.apply(e,i).done(function(){if(!n.length){return}r(n)})},_traverseDirectoryTree:function(t,r){var n=e.Deferred(),i=this;if(t.isFile){t.file(function(e){r.push(e);n.resolve()})}else if(t.isDirectory){t.createReader().readEntries(function(t){var a=t.length,s=[],o=[],u;for(u=0;u<a;u++){s.push(i._traverseDirectoryTree(t[u],o))}e.when.apply(e,s).then(function(){r.push.apply(r,o);n.resolve()},n.reject)})}return n.promise()},destroy:function(){var e=this.elem;if(!e){return}e.off("dragenter",this.dragEnterHandler);e.off("dragover",this.dragOverHandler);e.off("dragleave",this.dragLeaveHandler);e.off("drop",this.dropHandler);if(this.options.disableGlobalDnd){n(document).off("dragover",this.dragOverHandler);n(document).off("drop",this.dropHandler)}}})});t("runtime/html5/filepaste",["base","runtime/html5/runtime","lib/file"],function(e,t,r){return t.register("FilePaste",{init:function(){var t=this.options,r=this.elem=t.container,n=".*",i,a,s,o;if(t.accept){i=[];for(a=0,s=t.accept.length;a<s;a++){o=t.accept[a].mimeTypes;o&&i.push(o)}if(i.length){n=i.join(",");n=n.replace(/,/g,"|").replace(/\*/g,".*")}}this.accept=n=new RegExp(n,"i");this.hander=e.bindFn(this._pasteHander,this);r.on("paste",this.hander)},_pasteHander:function(e){var t=[],n=this.getRuid(),i,a,s,o,u;e=e.originalEvent||e;i=e.clipboardData.items;for(o=0,u=i.length;o<u;o++){a=i[o];if(a.kind!=="file"||!(s=a.getAsFile())){continue}t.push(new r(n,s))}if(t.length){e.preventDefault();e.stopPropagation();this.trigger("paste",t)}},destroy:function(){this.elem.off("paste",this.hander)}})});t("runtime/html5/filepicker",["base","runtime/html5/runtime"],function(e,t){var r=e.$;return t.register("FilePicker",{init:function(){var e=this.getRuntime().getContainer(),t=this,n=t.owner,i=t.options,a=this.label=r(document.createElement("label")),s=this.input=r(document.createElement("input")),o,u,f,l;s.attr("type","file");s.attr("name",i.name);s.addClass("webuploader-element-invisible");a.on("click",function(){s.trigger("click")});a.css({opacity:0,width:"100%",height:"100%",display:"block",cursor:"pointer",background:"#ffffff"});if(i.multiple){s.attr("multiple","multiple")}if(i.accept&&i.accept.length>0){o=[];for(u=0,f=i.accept.length;u<f;u++){o.push(i.accept[u].mimeTypes)}s.attr("accept",o.join(","))}e.append(s);e.append(a);l=function(e){n.trigger(e.type)};s.on("change",function(e){var i=arguments.callee,a;t.files=e.target.files;a=this.cloneNode(true);a.value=null;this.parentNode.replaceChild(a,this);s.off();s=r(a).on("change",i).on("mouseenter mouseleave",l);n.trigger("change")});a.on("mouseenter mouseleave",l)},getFiles:function(){return this.files},destroy:function(){this.input.off();this.label.off()}})});t("runtime/html5/util",["base"],function(t){var r=e.createObjectURL&&e||e.URL&&URL.revokeObjectURL&&URL||e.webkitURL,n=t.noop,i=n;if(r){n=function(){return r.createObjectURL.apply(r,arguments)};i=function(){return r.revokeObjectURL.apply(r,arguments)}}return{createObjectURL:n,revokeObjectURL:i,dataURL2Blob:function(e){var t,r,n,i,a,s;s=e.split(",");if(~s[0].indexOf("base64")){t=atob(s[1])}else{t=decodeURIComponent(s[1])}n=new ArrayBuffer(t.length);r=new Uint8Array(n);for(i=0;i<t.length;i++){r[i]=t.charCodeAt(i)}a=s[0].split(":")[1].split(";")[0];return this.arrayBufferToBlob(n,a)},dataURL2ArrayBuffer:function(e){var t,r,n,i;i=e.split(",");if(~i[0].indexOf("base64")){t=atob(i[1])}else{t=decodeURIComponent(i[1])}r=new Uint8Array(t.length);for(n=0;n<t.length;n++){r[n]=t.charCodeAt(n)}return r.buffer},arrayBufferToBlob:function(t,r){var n=e.BlobBuilder||e.WebKitBlobBuilder,i;if(n){i=new n;i.append(t);return i.getBlob(r)}return new Blob([t],r?{type:r}:{})},canvasToDataUrl:function(e,t,r){return e.toDataURL(t,r/100)},parseMeta:function(e,t){t(false,{})},updateImageHead:function(e){return e}}});t("runtime/html5/imagemeta",["runtime/html5/util"],function(e){var t;t={parsers:{65505:[]},maxMetaDataSize:262144,parse:function(e,t){var r=this,n=new FileReader;n.onload=function(){t(false,r._parse(this.result));n=n.onload=n.onerror=null};n.onerror=function(e){t(e.message);n=n.onload=n.onerror=null};e=e.slice(0,r.maxMetaDataSize);n.readAsArrayBuffer(e.getSource())},_parse:function(e,r){if(e.byteLength<6){return}var n=new DataView(e),i=2,a=n.byteLength-4,s=i,o={},u,f,l,c;if(n.getUint16(0)===65496){while(i<a){u=n.getUint16(i);if(u>=65504&&u<=65519||u===65534){f=n.getUint16(i+2)+2;if(i+f>n.byteLength){break}l=t.parsers[u];if(!r&&l){for(c=0;c<l.length;c+=1){l[c].call(t,n,i,f,o)}}i+=f;s=i}else{break}}if(s>6){if(e.slice){o.imageHead=e.slice(2,s)}else{o.imageHead=new Uint8Array(e).subarray(2,s)}}}return o},updateImageHead:function(e,t){var r=this._parse(e,true),n,i,a;a=2;if(r.imageHead){a=2+r.imageHead.byteLength}if(e.slice){i=e.slice(a)}else{i=new Uint8Array(e).subarray(a)}n=new Uint8Array(t.byteLength+2+i.byteLength);n[0]=255;n[1]=216;n.set(new Uint8Array(t),2);n.set(new Uint8Array(i),t.byteLength+2);return n.buffer}};e.parseMeta=function(){return t.parse.apply(t,arguments)};e.updateImageHead=function(){return t.updateImageHead.apply(t,arguments)};return t});t("runtime/html5/imagemeta/exif",["base","runtime/html5/imagemeta"],function(e,t){var r={};r.ExifMap=function(){return this};r.ExifMap.prototype.map={Orientation:274};r.ExifMap.prototype.get=function(e){return this[e]||this[this.map[e]]};r.exifTagTypes={1:{getValue:function(e,t){return e.getUint8(t)},size:1},2:{getValue:function(e,t){return String.fromCharCode(e.getUint8(t))},size:1,ascii:true},3:{getValue:function(e,t,r){return e.getUint16(t,r)},size:2},4:{getValue:function(e,t,r){return e.getUint32(t,r)},size:4},5:{getValue:function(e,t,r){return e.getUint32(t,r)/e.getUint32(t+4,r)},size:8},9:{getValue:function(e,t,r){return e.getInt32(t,r)},size:4},10:{getValue:function(e,t,r){return e.getInt32(t,r)/e.getInt32(t+4,r)},size:8}};r.exifTagTypes[7]=r.exifTagTypes[1];r.getExifValue=function(t,n,i,a,s,o){var u=r.exifTagTypes[a],f,l,c,h,d,p;if(!u){e.log("Invalid Exif data: Invalid tag type.");return}f=u.size*s;l=f>4?n+t.getUint32(i+8,o):i+8;if(l+f>t.byteLength){e.log("Invalid Exif data: Invalid data offset.");return}if(s===1){return u.getValue(t,l,o)}c=[];for(h=0;h<s;h+=1){c[h]=u.getValue(t,l+h*u.size,o)}if(u.ascii){d="";for(h=0;h<c.length;h+=1){p=c[h];if(p==="\x00"){break}d+=p}return d}return c};r.parseExifTag=function(e,t,n,i,a){var s=e.getUint16(n,i);a.exif[s]=r.getExifValue(e,t,n,e.getUint16(n+2,i),e.getUint32(n+4,i),i)};r.parseExifTags=function(t,r,n,i,a){var s,o,u;if(n+6>t.byteLength){e.log("Invalid Exif data: Invalid directory offset.");return}s=t.getUint16(n,i);o=n+2+12*s;if(o+4>t.byteLength){e.log("Invalid Exif data: Invalid directory size.");return}for(u=0;u<s;u+=1){this.parseExifTag(t,r,n+2+12*u,i,a)}return t.getUint32(o,i)};r.parseExifData=function(t,n,i,a){var s=n+10,o,u;if(t.getUint32(n+4)!==1165519206){return}if(s+8>t.byteLength){e.log("Invalid Exif data: Invalid segment size.");return}if(t.getUint16(n+8)!==0){e.log("Invalid Exif data: Missing byte alignment offset.");return}switch(t.getUint16(s)){case 18761:o=true;break;case 19789:o=false;break;default:e.log("Invalid Exif data: Invalid byte alignment marker.");return}if(t.getUint16(s+2,o)!==42){e.log("Invalid Exif data: Missing TIFF marker.");return}u=t.getUint32(s+4,o);a.exif=new r.ExifMap;u=r.parseExifTags(t,s,s+u,o,a)};t.parsers[65505].push(r.parseExifData);return r});t("runtime/html5/jpegencoder",[],function(e,t,r){function n(e){var t=this;var r=Math.round;var n=Math.floor;var i=new Array(64);var a=new Array(64);var s=new Array(64);var o=new Array(64);var u;var f;var l;var c;var h=new Array(65535);var d=new Array(65535);var p=new Array(64);var g=new Array(64);var m=[];var v=0;var b=7;var _=new Array(64);var y=new Array(64);var w=new Array(64);var x=new Array(256);var R=new Array(2048);var E;var k=[0,1,5,6,14,15,27,28,2,4,7,13,16,26,29,42,3,8,12,17,25,30,41,43,9,11,18,24,31,40,44,53,10,19,23,32,39,45,52,54,20,22,33,38,46,51,55,60,21,34,37,47,50,56,59,61,35,36,48,49,57,58,62,63];var S=[0,0,1,5,1,1,1,1,1,1,0,0,0,0,0,0,0];var T=[0,1,2,3,4,5,6,7,8,9,10,11];var F=[0,0,2,1,3,3,2,4,3,5,5,4,4,0,0,1,125];var A=[1,2,3,0,4,17,5,18,33,49,65,6,19,81,97,7,34,113,20,50,129,145,161,8,35,66,177,193,21,82,209,240,36,51,98,114,130,9,10,22,23,24,25,26,37,38,39,40,41,42,52,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,225,226,227,228,229,230,231,232,233,234,241,242,243,244,245,246,247,248,249,250];var U=[0,0,3,1,1,1,1,1,1,1,1,1,0,0,0,0,0];var D=[0,1,2,3,4,5,6,7,8,9,10,11];var O=[0,0,2,1,2,4,4,3,4,7,5,4,4,0,1,2,119];var I=[0,1,2,3,17,4,5,33,49,6,18,65,81,7,97,113,19,34,50,129,8,20,66,145,161,177,193,9,35,51,82,240,21,98,114,209,10,22,36,52,225,37,241,23,24,25,26,38,39,40,41,42,53,54,55,56,57,58,67,68,69,70,71,72,73,74,83,84,85,86,87,88,89,90,99,100,101,102,103,104,105,106,115,116,117,118,119,120,121,122,130,131,132,133,134,135,136,137,138,146,147,148,149,150,151,152,153,154,162,163,164,165,166,167,168,169,170,178,179,180,181,182,183,184,185,186,194,195,196,197,198,199,200,201,202,210,211,212,213,214,215,216,217,218,226,227,228,229,230,231,232,233,234,242,243,244,245,246,247,248,249,250];function C(e){var t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99];for(var r=0;r<64;r++){var u=n((t[r]*e+50)/100);if(u<1){u=1}else if(u>255){u=255}i[k[r]]=u}var f=[17,18,24,47,99,99,99,99,18,21,26,66,99,99,99,99,24,26,56,99,99,99,99,99,47,66,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99,99];for(var l=0;l<64;l++){var c=n((f[l]*e+50)/100);if(c<1){c=1}else if(c>255){c=255}a[k[l]]=c}var h=[1,1.387039845,1.306562965,1.175875602,1,.785694958,.5411961,.275899379];var d=0;for(var p=0;p<8;p++){for(var g=0;g<8;g++){s[d]=1/(i[k[d]]*h[p]*h[g]*8);o[d]=1/(a[k[d]]*h[p]*h[g]*8);d++}}}function q(e,t){var r=0;var n=0;var i=new Array;for(var a=1;a<=16;a++){for(var s=1;s<=e[a];s++){i[t[n]]=[];i[t[n]][0]=r;i[t[n]][1]=a;n++;r++}r*=2}return i}function B(){u=q(S,T);f=q(U,D);l=q(F,A);c=q(O,I)}function L(){var e=1;var t=2;for(var r=1;r<=15;r++){for(var n=e;n<t;n++){d[32767+n]=r;h[32767+n]=[];h[32767+n][1]=r;h[32767+n][0]=n}for(var i=-(t-1);i<=-e;i++){d[32767+i]=r;h[32767+i]=[];h[32767+i][1]=r;h[32767+i][0]=t-1+i}e<<=1;t<<=1}}function P(){for(var e=0;e<256;e++){R[e]=19595*e;R[e+256>>0]=38470*e;R[e+512>>0]=7471*e+32768;R[e+768>>0]=-11059*e;R[e+1024>>0]=-21709*e;R[e+1280>>0]=32768*e+8421375;R[e+1536>>0]=-27439*e;R[e+1792>>0]=-5329*e}}function z(e){var t=e[0];var r=e[1]-1;while(r>=0){if(t&1<<r){v|=1<<b}r--;b--;if(b<0){if(v==255){H(255);H(0)}else{H(v)}b=7;v=0}}}function H(e){m.push(x[e])}function M(e){H(e>>8&255);H(e&255)}function j(e,t){var r,n,i,a,s,o,u,f;var l=0;var c;var h=8;var d=64;for(c=0;c<h;++c){r=e[l];n=e[l+1];i=e[l+2];a=e[l+3];s=e[l+4];o=e[l+5];u=e[l+6];f=e[l+7];var g=r+f;var m=r-f;var v=n+u;var b=n-u;var _=i+o;var y=i-o;var w=a+s;var x=a-s;var R=g+w;var E=g-w;var k=v+_;var S=v-_;e[l]=R+k;e[l+4]=R-k;var T=(S+E)*.707106781;e[l+2]=E+T;e[l+6]=E-T;R=x+y;k=y+b;S=b+m;var F=(R-S)*.382683433;var A=.5411961*R+F;var U=1.306562965*S+F;var D=k*.707106781;var O=m+D;var I=m-D;e[l+5]=I+A;e[l+3]=I-A;e[l+1]=O+U;e[l+7]=O-U;l+=8}l=0;for(c=0;c<h;++c){r=e[l];n=e[l+8];i=e[l+16];a=e[l+24];s=e[l+32];o=e[l+40];u=e[l+48];f=e[l+56];var C=r+f;var q=r-f;var B=n+u;var L=n-u;var P=i+o;var z=i-o;var H=a+s;var M=a-s;var j=C+H;var N=C-H;var $=B+P;var Q=B-P;e[l]=j+$;e[l+32]=j-$;var V=(Q+N)*.707106781;e[l+16]=N+V;e[l+48]=N-V;j=M+z;$=z+L;Q=L+q;var G=(j-Q)*.382683433;var W=.5411961*j+G;var J=1.306562965*Q+G;var X=$*.707106781;var Z=q+X;var K=q-X;e[l+40]=K+W;e[l+24]=K-W;e[l+8]=Z+J;e[l+56]=Z-J;l++}var Y;for(c=0;c<d;++c){Y=e[c]*t[c];p[c]=Y>0?Y+.5|0:Y-.5|0}return p}function N(){M(65504);M(16);H(74);H(70);H(73);H(70);H(0);H(1);H(1);H(0);M(1);M(1);H(0);H(0)}function $(e,t){M(65472);M(17);H(8);M(t);M(e);H(3);H(1);H(17);H(0);H(2);H(17);H(1);H(3);H(17);H(1)}function Q(){M(65499);M(132);H(0);for(var e=0;e<64;e++){H(i[e])}H(1);for(var t=0;t<64;t++){H(a[t])}}function V(){M(65476);M(418);H(0);for(var e=0;e<16;e++){H(S[e+1])}for(var t=0;t<=11;t++){H(T[t])}H(16);for(var r=0;r<16;r++){H(F[r+1])}for(var n=0;n<=161;n++){H(A[n])}H(1);for(var i=0;i<16;i++){H(U[i+1])}for(var a=0;a<=11;a++){H(D[a])}H(17);for(var s=0;s<16;s++){H(O[s+1])}for(var o=0;o<=161;o++){H(I[o])}}function G(){M(65498);M(12);H(3);H(1);H(0);H(2);H(17);H(3);H(17);H(0);H(63);H(0)}function W(e,t,r,n,i){var a=i[0];var s=i[240];var o;var u=16;var f=63;var l=64;var c=j(e,t);for(var p=0;p<l;++p){g[k[p]]=c[p]}var m=g[0]-r;r=g[0];if(m==0){z(n[0])}else{o=32767+m;z(n[d[o]]);z(h[o])}var v=63;for(;v>0&&g[v]==0;v--){}if(v==0){z(a);return r}var b=1;var _;while(b<=v){var y=b;for(;g[b]==0&&b<=v;++b){}var w=b-y;if(w>=u){_=w>>4;for(var x=1;x<=_;++x)z(s);w=w&15}o=32767+g[b];z(i[(w<<4)+d[o]]);z(h[o]);b++}if(v!=f){z(a)}return r}function J(){var e=String.fromCharCode;for(var t=0;t<256;t++){x[t]=e(t)}}this.encode=function(e,t){if(t)X(t);m=new Array;v=0;b=7;M(65496);N();Q();$(e.width,e.height);V();G();var r=0;var n=0;var i=0;v=0;b=7;this.encode.displayName="_encode_";var a=e.data;var h=e.width;var d=e.height;var p=h*4;var g=h*3;var x,E=0;var k,S,T;var F,A,U,D,O;while(E<d){x=0;while(x<p){F=p*E+x;A=F;U=-1;D=0;for(O=0;O<64;O++){D=O>>3;U=(O&7)*4;A=F+D*p+U;if(E+D>=d){A-=p*(E+1+D-d)}if(x+U>=p){A-=x+U-p+4}k=a[A++];S=a[A++];T=a[A++];_[O]=(R[k]+R[S+256>>0]+R[T+512>>0]>>16)-128;y[O]=(R[k+768>>0]+R[S+1024>>0]+R[T+1280>>0]>>16)-128;w[O]=(R[k+1280>>0]+R[S+1536>>0]+R[T+1792>>0]>>16)-128}r=W(_,s,r,u,l);n=W(y,o,n,f,c);i=W(w,o,i,f,c);x+=32}E+=8}if(b>=0){var I=[];I[1]=b+1;I[0]=(1<<b+1)-1;z(I)}M(65497);var C="data:image/jpeg;base64,"+btoa(m.join(""));m=[];return C};function X(e){if(e<=0){e=1}if(e>100){e=100}if(E==e)return;var t=0;if(e<50){t=Math.floor(5e3/e)}else{t=Math.floor(200-e*2)}C(t);E=e}function Z(){if(!e)e=50;J();B();L();P();X(e)}Z()}n.encode=function(e,t){var r=new n(t);return r.encode(e)};return n});t("runtime/html5/androidpatch",["runtime/html5/util","runtime/html5/jpegencoder","base"],function(e,t,r){var n=e.canvasToDataUrl,i;e.canvasToDataUrl=function(e,a,s){var o,u,f,l,c;if(!r.os.android){return n.apply(null,arguments)}if(a==="image/jpeg"&&typeof i==="undefined"){l=n.apply(null,arguments);c=l.split(",");if(~c[0].indexOf("base64")){l=atob(c[1])}else{l=decodeURIComponent(c[1])}l=l.substring(0,2);i=l.charCodeAt(0)===255&&l.charCodeAt(1)===216}if(a==="image/jpeg"&&!i){u=e.width;f=e.height;o=e.getContext("2d");return t.encode(o.getImageData(0,0,u,f),s)}return n.apply(null,arguments)}});t("runtime/html5/image",["base","runtime/html5/runtime","runtime/html5/util"],function(e,t,r){var n="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs%3D";return t.register("Image",{modified:false,init:function(){var e=this,t=new Image;t.onload=function(){e._info={type:e.type,width:this.width,height:this.height};if(!e._metas&&"image/jpeg"===e.type){r.parseMeta(e._blob,function(t,r){e._metas=r;e.owner.trigger("load")})}else{e.owner.trigger("load")}};t.onerror=function(){e.owner.trigger("error")};e._img=t},loadFromBlob:function(e){var t=this,n=t._img;t._blob=e;t.type=e.type;n.src=r.createObjectURL(e.getSource());t.owner.once("load",function(){r.revokeObjectURL(n.src)})},resize:function(e,t){var r=this._canvas||(this._canvas=document.createElement("canvas"));this._resize(this._img,r,e,t);this._blob=null;this.modified=true;this.owner.trigger("complete","resize")},crop:function(e,t,r,n,i){var a=this._canvas||(this._canvas=document.createElement("canvas")),s=this.options,o=this._img,u=o.naturalWidth,f=o.naturalHeight,l=this.getOrientation();i=i||1;a.width=r;a.height=n;s.preserveHeaders||this._rotate2Orientaion(a,l);this._renderImageToCanvas(a,o,-e,-t,u*i,f*i);this._blob=null;this.modified=true;this.owner.trigger("complete","crop")},getAsBlob:function(e){var t=this._blob,n=this.options,i;e=e||this.type;if(this.modified||this.type!==e){i=this._canvas;if(e==="image/jpeg"){t=r.canvasToDataUrl(i,e,n.quality);if(n.preserveHeaders&&this._metas&&this._metas.imageHead){t=r.dataURL2ArrayBuffer(t);t=r.updateImageHead(t,this._metas.imageHead);t=r.arrayBufferToBlob(t,e);return t}}else{t=r.canvasToDataUrl(i,e)}t=r.dataURL2Blob(t)}return t},getAsDataUrl:function(e){var t=this.options;e=e||this.type;if(e==="image/jpeg"){return r.canvasToDataUrl(this._canvas,e,t.quality)}else{return this._canvas.toDataURL(e)}},getOrientation:function(){return this._metas&&this._metas.exif&&this._metas.exif.get("Orientation")||1},info:function(e){if(e){this._info=e;return this}return this._info},meta:function(e){if(e){this._meta=e;return this}return this._meta},destroy:function(){var e=this._canvas;this._img.onload=null;if(e){e.getContext("2d").clearRect(0,0,e.width,e.height);e.width=e.height=0;this._canvas=null}this._img.src=n;this._img=this._blob=null},_resize:function(e,t,r,n){var i=this.options,a=e.width,s=e.height,o=this.getOrientation(),u,f,l,c,h;if(~[5,6,7,8].indexOf(o)){r^=n;n^=r;r^=n}u=Math[i.crop?"max":"min"](r/a,n/s);i.allowMagnify||(u=Math.min(1,u));f=a*u;l=s*u;if(i.crop){t.width=r;t.height=n}else{t.width=f;t.height=l}c=(t.width-f)/2;h=(t.height-l)/2;i.preserveHeaders||this._rotate2Orientaion(t,o);this._renderImageToCanvas(t,e,c,h,f,l)},_rotate2Orientaion:function(e,t){var r=e.width,n=e.height,i=e.getContext("2d");switch(t){case 5:case 6:case 7:case 8:e.width=n;e.height=r;break}switch(t){case 2:i.translate(r,0);i.scale(-1,1);break;case 3:i.translate(r,n);i.rotate(Math.PI);break;case 4:i.translate(0,n);i.scale(1,-1);break;case 5:i.rotate(.5*Math.PI);i.scale(1,-1);break;case 6:i.rotate(.5*Math.PI);i.translate(0,-n);break;case 7:i.rotate(.5*Math.PI);i.translate(r,-n);i.scale(-1,1);break;case 8:i.rotate(-.5*Math.PI);i.translate(-r,0);break}},_renderImageToCanvas:function(){if(!e.os.ios){return function(t){var r=e.slice(arguments,1),n=t.getContext("2d");n.drawImage.apply(n,r)}}function t(e,t,r){var n=document.createElement("canvas"),i=n.getContext("2d"),a=0,s=r,o=r,u,f,l;n.width=1;n.height=r;i.drawImage(e,0,0);u=i.getImageData(0,0,1,r).data;while(o>a){f=u[(o-1)*4+3];if(f===0){s=o}else{a=o}o=s+a>>1}l=o/r;return l===0?1:l}if(e.os.ios>=7){return function(e,r,n,i,a,s){var o=r.naturalWidth,u=r.naturalHeight,f=t(r,o,u);return e.getContext("2d").drawImage(r,0,0,o*f,u*f,n,i,a,s)}}function r(e){var t=e.naturalWidth,r=e.naturalHeight,n,i;if(t*r>1024*1024){n=document.createElement("canvas");n.width=n.height=1;i=n.getContext("2d");i.drawImage(e,-t+1,0);return i.getImageData(0,0,1,1).data[3]===0}else{return false}}return function(e,n,i,a,s,o){var u=n.naturalWidth,f=n.naturalHeight,l=e.getContext("2d"),c=r(n),h=this.type==="image/jpeg",d=1024,p=0,g=0,m,v,b,_,y,w,x;if(c){u/=2;f/=2}l.save();m=document.createElement("canvas");m.width=m.height=d;v=m.getContext("2d");b=h?t(n,u,f):1;_=Math.ceil(d*s/u);y=Math.ceil(d*o/f/b);while(p<f){w=0;x=0;while(w<u){v.clearRect(0,0,d,d);v.drawImage(n,-w,-p);l.drawImage(m,0,0,d,d,i+x,a+g,_,y);w+=d;x+=_}p+=d;g+=y}l.restore();m=v=null}}()})});t("runtime/html5/transport",["base","runtime/html5/runtime"],function(e,t){var r=e.noop,n=e.$;return t.register("Transport",{init:function(){this._status=0;this._response=null},send:function(){var t=this.owner,r=this.options,i=this._initAjax(),a=t._blob,s=r.server,o,u,f;if(r.sendAsBinary){s+=(/\?/.test(s)?"&":"?")+n.param(t._formData);u=a.getSource()}else{o=new FormData;n.each(t._formData,function(e,t){o.append(e,t)});o.append(r.fileVal,a.getSource(),r.filename||t._formData.name||"")}if(r.withCredentials&&"withCredentials"in i){i.open(r.method,s,true);i.withCredentials=true}else{i.open(r.method,s)}this._setRequestHeader(i,r.headers);if(u){i.overrideMimeType&&i.overrideMimeType("application/octet-stream");if(e.os.android){f=new FileReader;f.onload=function(){i.send(this.result);f=f.onload=null};f.readAsArrayBuffer(u)}else{i.send(u)}}else{i.send(o)}},getResponse:function(){return this._response},getResponseAsJson:function(){return this._parseJson(this._response)},getStatus:function(){return this._status},abort:function(){var e=this._xhr;if(e){e.upload.onprogress=r;e.onreadystatechange=r;e.abort();this._xhr=e=null}},destroy:function(){this.abort()},_initAjax:function(){var e=this,t=new XMLHttpRequest,n=this.options;if(n.withCredentials&&!("withCredentials"in t)&&typeof XDomainRequest!=="undefined"){t=new XDomainRequest}t.upload.onprogress=function(t){var r=0;if(t.lengthComputable){r=t.loaded/t.total}return e.trigger("progress",r)};t.onreadystatechange=function(){if(t.readyState!==4){return}t.upload.onprogress=r;t.onreadystatechange=r;e._xhr=null;e._status=t.status;if(t.status>=200&&t.status<300){e._response=t.responseText;return e.trigger("load")}else if(t.status>=500&&t.status<600){e._response=t.responseText;return e.trigger("error","server")}return e.trigger("error",e._status?"http":"abort")};e._xhr=t;return t},_setRequestHeader:function(e,t){n.each(t,function(t,r){e.setRequestHeader(t,r)})},_parseJson:function(e){var t;try{t=JSON.parse(e)}catch(r){t={}}return t}})});t("runtime/html5/md5",["runtime/html5/runtime"],function(e){var t=function(e,t){return e+t&4294967295},r=function(e,r,n,i,a,s){r=t(t(r,e),t(i,s));return t(r<<a|r>>>32-a,n)},n=function(e,t,n,i,a,s,o){return r(t&n|~t&i,e,t,a,s,o)},i=function(e,t,n,i,a,s,o){return r(t&i|n&~i,e,t,a,s,o)},a=function(e,t,n,i,a,s,o){return r(t^n^i,e,t,a,s,o)},s=function(e,t,n,i,a,s,o){return r(n^(t|~i),e,t,a,s,o)},o=function(e,r){var o=e[0],u=e[1],f=e[2],l=e[3];o=n(o,u,f,l,r[0],7,-680876936);l=n(l,o,u,f,r[1],12,-389564586);f=n(f,l,o,u,r[2],17,606105819);u=n(u,f,l,o,r[3],22,-1044525330);o=n(o,u,f,l,r[4],7,-176418897);l=n(l,o,u,f,r[5],12,1200080426);f=n(f,l,o,u,r[6],17,-1473231341);u=n(u,f,l,o,r[7],22,-45705983);o=n(o,u,f,l,r[8],7,1770035416);l=n(l,o,u,f,r[9],12,-1958414417);f=n(f,l,o,u,r[10],17,-42063);u=n(u,f,l,o,r[11],22,-1990404162);o=n(o,u,f,l,r[12],7,1804603682);l=n(l,o,u,f,r[13],12,-40341101);f=n(f,l,o,u,r[14],17,-1502002290);u=n(u,f,l,o,r[15],22,1236535329);o=i(o,u,f,l,r[1],5,-165796510);l=i(l,o,u,f,r[6],9,-1069501632);f=i(f,l,o,u,r[11],14,643717713);u=i(u,f,l,o,r[0],20,-373897302);o=i(o,u,f,l,r[5],5,-701558691);l=i(l,o,u,f,r[10],9,38016083);f=i(f,l,o,u,r[15],14,-660478335);u=i(u,f,l,o,r[4],20,-405537848);o=i(o,u,f,l,r[9],5,568446438);l=i(l,o,u,f,r[14],9,-1019803690);f=i(f,l,o,u,r[3],14,-187363961);u=i(u,f,l,o,r[8],20,1163531501);o=i(o,u,f,l,r[13],5,-1444681467);l=i(l,o,u,f,r[2],9,-51403784);f=i(f,l,o,u,r[7],14,1735328473);u=i(u,f,l,o,r[12],20,-1926607734);o=a(o,u,f,l,r[5],4,-378558);l=a(l,o,u,f,r[8],11,-2022574463);f=a(f,l,o,u,r[11],16,1839030562);u=a(u,f,l,o,r[14],23,-35309556);o=a(o,u,f,l,r[1],4,-1530992060);l=a(l,o,u,f,r[4],11,1272893353);f=a(f,l,o,u,r[7],16,-155497632);u=a(u,f,l,o,r[10],23,-1094730640);o=a(o,u,f,l,r[13],4,681279174);l=a(l,o,u,f,r[0],11,-358537222);f=a(f,l,o,u,r[3],16,-722521979);u=a(u,f,l,o,r[6],23,76029189);o=a(o,u,f,l,r[9],4,-640364487);l=a(l,o,u,f,r[12],11,-421815835);f=a(f,l,o,u,r[15],16,530742520);u=a(u,f,l,o,r[2],23,-995338651);o=s(o,u,f,l,r[0],6,-198630844);l=s(l,o,u,f,r[7],10,1126891415);f=s(f,l,o,u,r[14],15,-1416354905);u=s(u,f,l,o,r[5],21,-57434055);o=s(o,u,f,l,r[12],6,1700485571);l=s(l,o,u,f,r[3],10,-1894986606);f=s(f,l,o,u,r[10],15,-1051523);u=s(u,f,l,o,r[1],21,-2054922799);o=s(o,u,f,l,r[8],6,1873313359);l=s(l,o,u,f,r[15],10,-30611744);f=s(f,l,o,u,r[6],15,-1560198380);u=s(u,f,l,o,r[13],21,1309151649);o=s(o,u,f,l,r[4],6,-145523070);l=s(l,o,u,f,r[11],10,-1120210379);f=s(f,l,o,u,r[2],15,718787259);u=s(u,f,l,o,r[9],21,-343485551);e[0]=t(o,e[0]);e[1]=t(u,e[1]);e[2]=t(f,e[2]);e[3]=t(l,e[3])},u=function(e){var t=[],r;for(r=0;r<64;r+=4){t[r>>2]=e.charCodeAt(r)+(e.charCodeAt(r+1)<<8)+(e.charCodeAt(r+2)<<16)+(e.charCodeAt(r+3)<<24)}return t},f=function(e){var t=[],r;for(r=0;r<64;r+=4){t[r>>2]=e[r]+(e[r+1]<<8)+(e[r+2]<<16)+(e[r+3]<<24)}return t},l=function(e){var t=e.length,r=[1732584193,-271733879,-1732584194,271733878],n,i,a,s,f,l;for(n=64;n<=t;n+=64){o(r,u(e.substring(n-64,n)))}e=e.substring(n-64);i=e.length;a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(n=0;n<i;n+=1){a[n>>2]|=e.charCodeAt(n)<<(n%4<<3)}a[n>>2]|=128<<(n%4<<3);if(n>55){o(r,a);for(n=0;n<16;n+=1){a[n]=0}}s=t*8;s=s.toString(16).match(/(.*?)(.{0,8})$/);f=parseInt(s[2],16);l=parseInt(s[1],16)||0;a[14]=f;a[15]=l;o(r,a);return r},c=function(e){var t=e.length,r=[1732584193,-271733879,-1732584194,271733878],n,i,a,s,u,l;for(n=64;n<=t;n+=64){o(r,f(e.subarray(n-64,n)))}e=n-64<t?e.subarray(n-64):new Uint8Array(0);i=e.length;a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(n=0;n<i;n+=1){a[n>>2]|=e[n]<<(n%4<<3)}a[n>>2]|=128<<(n%4<<3);if(n>55){o(r,a);for(n=0;n<16;n+=1){a[n]=0}}s=t*8;s=s.toString(16).match(/(.*?)(.{0,8})$/);u=parseInt(s[2],16);l=parseInt(s[1],16)||0;a[14]=u;a[15]=l;o(r,a);return r},h=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"],d=function(e){var t="",r;
for(r=0;r<4;r+=1){t+=h[e>>r*8+4&15]+h[e>>r*8&15]}return t},p=function(e){var t;for(t=0;t<e.length;t+=1){e[t]=d(e[t])}return e.join("")},g=function(e){return p(l(e))},m=function(){this.reset()};if(g("hello")!=="5d41402abc4b2a76b9719d911017c592"){t=function(e,t){var r=(e&65535)+(t&65535),n=(e>>16)+(t>>16)+(r>>16);return n<<16|r&65535}}m.prototype.append=function(e){if(/[\u0080-\uFFFF]/.test(e)){e=unescape(encodeURIComponent(e))}this.appendBinary(e);return this};m.prototype.appendBinary=function(e){this._buff+=e;this._length+=e.length;var t=this._buff.length,r;for(r=64;r<=t;r+=64){o(this._state,u(this._buff.substring(r-64,r)))}this._buff=this._buff.substr(r-64);return this};m.prototype.end=function(e){var t=this._buff,r=t.length,n,i=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a;for(n=0;n<r;n+=1){i[n>>2]|=t.charCodeAt(n)<<(n%4<<3)}this._finish(i,r);a=!!e?this._state:p(this._state);this.reset();return a};m.prototype._finish=function(e,t){var r=t,n,i,a;e[r>>2]|=128<<(r%4<<3);if(r>55){o(this._state,e);for(r=0;r<16;r+=1){e[r]=0}}n=this._length*8;n=n.toString(16).match(/(.*?)(.{0,8})$/);i=parseInt(n[2],16);a=parseInt(n[1],16)||0;e[14]=i;e[15]=a;o(this._state,e)};m.prototype.reset=function(){this._buff="";this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];return this};m.prototype.destroy=function(){delete this._state;delete this._buff;delete this._length};m.hash=function(e,t){if(/[\u0080-\uFFFF]/.test(e)){e=unescape(encodeURIComponent(e))}var r=l(e);return!!t?r:p(r)};m.hashBinary=function(e,t){var r=l(e);return!!t?r:p(r)};m.ArrayBuffer=function(){this.reset()};m.ArrayBuffer.prototype.append=function(e){var t=this._concatArrayBuffer(this._buff,e),r=t.length,n;this._length+=e.byteLength;for(n=64;n<=r;n+=64){o(this._state,f(t.subarray(n-64,n)))}this._buff=n-64<r?t.subarray(n-64):new Uint8Array(0);return this};m.ArrayBuffer.prototype.end=function(e){var t=this._buff,r=t.length,n=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],i,a;for(i=0;i<r;i+=1){n[i>>2]|=t[i]<<(i%4<<3)}this._finish(n,r);a=!!e?this._state:p(this._state);this.reset();return a};m.ArrayBuffer.prototype._finish=m.prototype._finish;m.ArrayBuffer.prototype.reset=function(){this._buff=new Uint8Array(0);this._length=0;this._state=[1732584193,-271733879,-1732584194,271733878];return this};m.ArrayBuffer.prototype.destroy=m.prototype.destroy;m.ArrayBuffer.prototype._concatArrayBuffer=function(e,t){var r=e.length,n=new Uint8Array(r+t.byteLength);n.set(e);n.set(new Uint8Array(t),r);return n};m.ArrayBuffer.hash=function(e,t){var r=c(new Uint8Array(e));return!!t?r:p(r)};return e.register("Md5",{init:function(){},loadFromBlob:function(e){var t=e.getSource(),r=2*1024*1024,n=Math.ceil(t.size/r),i=0,a=this.owner,s=new m.ArrayBuffer,o=this,u=t.mozSlice||t.webkitSlice||t.slice,f,l;l=new FileReader;f=function(){var c,h;c=i*r;h=Math.min(c+r,t.size);l.onload=function(t){s.append(t.target.result);a.trigger("progress",{total:e.size,loaded:h})};l.onloadend=function(){l.onloadend=l.onload=null;if(++i<n){setTimeout(f,1)}else{setTimeout(function(){a.trigger("load");o.result=s.end();f=e=t=s=null;a.trigger("complete")},50)}};l.readAsArrayBuffer(u.call(t,c,h))};f()},getResult:function(){return this.result}})});t("runtime/flash/runtime",["base","runtime/runtime","runtime/compbase"],function(t,r,n){var i=t.$,a="flash",s={};function o(){var e;try{e=navigator.plugins["Shockwave Flash"];e=e.description}catch(t){try{e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(r){e="0.0"}}e=e.match(/\d+/g);return parseFloat(e[0]+"."+e[1],10)}function u(){var n={},i={},o=this.destroy,u=this,f=t.guid("webuploader_");r.apply(u,arguments);u.type=a;u.exec=function(e,r){var a=this,o=a.uid,f=t.slice(arguments,2),l;i[o]=a;if(s[e]){if(!n[o]){n[o]=new s[e](a,u)}l=n[o];if(l[r]){return l[r].apply(l,f)}}return u.flashExec.apply(a,arguments)};function l(e,t){var r=e.type||e,n,a;n=r.split("::");a=n[0];r=n[1];if(r==="Ready"&&a===u.uid){u.trigger("ready")}else if(i[a]){i[a].trigger(r.toLowerCase(),e,t)}}e[f]=function(){var e=arguments;setTimeout(function(){l.apply(null,e)},1)};this.jsreciver=f;this.destroy=function(){return o&&o.apply(this,arguments)};this.flashExec=function(e,r){var n=u.getFlash(),i=t.slice(arguments,2);return n.exec(this.uid,e,r,i)}}t.inherits(r,{constructor:u,init:function(){var e=this.getContainer(),r=this.options,n;e.css({position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});n='<object id="'+this.uid+'" type="application/'+'x-shockwave-flash" data="'+r.swf+'" ';if(t.browser.ie){n+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '}n+='width="100%" height="100%" style="outline:0">'+'<param name="movie" value="'+r.swf+'" />'+'<param name="flashvars" value="uid='+this.uid+"&jsreciver="+this.jsreciver+'" />'+'<param name="wmode" value="transparent" />'+'<param name="allowscriptaccess" value="always" />'+"</object>";e.html(n)},getFlash:function(){if(this._flash){return this._flash}this._flash=i("#"+this.uid).get(0);return this._flash}});u.register=function(e,r){r=s[e]=t.inherits(n,i.extend({flashExec:function(){var e=this.owner,t=this.getRuntime();return t.flashExec.apply(e,arguments)}},r));return r};if(o()>=11.4){r.addRuntime(a,u)}return u});t("runtime/flash/filepicker",["base","runtime/flash/runtime"],function(e,t){var r=e.$;return t.register("FilePicker",{init:function(e){var t=r.extend({},e),n,i;n=t.accept&&t.accept.length;for(i=0;i<n;i++){if(!t.accept[i].title){t.accept[i].title="Files"}}delete t.button;delete t.id;delete t.container;this.flashExec("FilePicker","init",t)},destroy:function(){this.flashExec("FilePicker","destroy")}})});t("runtime/flash/image",["runtime/flash/runtime"],function(e){return e.register("Image",{loadFromBlob:function(e){var t=this.owner;t.info()&&this.flashExec("Image","info",t.info());t.meta()&&this.flashExec("Image","meta",t.meta());this.flashExec("Image","loadFromBlob",e.uid)}})});t("runtime/flash/transport",["base","runtime/flash/runtime","runtime/client"],function(t,r,n){var i=t.$;return r.register("Transport",{init:function(){this._status=0;this._response=null;this._responseJson=null},send:function(){var e=this.owner,t=this.options,r=this._initAjax(),n=e._blob,a=t.server,s;r.connectRuntime(n.ruid);if(t.sendAsBinary){a+=(/\?/.test(a)?"&":"?")+i.param(e._formData);s=n.uid}else{i.each(e._formData,function(e,t){r.exec("append",e,t)});r.exec("appendBlob",t.fileVal,n.uid,t.filename||e._formData.name||"")}this._setRequestHeader(r,t.headers);r.exec("send",{method:t.method,url:a,forceURLStream:t.forceURLStream,mimeType:"application/octet-stream"},s)},getStatus:function(){return this._status},getResponse:function(){return this._response||""},getResponseAsJson:function(){return this._responseJson},abort:function(){var e=this._xhr;if(e){e.exec("abort");e.destroy();this._xhr=e=null}},destroy:function(){this.abort()},_initAjax:function(){var t=this,r=new n("XMLHttpRequest");r.on("uploadprogress progress",function(e){var r=e.loaded/e.total;r=Math.min(1,Math.max(0,r));return t.trigger("progress",r)});r.on("load",function(){var n=r.exec("getStatus"),i=false,a="",s;r.off();t._xhr=null;if(n>=200&&n<300){i=true}else if(n>=500&&n<600){i=true;a="server"}else{a="http"}if(i){t._response=r.exec("getResponse");t._response=decodeURIComponent(t._response);s=e.JSON&&e.JSON.parse||function(e){try{return new Function("return "+e).call()}catch(t){return{}}};t._responseJson=t._response?s(t._response):{}}r.destroy();r=null;return a?t.trigger("error",a):t.trigger("load")});r.on("error",function(){r.off();t._xhr=null;t.trigger("error","http")});t._xhr=r;return r},_setRequestHeader:function(e,t){i.each(t,function(t,r){e.exec("setRequestHeader",t,r)})}})});t("runtime/flash/blob",["runtime/flash/runtime","lib/blob"],function(e,t){return e.register("Blob",{slice:function(e,r){var n=this.flashExec("Blob","slice",e,r);return new t(n.uid,n)}})});t("runtime/flash/md5",["runtime/flash/runtime"],function(e){return e.register("Md5",{init:function(){},loadFromBlob:function(e){return this.flashExec("Md5","loadFromBlob",e.uid)}})});t("preset/all",["base","widgets/filednd","widgets/filepaste","widgets/filepicker","widgets/image","widgets/queue","widgets/runtime","widgets/upload","widgets/validator","widgets/md5","runtime/html5/blob","runtime/html5/dnd","runtime/html5/filepaste","runtime/html5/filepicker","runtime/html5/imagemeta/exif","runtime/html5/androidpatch","runtime/html5/image","runtime/html5/transport","runtime/html5/md5","runtime/flash/filepicker","runtime/flash/image","runtime/flash/transport","runtime/flash/blob","runtime/flash/md5"],function(e){return e});t("widgets/log",["base","uploader","widgets/widget"],function(e,t){var r=e.$,n=" http://static.tieba.baidu.com/tb/pms/img/st.gif??",i=(location.hostname||location.host||"protected").toLowerCase(),a=i&&/baidu/i.exec(i),s;if(!a){return}s={dv:3,master:"webuploader",online:/test/.exec(i)?0:1,module:"",product:i,type:0};function o(e){var t=r.extend({},s,e),i=n.replace(/^(.*)\?/,"$1"+r.param(t)),a=new Image;a.src=i}return t.register({name:"log",init:function(){var e=this.owner,t=0,r=0;e.on("error",function(e){o({type:2,c_error_code:e})}).on("uploadError",function(e,t){o({type:2,c_error_code:"UPLOAD_ERROR",c_reason:""+t})}).on("uploadComplete",function(e){t++;r+=e.size}).on("uploadFinished",function(){o({c_count:t,c_size:r});t=r=0});o({c_usage:1})}})});t("webuploader",["preset/all","widgets/log"],function(e){return e});return r("webuploader")});