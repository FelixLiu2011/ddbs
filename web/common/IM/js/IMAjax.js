$.IM = { /*$.fn.returnTime(time,full)*/
    languageListStr: '<ul class="lanUl"><li langs-lang="en">English</li><li langs-lang="zh">简体中文</li> <li langs-lang="cht">繁體中文</li><li langs-lang="kor">한국어</li> <li langs-lang="ru">Pусский</li><li langs-lang="de">Deutsch</li><li langs-lang="spa">Español</li><li langs-lang="jp">日本語</li></ul>',
    qqOld:{
        emCn:{
        '[微笑]':'0',
        '[撇嘴]':'1',
        '[色]':'2',
        '[发呆]':'3',
        '[得意]':'4',
        '[流泪]':'5',
        '[害羞]':'6',
        '[闭嘴]':'7',
        '[睡]':'8',
        '[大哭]':'9',
        '[尴尬]':'10',
        '[发怒]':'11',
        '[调皮]':'12',
        '[龇牙]':'13',
        '[惊讶]':'14',
        '[难过]':'15',
        '[酷]':'16',
        '[冷汗]':'17',
        '[抓狂]':'18',
        '[吐]':'19',
        '[偷笑]':'20',
        '[可爱]':'21',
        '[白眼]':'22',
        '[傲慢]':'23',
        '[饥饿]':'24',
        '[困]':'25',
        '[惊恐]':'26',
        '[流汗]':'27',
        '[憨笑]':'28',
        '[大兵]':'29',
        '[奋斗]':'30',
        '[咒骂]':'31',
        '[疑问]':'32',
        '[嘘]':'33',
        '[晕]':'34',
        '[折磨]':'35',
        '[衰]':'36',
        '[骷髅]':'37',
        '[敲打]':'38',
        '[再见]':'39',
        '[擦汗]':'40',
        '[抠鼻]':'41',
        '[鼓掌]':'42',
        '[糗大了]':'43',
        '[坏笑]':'44',
        '[左哼哼]':'45',
        '[右哼哼]':'46',
        '[哈欠]':'47',
        '[鄙视]':'48',
        '[委屈]':'49',
        '[快哭了]':'50',
        '[阴险]':'51',
        '[亲亲]':'52',
        '[吓]':'53',
        '[可怜]':'54',
        '[菜刀]':'55',
        '[西瓜]':'56',
        '[啤酒]':'57',
        '[篮球]':'58',
        '[乒乓]':'59',
        '[咖啡]':'60',
        '[饭]':'61',
        '[猪头]':'62',
        '[玫瑰]':'63',
        '[凋谢]':'64',
        '[示爱]':'65',
        '[爱心]':'66',
        '[心碎]':'67',
        '[蛋糕]':'68',
        '[闪电]':'69',
        '[炸弹]':'70',
        '[刀]':'71',
        '[足球]':'72',
        '[瓢虫]':'73',
        '[屎]':'74',
        '[月亮]':'75',
        '[太阳]':'76',
        '[礼物]':'77',
        '[抱抱]':'78',
        '[强]':'79',
        '[弱]':'80',
        '[握手]':'81',
        '[胜利]':'82',
        '[抱拳]':'83',
        '[勾引]':'84',
        '[拳头]':'85',
        '[差劲]':'86',
        '[爱你]':'87',
        '[NO]':'88',
        '[OK]':'89',
        '[爱情]':'90',
        '[飞吻]':'91',
        '[跳跳]':'92',
        '[发抖]':'93',
        '[怄火]':'94',
        '[转圈]':'95',
        '[磕头]':'96',
        '[回头]':'97',
        '[跳绳]':'98',
        '[挥手]':'99',
        '[激动]':'100',
        '[街舞]':'101',
        '[献吻]':'102',
        '[左太极]':'103',
        '[右太极]':'104'
        },
        emEn:{
        '[Smile]':'0',
        '[Grimace]':'1',
        '[Drooling]':'2',
        '[Scowl]':'3',
        '[Chill]':'4',
        '[Sob]':'5',
        '[Shy]':'6',
        '[Silence]':'7',
        '[Sleep]':'8',
        '[Cry]':'9',
        '[Embarrassed]':'10',
        '[On fire]':'11',
        '[Wink]':'12',
        '[Grin]':'13',
        '[Surprised]':'14',
        '[Sad]':'15',
        '[Cool]':'16',
        '[Frightened]':'17',
        '[Scream]':'18',
        '[Puke]':'19',
        '[Chuckle]':'20',
        '[Lovely]':'21',
        '[Sneer]':'22',
        '[Arrogant]':'23',
        '[Hungry]':'24',
        '[Drowsy]':'25',
        '[Panic]':'26',
        '[Sweating]':'27',
        '[Laugh]':'28',
        '[Soldier]':'29',
        '[strive]':'30',
        '[Scold]':'31',
        '[Confused]':'32',
        '[Shhh]':'33',
        '[Hypnotized]':'34',
        '[Torment]':'35',
        '[Frustrated]':'36',
        '[Skull]':'37',
        '[Hammer]':'38',
        '[Wave/Bye]':'39',
        '[Relived/Wipe]':'40',
        '[Pick nose]':'41',
        '[Applause]':'42',
        '[Flushed]':'43',
        '[Hellooo]':'44',
        '[Snub1]':'45',
        '[Snub2]':'46',
        '[Yawn]':'47',
        '[Booo]':'48',
        '[Distressed]':'49',
        '[Sniffle]':'50',
        '[Sly]':'51',
        '[Pucker]':'52',
        '[Scared]':'53',
        '[Pathetic]':'54',
        '[Cleaver]':'55',
        '[Water Melon]':'56',
        '[Beer]':'57',
        '[Basketball]':'58',
        '[Ping Pong]':'59',
        '[Coffee]':'60',
        '[Rice]':'61',
        '[Pig]':'62',
        '[Rose]':'63',
        '[Fade]':'64',
        '[Kisses]':'65',
        '[Heart]':'66',
        '[Broken Heart]':'67',
        '[Cake]':'68',
        '[Lightning]':'69',
        '[Bomb]':'70',
        '[Dagger]':'71',
        '[Football]':'72',
        '[Ladybug]':'73',
        '[Shit]':'74',
        '[Moon]':'75',
        '[Sun]':'76',
        '[Gift]':'77',
        '[Hug]':'78',
        '[Strong]':'79',
        '[Weak]':'80',
        '[Shake]':'81',
        '[Victory]':'82',
        '[Admire]':'83',
        '[Beckon]':'84',
        '[Fist]':'85',
        '[Pinky]':'86',
        '[ILoveU]':'87',
        '[NO]':'88',
        '[OK]':'89',
        '[Love]':'90',
        '[Flying Kiss]':'91',
        '[Jump]':'92',
        '[Tremble]':'93',
        '[Aaagh]':'94',
        '[Circle]':'95',
        '[Kotow]':'96',
        '[Turn]':'97',
        '[Skip]':'98',
        '[Surrnder]':'99',
        '[Hooray]':'100',
        '[Hippop]':'101',
        '[Smooches]':'102',
        '[Fighting Girl]':'103',
        '[Fighting Boy]':'104'
        }
    },
    winH: "",
    winW: "",
    shieldArr: [],
    timeArr: {},
    showTab: "contacts",
    currentpage: 1,
    PageCount: 0,
    createGroupsMember: [],
    originalGroupsMember: [], ///群原先成员
    inviteFriendsMember: [], //已有群成员
    signID: "",
    /*-----历史记录用---区分人，组----*/
    remarkName: "",
    /*-----历史记录用-----人--显示备注-----*/
    myMoneyNum: 0,
    myCharacterNum: 0,
    isSendComplate: true,
    /*---判断群修改备注---*/
    isReduction:"",
    /*----判断鼠标点击还是拖动----------*/
    isClick:true,
    init: function() {
        var getContactsDate = new Date();
        var that = this;
        // 好友列表请求
        $.ajax({
            type: "get",
            url: ctx + "/im/findFriendList?"+getContactsDate.getTime(),
            // data:{},
            async: true,
            dataType: "json",
            success: function(reg) {
                //console.log("好友列表请求:"+JSON.stringify(reg));
                //console.log("好友列表请求:"+reg);
                // onlineNum：在线数；tolNum：所有好友；frieFriendgagaID：好友ID；friegagaID：自己ID；frieNickname：好友昵称；membBigimg：好友头像;在线状态：online；//frieIsshield:0:不屏蔽1:屏蔽;
                if (reg.success) {
                    $("#friendGroup .friendNum").text(reg.attributes.onlineNum);
                    $("#onLineGroup .onLineNum").text(reg.attributes.onlineNum);
                    $("#friendGroup .friendNumTotal").text((reg.attributes.tolNum + 1));
                    var friendShowLi = "";
                    var friendHideLi = "";
                    for (var i = 0; i < reg.obj.length; i++) {
                        friendShowLi += '<li class="showContent" data-signID="people" data-gagaID="' + reg.obj[i].frieFriendgagaid + '" data-remarkname="' + reg.obj[i].frieNickname + '" data-nickName="' + reg.obj[i].member.membNickname + '" data-shield="' + reg.obj[i].frieIsshield + '" data-onLine="' + reg.obj[i].online + '" data-Language="' + reg.obj[i].member.membLanguage + '">' +
                            '<div class="showHead"> <img class="headImg" src="' + qiniuImgURL + reg.obj[i].member.membBigimg + '">';
                        if (i % 2 == 1) {
                            friendHideLi += '<li class="content singleNum" data-signID="people" data-gagaID="' + reg.obj[i].frieFriendgagaid + '" data-remarkname="' + reg.obj[i].frieNickname + '" data-nickName="' + reg.obj[i].member.membNickname + '" data-shield="' + reg.obj[i].frieIsshield + '" data-onLine="' + reg.obj[i].online + '" data-Language="' + reg.obj[i].member.membLanguage + '">';
                        } else {
                            friendHideLi += '<li class="content bothNum" data-signID="people" data-gagaID="' + reg.obj[i].frieFriendgagaid + '" data-remarkname="' + reg.obj[i].frieNickname + '" data-nickName="' + reg.obj[i].member.membNickname + '"  data-shield="' + reg.obj[i].frieIsshield + '" data-onLine="' + reg.obj[i].online + '" data-Language="' + reg.obj[i].member.membLanguage + '">';
                        }
                        friendHideLi += '<div class="headDiv"><img class="headImg" src="' + qiniuImgURL + reg.obj[i].member.membBigimg + '">';
                        //console.log("是否在线:"+reg.obj[i].online);
                        if (reg.obj[i].frieIsshield == 1) {
                            that.shieldArr.push("" + reg.obj[i].frieFriendgagaid);
                            friendShowLi += '<img class="headLine" src="' + staticCtx + 'img/shield.png" style="display:block">';
                            friendHideLi += '<img class="headLine" src="' + staticCtx + 'img/shield.png" style="display:block">';
                        } else {
                            if (reg.obj[i].online == "1") {
                                friendShowLi += '<img class="headLine" src="' + staticCtx + 'img/On-line.png" style="display:block">';
                                friendHideLi += '<img class="headLine" src="' + staticCtx + 'img/On-line.png" style="display:block">';
                            } else {
                                friendShowLi += '<img class="headLine" src="' + staticCtx + 'img/On-line.png" style="display:none">';
                                friendHideLi += '<img class="headLine" src="' + staticCtx + 'img/On-line.png" style="display:none">';
                            }
                        }

                        friendShowLi += '</div><span class="showRemarkName">' + reg.obj[i].frieNickname + '</span><span class="newsNum newsNumSingle" style="display:none">0</span></li>';
                        friendHideLi += '</div></li>';
                    }
                    $("#friendGroup .friendContainer").append(friendShowLi);
                    $("#hiddenIM .hiddenContactsCon").append(friendHideLi);
                    $("#js-contactsScrollBar").mCustomScrollbar("update");
                    $("#js-hiddenScrollBar").mCustomScrollbar("update");
      
                     $("#friendGroup .friendContainer .showContent").each(function(i){
                          if($(this).attr("data-online")=="1"){
                                 $("#onLineGroup .FoldContainer").prepend($(this).clone());
                           }
                           
                      });       
                } else {};
            },
            error: function() {

            }
        });
        // 最近联系人列表请求
        $.ajax({
            type: "get",
            url: ctx + "/im/getContacts?"+getContactsDate.getTime(),
            // data:{},
            async: true,
            dataType: "json",
            success: function(reg) {
                var showHide = "false";
                /*dl: 0frid: 对方IDgid: 组IDid: "56dffac0e8293109bf59ed94"membBigimg: //头像地址membGagaid: null//用户IDmembNickname: "飞翔的杰克1"nm: 未读数online: 0：不在线，1：在线pb: 1：屏蔽，0：不屏蔽toid: nulltype: 1：群聊/0：单聊ut: 1457501091874*/
                //console.log("最近联系人列表:" + JSON.stringify(reg));
                //console.log("最近联系人列表:" + reg);
                if (reg.success) {
                    $("#recentlyGroup .recentlyNum").text((reg.attributes.recentlyNum + 1));
                    var friendShowLi = "";
                    for (var i = 0; i < reg.obj.length; i++) {
                        if (reg.obj[i].type == "0") {
                            friendShowLi += '<li class="showContent" data-signID="people" data-gagaID="' + reg.obj[i].frid + '" data-remarkname="' + reg.obj[i].membNickname + '" data-nickName="' + reg.obj[i].ymembNickname + '" data-shield="' + reg.obj[i].pb + '" data-onLine="' + reg.obj[i].online + '" data-Language="' + reg.obj[i].membLanguage + '">' +
                                '<div class="showHead"> <img class="headImg" src="' + qiniuImgURL + reg.obj[i].membBigimg + '">';
                        } else {
                            friendShowLi += '<li class="showContent" data-signID="group" data-gagaID="' + reg.obj[i].frid + '" data-remarkname="' + reg.obj[i].membNickname + '" data-nickName="' + reg.obj[i].ymembNickname + '" data-shield="' + reg.obj[i].pb + '" data-onLine="' + reg.obj[i].online + '" data-Language="' + reg.obj[i].membLanguage + '">' +
                                '<div class="showHead"> <img class="headImg" src="' + staticCtx + 'img/group.png">';
                        }
                        if (reg.obj[i].pb == 1) {
                            friendShowLi += '<img class="headLine" src="' + staticCtx + 'img/shield.png" style="display:block">';
                        } else {
                            if (reg.obj[i].online == "1" && reg.obj[i].type == "0") {
                                friendShowLi += '<img class="headLine" src="' + staticCtx + 'img/On-line.png" style="display:block">';
                            } else {
                                friendShowLi += '<img class="headLine" src="' + staticCtx + 'img/On-line.png" style="display:none">';
                            }
                        }
                        friendShowLi += '</div><span class="showRemarkName">' + reg.obj[i].membNickname + '</span>';
                        if (reg.obj[i].pb == 0) {
                            if( reg.obj[i].nm > 99){
                                showHide = "true";
                                friendShowLi += '<span class="newsNum newsNumDouble">99+</span></li>'; 
                            }else if(reg.obj[i].nm > 0 && reg.obj[i].nm<100){
                                showHide = "true";
                               friendShowLi += '<span class="newsNum newsNumSingle">' + reg.obj[i].nm + '</span></li>';
                            }else{
                               friendShowLi += '<span class="newsNum newsNumSingle" style="display:none">0</span></li>'; 
                            }
                            
                        } else {
                            friendShowLi += '<span class="newsNum newsNumSingle" style="display:none">0</span></li>';
                        }
                    }
                    $("#recentlyGroup .recentlyContainer").append(friendShowLi);
                    $("#js-contactsScrollBar").mCustomScrollbar("update");
                    if (showHide == "true") {
                        $("#js-newsArrive").show();
                    }
                } else {

                }
            },
            error: function() {}
        });
        //请求组列表
        $.ajax({
            type: "get",
            url: ctx + "/im/getGroup?"+getContactsDate.getTime(),
            // data:{},
            async: true,
            dataType: "json",
            success: function(reg) {
                /*gid: 组IDgimg: "1"头像gmain: "1"创始人gnam: 组名称*/
                //console.log(reg);
                if (reg.success) {
                    $("#groupGroup .groupNum").text(reg.attributes.groupNum);
                    var groupLi = "";
                    for (var i = 0; i < reg.obj.length; i++) {
                        groupLi += '<li class="showContent" data-signID="group" data-gagaID="' + reg.obj[i].gid + '" data-remarkname="' + reg.obj[i].nm[0].fnam + '" data-nickName="' + reg.obj[i].gnam + '" data-shield="' + reg.obj[i].nm[0].pb + '" data-onLine="0" data-Language="">' +
                            '<div class="showHead"> <img class="headImg" src="' + staticCtx + 'img/group.png">';

                        if (reg.obj[i].nm[0].pb == 1) {
                            that.shieldArr.push("" + reg.obj[i].gid);
                            groupLi += '<img class="headLine" src="' + staticCtx + 'img/shield.png" style="display:block">';
                        } else {
                            groupLi += '<img class="headLine" src="' + staticCtx + 'img/shield.png" style="display:none">';
                        }



                        groupLi += '</div><span class="showRemarkName">' + reg.obj[i].nm[0].fnam + '</span>';
                        groupLi += '<span class="newsNum newsNumSingle" style="display:none">0</span></li>';

                    }
                    $("#groupGroup .groupContainer").append(groupLi);
                    $("#js-groupScrollBar").mCustomScrollbar("update");

                } else {

                }
            },
            error: function() {

            }
        });
    },
    /*------发送消息---------------*/
    SendMessage: function(gagaID, content, inputBoxContent, imgUrl, targetLan, signId) {
        var that = this;
        /**
         * 百度语言种类
         * 
         * 中文		zh	英语		en
         * 日语		jp	韩语		kor
         * 西班牙语	spa	法语		fra
         * 泰语		th	阿拉伯语	ara
         * 俄罗斯语	ru	葡萄牙语	pt
         * 粤语		yue	文言文	wyw
         * 白话文		zh	自动检测	auto
         * 德语		de	意大利语	it
         * 荷兰语		nl	希腊语	el
         */
        //toid:对方ID;msg:原文；image：图片;uuid:前端临时id；;to:目标语言；
        var data = {
            toid: gagaID,
            msg: content,
            image: imgUrl,
            to: targetLan,
            uuid: "123"
        };
        //console.log("发送内容:"+JSON.stringify(data))
        //console.log("发送内容:"+data)
        if (that.isSendComplate) {
            that.isSendComplate  = false;
                    
            $.ajax({
                type: "post",
                url: ctx + "/im/sendMsg",
                data: data,
                async: true,
                dataType: "json",
                success: function(reg) {
                    if (reg.success) {
                        /*------------获取钱数和字符数------------*/
                        if (targetLan) {
                            that.getMoneyNum();
                            that.getTranslationCharacterNum();
                        }
                        var wordsId = reg.obj.newsModel.id;
                        var read = reg.obj.isRead;
                        var sendState = reg.success;
                        var TranslationContent = "";
                        var getSendTime = $.fn.returnTime(reg.obj.newsModel.ct, "full", "YYYY-MM-DD hh:mm");
                        var tranStatus ="";
                        //if (reg.attributes.tranStatus == 1 && reg.obj.newsModel.cot.tl.tr != "" && reg.obj.newsModel.cot.tl.tr != null) {
                        if (reg.attributes.tranStatus == 1 && reg.obj.newsModel.cot.tl && reg.obj.newsModel.cot.tl.tr != null) {
                            TranslationContent = reg.obj.newsModel.cot.tl.tr;
                        }
                       if(reg.obj.newsModel.cot.tl){
                            tranStatus = "true";
                        }
                        that.addSendMessage(gagaID, content, inputBoxContent, imgUrl, tranStatus, signId, getSendTime, wordsId, sendState, read, TranslationContent);
                        if(targetLan && !tranStatus){
                            layer.msg($.t("im.translationFailed"), {time: 2000 }, function() {});
                        }
                        /*------------恢复默认设置------------*/
                        var $box = gagaID == -1? $(".service .inputBox") : $(".normal .inputBox");
                        $box.val("");
                        $box.focus();
                        $(".upLoadImgContainer").hide();
                        $(".upLoadImgContainer .upLoadImg").attr("src", "");
                        $(".upLoadImgContainer .upLoadContnet").hide();
                        $(".upLoadImgContainer .upLoadImging").css("background", "url(../img/upLoadImging.gif) no-repeat;").show();
                        $(".upLoadImgContainer .upLoadImgState").text("").css("color", "#333").show();
                        $(".upLoadImgContainer .upLoadImgDelete").hide();
                    } else {
                        if (reg.msg == "1") {
                            $("#chatBox .lowerRightBottom").find(".upgradeTips").show();
                            $(".normal .FunBtncontainer .sendBtn").unbind("click");
                        }else if(reg.msg == "2"){
                            var contentTip = '<div class="textCenter marT5">' + $.t("im.goldLack")  + '</div>';
                            layer.open({
                                title: false,
                                content: contentTip,
                                skin: 'noTitleTips',
                                btn: [$.t("im.ToRecharge")],
                                yes: function(index, layero) {
                                    window.location.href = ctx + "/pay/recharge";
                                    layer.close(index);
                                }
                            });
                        }else if(reg.msg == "3"){
                            //敏感信息
                            layer.msg($.t("im.SensitiveWordsTips"), { time: 2000}, function() {});
                        } else {
                            layer.msg($.t("global.zoneApiError"), {time: 2000}, function() {});
                        }
                        /*sendDiv.find(".sendFailTip").css("background", "url(" + staticCtx + "img/IMicon.png) 0 -170px no-repeat");*/
                    }
                    $("#chatBox .lowerRight").children("[data-gagaID = " + gagaID + "]").children(".chatContent").mCustomScrollbar("update");
                    $("#chatBox .lowerRight").children("[data-gagaID = " + gagaID + "]").children(".chatContent").mCustomScrollbar("scrollTo", "bottom");

                    that.isSendComplate  = true;
                },
                error: function() {
                    var sendDiv = $(".lowerRight").children("[data-gagaID = " + gagaID + "]").find("[data-ranid = " + wordsId + "]");
                    sendDiv.find(".sendFailTip").css("background", "url(" + staticCtx + "img/IMicon.png) 0 -170px no-repeat");

                    that.isSendComplate  = true;
                }

            });
        }
 
    },
    /*------拼接----发送消息---------------*/
    addSendMessage: function(gagaID, inputBoxVal, inputBoxContent, imgUrl, tranStatus , signId, getSendTime, wordsId, sendState, read, TranslationContent) {
        var that = this;
        var sendTime = TimeDifference2(getSendTime, that.timeArr[gagaID]);
        var sendMessageDiv = "";
        if (sendTime != "") {
            that.timeArr[gagaID] = getSendTime;
            sendMessageDiv += '<p class="chatTime">' + getSendTime.substr(11, 5)+ '</p>';
        }
        inputBoxContent = that.replace_em(inputBoxContent);
        sendMessageDiv += '<div class="sendMessage" data-MSGsendID="'+myId+'" data-ranid="' + wordsId + '"><i class="sendHead chatConHead fr"><img class="sendHeadImg " src="' + qiniuImgURL + sendHeadImgUrl + '"></i>' +
            '<div class="sendContainer msgContent fr"><i class="sendHorn"></i>';

        if (inputBoxContent && inputBoxContent != $.t("im.enterKeySend")) {
            sendMessageDiv += '<p class="sendOriginal originalLan">' + inputBoxContent + '</p>';
        }
        
        
        
        
       /* 
        if (targetLan !== "" && that.deleteQQFace(inputBoxVal).trim() && inputBoxVal != $.t("im.enterKeySend")) {
            sendMessageDiv += '<div class="sendTranslationContainer translationContainer"><p class="sendTranslation translationLan">' + TranslationContent + '</p></div>';
        } else {
            sendMessageDiv += '<div class="sendTranslationContainer translationContainer" style="display:none"><p class="sendTranslation translationLan"></p></div>';
        }*/
        /*---根据翻译内容判断是否翻译--*/
        if(TranslationContent){
             sendMessageDiv += '<div class="sendTranslationContainer translationContainer"><p class="sendTranslation translationLan">' + TranslationContent + '</p></div>';
        }else{
             sendMessageDiv += '<div class="sendTranslationContainer translationContainer" style="display:none"><p class="sendTranslation translationLan"></p></div>';
        }
        
        
        if (imgUrl) {
            sendMessageDiv += '<span class="bigImgBtn"><img class="sendImg" src="' + imgUrl + '"></span>';
        }
       /* if (targetLan == "" && that.deleteQQFace(inputBoxVal).trim() != "" && inputBoxVal && inputBoxVal != $.t("im.enterKeySend")) {
            sendMessageDiv += '<i class="sendTranslateBtn translateBtn"></i><div class="sendlanChoice lanChoice" style="display:none"><i class="lanI"></i>' + that.languageListStr + '<div class="clear"></div></div>';
        }*/
        if(!TranslationContent && that.deleteQQFace(inputBoxVal).trim() != ""){
            sendMessageDiv += '<i class="sendTranslateBtn translateBtn"></i><div class="sendlanChoice lanChoice" style="display:none"><i class="lanI"></i>' + that.languageListStr + '<div class="clear"></div></div>';
        }
        
        
        sendMessageDiv += '</div>';
        if (sendState) {
            if (read == 0) {
                sendMessageDiv += '<div class="readContainer" style="display:block"><i class="readImg" style="display:none"></i><span class="read">' + $.t("im.noRead") + '</span></div>';
            } else if (read == 1) {
                sendMessageDiv += '<div class="readContainer" style="display:block"><i class="readImg"></i><span class="read">' + $.t("im.read") + '</span></div>';
            } else if (read == -1) {
                sendMessageDiv += '<div class="readContainer" style="display:none"><i class="readImg"></i><span class="read"></span></div>';
            }
        }

        if (!sendState) {
            sendMessageDiv += '<div class="sendFailTip" style="background:url(' + staticCtx + 'img/IMicon.png) 0 -170px no-repeat"></div>';
        }
        sendMessageDiv += '<div class="clear"></div></div>';

        $("#chatBox .lowerRight").children("[data-gagaID = " + gagaID + "]").find(".chatCon").append(sendMessageDiv);
        $("#chatBox .lowerRight").children("[data-gagaID = " + gagaID + "]").children(".chatContent").mCustomScrollbar("update");
        $("#chatBox .lowerRight").children("[data-gagaID = " + gagaID + "]").children(".chatContent").mCustomScrollbar("scrollTo", "bottom");

        /*-------------------排序---------------------------*/
        if ($("#recentlyGroup .FoldContainer").children("[data-gagaID=" + gagaID + "]").html()) {
            var showContentLi = $("#recentlyGroup .FoldContainer").children("[data-gagaID=" + gagaID + "]");
            $("#recentlyGroup .FoldContainer").prepend(showContentLi);
        } else {
            var showContent = "";
            if (signId == "people") {
                showContent = $("#friendGroup .FoldContainer").children("[data-gagaID=" + gagaID + "]");
            } else {
                showContent = $("#js-groupScrollBar .FoldContainer").children("[data-gagaID=" + gagaID + "]");
            }
            $("#recentlyGroup .FoldContainer").prepend(showContent.clone());
            var peopleNum = $("#recentlyGroup .recentlyNum").text();
            peopleNum++;
            $("#recentlyGroup .recentlyNum").text(peopleNum);
        }

    },
    /*---------接收消息-----------*/
    receiveMessage: function(msg) {
        var that = this;
       // console.log("receiveMessage:" + JSON.stringify(msg));
       // console.log("receiveMessage:"+msg);
        /**
	 * 是否为漂流瓶
	 * 0	不是
     
	 * 1	新注册的
	 * 2	刚刚更新头像的
	 * 3	刚刚发布动态的
	 * 4	一键50人
	 * 5	男性用户,条数不够,推送给女方的提示
	 * 6	女方5分钟没有点击链接,推送给男方的提示
	 * 7	女方点击链接,推送给男方的提示
	 * 8	男方充值后,给女方的提示
     
	 * 9	屏蔽对方提示
	 * 10	取消屏蔽对方提示
	 * 11	退出群提示
	 * 12	邀请好友进入群提示
     * 14   我们是彼此喜欢的人
     * 15	群屏蔽对方提示
	 * 16	群取消屏蔽对方提示
	 */
      //敏感信息跳出
        if(msg.cot.status ==1){
            return;
        }
        
        
        
        var chatPeopleUl = $(".chatBoxLower .lowerLeft");
        //that.shieldArr 屏蔽的好友ID数组  -1是不包含，不在屏蔽列表
        if ($.inArray(msg.sid, that.shieldArr) == -1) {
            if ($("#recentlyGroup .recentlyContainer").children("[data-gagaID = " + msg.sid + "]").html()) {
                var showContentLi = $("#recentlyGroup .recentlyContainer").children("[data-gagaID = " + msg.sid + "]");
                showContentLi.prependTo($("#recentlyGroup .recentlyContainer"));
            } else {
                $("#friendGroup .friendContainer").children(".showContent").each(function() {
                    if ($(this).attr("data-gagaid") == msg.sid) {
                        $("#showIM .recentlyContainer").prepend($(this).clone());
                    }
                });
                $("#groupGroup .groupContainer").children(".showContent").each(function() {
                    if ($(this).attr("data-gagaid") == msg.sid) {
                        $("#showIM .recentlyContainer").prepend($(this).clone());
                    }
                });
                var num = $("#js-contactsScrollBar .contactsCon .recentlyNum").text();
                num++;
                $("#js-contactsScrollBar .contactsCon .recentlyNum").text(num);
            }

            if (chatPeopleUl.children("[data-gagaID = " + msg.sid + "]").html()) {

                if (chatPeopleUl.children(".chatPeopleChoiced").attr("data-gagaID") != msg.sid) {
                    var th = chatPeopleUl.children("[data-gagaID = " + msg.sid + "]");
                    var num = th.children(".newsNum").text();
                    if (num == "99+") {
                        th.children(".newsNum").text("99+").show();
                    } else {
                        num++;
                        if (num == 100) {
                            th.children(".newsNum").removeClass("newsNumSingle").addClass("newsNumDouble");
                            th.children(".newsNum").text("99+").show();
                        } else if(num > 100){
                            th.children(".newsNum").text("99+").show();
                        }else {
                            th.children(".newsNum").text(num).show();
                        }
                    }
                    //----------------右侧--隐藏时显示提示---------------------
                    $("#js-newsArrive").show();
                    //----------------右侧--显示时查询---------------------
                    $("#showIM .recentlyContainer .showContent").each(function() {
                        if ($(this).attr("data-gagaid") == msg.sid) {
                            if(num == 100){
                                $(this).children(".newsNum").removeClass("newsNumSingle").addClass("newsNumDouble");
                                th.children(".newsNum").text("99+").show();
                            }else if(num > 100){
                               th.children(".newsNum").text("99+").show();
                            }
                            $(this).children(".newsNum").text(num).show();
                        }
                    });
                }
                var signID = chatPeopleUl.children("[data-gagaID = " + msg.sid + "]").attr("data-signID");
                var MSGsendID = null;
                if(signID = "group"){
                    MSGsendID = msg.rid;
                }else{
                    MSGsendID = msg.sid;
                }
                
                var receiveMessageDiv = '';
                var getDate = $.fn.returnTime(msg.ct, "full", "YYYY-MM-DD hh:mm");
                var tm = TimeDifference2(getDate, that.timeArr[msg.sid]);
                if (tm != "") {
                    that.timeArr[msg.sid] = getDate;
                    receiveMessageDiv += '<p class="chatTime">' + getDate.substr(11, 5) + '</p>';
                }
                if (msg.cot.isPl == 0) {
                    receiveMessageDiv += '<div class="receiveMessage'+(msg.cot.hb?' redPacket-box':'')+'" data-MSGsendID="'+MSGsendID+'" data-ranid="' + msg.id + '">' +
                        '<i class="receiveHead chatConHead fl"><img class="receiveHeadImg" src="';

                    if (msg.sidImage) {
                        receiveMessageDiv += qiniuImgURL + msg.sidImage;
                    } else {
                        receiveMessageDiv += chatPeopleUl.children("[data-gagaID = " + msg.sid + "]").find(".headImg").attr("src");

                    }

                    receiveMessageDiv += '"></i><div class="receiveContainer msgContent fl">  ';

                    if (msg.cot.hb) {
                        receiveMessageDiv += '<div class="redPacket-main" data-msg="'+msg.cot.hb.msg+'" data-monye="'+msg.cot.hb.mn+'" data-open="'+msg.cot.hb.isop+'"><span class="RedEnvelopeImg"></span><span class="RedEnvelopeWord">'+$.t("Letter.nowOpenRed")+'</span></div>';
                    } else {
                        if (msg.cot.msg.content != "" && msg.cot.msg.content != null) {
                            receiveMessageDiv += '<i class="receiveHorn"></i><p class="receiveOriginal originalLan">' + that.replace_em(msg.cot.msg.content) + '</p>';
                        }                                                        
                    }  
            
                    //if (msg.cot.tl.tr != "" && msg.cot.msg.content != "" && msg.cot.msg.content != null) {
                    if (msg.cot.tl && ((msg.cot.msg && msg.cot.msg.content) || (msg.cot.hb && msg.cot.hb.msg)) ) {
                        receiveMessageDiv += '<div class="receiveTranslationContainer translationContainer"> <p class="receiveTranslation translationLan">' + that.replace_em(msg.cot.tl.tr) + '</p></div>';
                    }else{
                        receiveMessageDiv += '<div class="receiveTranslationContainer translationContainer" style="display:none"> <p class="receiveTranslation translationLan" ></p></div>';
                    }

                    if (msg.cot.msg.img) {
                        receiveMessageDiv += '<span class="bigImgBtn"><img class="receiveImg" src="' + msg.cot.msg.img + '"></span>';
                    }
                    //if (msg.cot.tl.tr == "" && msg.cot.msg.content != "" && msg.cot.msg.content != null && that.deleteQQFace(msg.cot.msg.content).trim() != "") {
                    if (!msg.cot.tl&& msg.cot.msg.content != "" && msg.cot.msg.content != null && that.deleteQQFace(msg.cot.msg.content).trim() != "") {
                        receiveMessageDiv += '<i class="receiveTranslateBtn translateBtn"></i><div class="receivelanChoice lanChoice" style="display:none"><i class="lanI"></i>' + that.languageListStr + '<div class="clear"></div></div>';
                    }
                    if (msg.cot.hb && msg.cot.hb.msg && !msg.cot.tl) {
                        receiveMessageDiv += '<i class="receiveTranslateBtn translateBtn"></i><div class="receivelanChoice lanChoice" style="display:none"><i class="lanI"></i>' + that.languageListStr + '<div class="clear"></div></div>';
                    }
                    receiveMessageDiv += '</div><div class="clear"></div></div>';
                }
                /*else if(msg.cot.isPl==9){
                                    receiveMessageDiv +='<div class="likeEachOther"><span class="likeEachOtherSpan">'+$.t("im.shieldEachOther")+'</span></div>';
                                }*/
                /*else if(msg.cot.isPl==10){
                                    receiveMessageDiv +='<div class="likeEachOther"><span class="likeEachOtherSpan">'+$.t("im.cancelShieldEachOther")+'</span></div>'; 
                                }*/
                else if (msg.cot.isPl == 11) {
                    receiveMessageDiv += '<div class="likeEachOther"><span class="likeEachOtherSpan">' + msg.cot.msg.content + $.t("im.backFromGroup") + '</span></div>';
                } else if (msg.cot.isPl == 12) {
                    receiveMessageDiv += '<div class="likeEachOther"><span class="likeEachOtherSpan">' + msg.cot.msg.content + $.t("im.joinGroup") + '</span></div>';
                } else if (msg.cot.isPl == 14) {
                    receiveMessageDiv += '<div class="likeEachOther"><span class="likeEachOtherSpan">' + $.t("im.likeEachOther") + '</span></div>';
                }
                /*else if(msg.cot.isPl==15){
                                    if(msg.sid==myId){
                                         receiveMessageDiv +='<div class="likeEachOther"><span class="likeEachOtherSpan">'+$.t("im.shieldGroup")+'</span></div>'; 
                                    }
                                }else if(msg.cot.isPl==16){
                                     if(msg.sid==myId){
                                         receiveMessageDiv +='<div class="likeEachOther"><span class="likeEachOtherSpan">'+$.t("im.cancelShieldGroup")+'</span></div>'; 
                                    }
                                }*/


                $(".lowerRight").children("[data-gagaID = " + msg.sid + "]").find(".chatCon").append(receiveMessageDiv);
                $(".lowerRight [data-gagaID = " + msg.sid + "]").children(".chatContent").mCustomScrollbar("update");
                $(".lowerRight [data-gagaID = " + msg.sid + "]").children(".chatContent").mCustomScrollbar("scrollTo", "bottom");

            } else {

                //----------------右侧--隐藏时显示提示---------------------
                $("#js-newsArrive").show();
                //----------------右侧--显示时查询---------------------
                $("#showIM .recentlyContainer .showContent").each(function() {
                    if ($(this).attr("data-gagaid") == msg.sid) {
                        var num = $(this).children(".newsNum").text();
                        if (num == "99+") {
                            $(this).children(".newsNum").text("99+").show();
                        } else {
                            num++;
                            if (num > 99) {
                                $(this).children(".newsNum").removeClass("newsNumSingle").addClass("newsNumDouble");
                                $(this).children(".newsNum").text("99+").show();
                            } else {
                                $(this).children(".newsNum").text(num).show();
                            }
                        }
                    }
                });
            }
        } else {
            if (chatPeopleUl.children("[data-gagaID = " + msg.sid + "]").html()) {
                var signID = chatPeopleUl.children("[data-gagaID = " + msg.sid + "]").attr("data-signID");
                var MSGsendID = null;
                if(signID = "group"){
                    MSGsendID = msg.rid;
                }else{
                    MSGsendID = msg.sid;
                }
                var receiveMessageDiv = '';
                var getDate = $.fn.returnTime(msg.ct, "full", "YYYY-MM-DD hh:mm");
                //var getDate = jsonDateFormatReceive(new Date(msg.ct).Format("yyyy-MM-dd hh:mm"));
                var tm = TimeDifference2(getDate, that.timeArr[msg.sid]);
                if (tm != "") {
                    that.timeArr[msg.sid] = getDate;
                    receiveMessageDiv += '<p class="chatTime">' + getDate.substr(11, 5) + '</p>';
                }
                if (msg.cot.isPl == 0) {
                    receiveMessageDiv += '<div class="receiveMessage" data-MSGsendID="'+MSGsendID+'" data-ranid="' + msg.id + '">' +
                        '<i class="receiveHead chatConHead fl"><img class="receiveHeadImg" src="';

                    if (msg.sidImage) {
                        receiveMessageDiv += qiniuImgURL + msg.sidImage;
                    } else {
                        receiveMessageDiv += chatPeopleUl.children("[data-gagaID = " + msg.sid + "]").find(".headImg").attr("src");

                    }

                    receiveMessageDiv += '"></i><div class="receiveContainer msgContent fl">';
                    if (msg.cot.hb) {
                        receiveMessageDiv += '<div class="redPacket-main" data-msg="'+msg.cot.hb.msg+'" data-monye="'+msg.cot.hb.mn+'" data-open="'+msg.cot.hb.isop+'"><span class="RedEnvelopeImg"></span><span class="RedEnvelopeWord">'+$.t("Letter.nowOpenRed")+'</span></div>';
                    } else {
                        if (msg.cot.msg.content != "" && msg.cot.msg.content != null) {
                            receiveMessageDiv += '<i class="receiveHorn"></i><p class="receiveOriginal originalLan">' + that.replace_em(msg.cot.msg.content) + '</p>';
                        }                                                        
                    }
                    if (msg.cot.tl.tr == "") {
                        receiveMessageDiv += '<div class="receiveTranslationContainer translationContainer" style="display:none"> <p class="receiveTranslation translationLan" ></p></div>';
                    }
                    if (msg.cot.tl.tr != "" && msg.cot.msg.content != "" && msg.cot.msg.content != null) {
                        receiveMessageDiv += '<div class="receiveTranslationContainer translationContainer"> <p class="receiveTranslation translationLan">' + that.replace_em(msg.cot.tl.tr) + '</p></div>';
                    }

                    if (msg.cot.msg.img) {
                        receiveMessageDiv += '<span class="bigImgBtn"><img class="receiveImg" src="' + msg.cot.msg.img + '"></span>';
                    }
                    if (msg.cot.tl.tr == "" && msg.cot.msg.content != "" && msg.cot.msg.content != null && that.deleteQQFace(msg.cot.msg.content).trim() != "") {
                        receiveMessageDiv += '<i class="receiveTranslateBtn translateBtn"></i><div class="receivelanChoice lanChoice" style="display:none"><i class="lanI"></i>' + that.languageListStr + '<div class="clear"></div></div>';
                    }
                    if (msg.cot.hb && msg.cot.hb.msg && !msg.cot.tl) {
                        receiveMessageDiv += '<i class="receiveTranslateBtn translateBtn"></i><div class="receivelanChoice lanChoice" style="display:none"><i class="lanI"></i>' + that.languageListStr + '<div class="clear"></div></div>';
                    }
                    receiveMessageDiv += '</div><div class="clear"></div></div>';
                }
                /*else if(msg.cot.isPl==9){
                                    receiveMessageDiv +='<div class="likeEachOther"><span class="likeEachOtherSpan">'+$.t("im.shieldEachOther")+'</span></div>';
                                }*/
                /*else if(msg.cot.isPl==10){
                                    receiveMessageDiv +='<div class="likeEachOther"><span class="likeEachOtherSpan">'+$.t("im.cancelShieldEachOther")+'</span></div>'; 
                                }*/
                else if (msg.cot.isPl == 11) {
                    receiveMessageDiv += '<div class="likeEachOther"><span class="likeEachOtherSpan">' + msg.cot.msg.content + $.t("im.backFromGroup") + '</span></div>';
                } else if (msg.cot.isPl == 12) {
                    receiveMessageDiv += '<div class="likeEachOther"><span class="likeEachOtherSpan">' + msg.cot.msg.content + $.t("im.joinGroup") + '</span></div>';
                } else if (msg.cot.isPl == 14) {
                    receiveMessageDiv += '<div class="likeEachOther"><span class="likeEachOtherSpan">' + $.t("im.likeEachOther") + '</span></div>';
                }
                /*else if(msg.cot.isPl==15){
                                    if(msg.sid==myId){
                                         receiveMessageDiv +='<div class="likeEachOther"><span class="likeEachOtherSpan">'+$.t("im.shieldGroup")+'</span></div>'; 
                                    }
                                }else if(msg.cot.isPl==16){
                                     if(msg.sid==myId){
                                         receiveMessageDiv +='<div class="likeEachOther"><span class="likeEachOtherSpan">'+$.t("im.cancelShieldGroup")+'</span></div>'; 
                                    }
                                }*/


                $(".lowerRight").children("[data-gagaID = " + msg.sid + "]").find(".chatCon").append(receiveMessageDiv);
                $(".lowerRight [data-gagaID = " + msg.sid + "]").children(".chatContent").mCustomScrollbar("update");
                $(".lowerRight [data-gagaID = " + msg.sid + "]").children(".chatContent").mCustomScrollbar("scrollTo", "bottom");

            }
        }
    },
    /*------向后台发送当前联系人-------*/
    postCurrentChatPeople: function(gagaID) {
        var data = {
            rid: gagaID,
            status: "1"
        };
        $.ajax({
            type: "post",
            url: ctx + "/im/updateCurrWin",
            data: data,
            async: true,
            dataType: "json",
            success: function(reg) {},
            error: function() {}
        });
    },
    /*-----切换时修改信息状态-----*/
    modifyMSGState: function(reg) {
        if ($(".lowerRight").children("[data-gagaID = " + reg + "]").html()) {
            $(".lowerRight").children("[data-gagaID = " + reg + "]").find(".readImg").show();
            $(".lowerRight").children("[data-gagaID = " + reg + "]").find(".read").text($.t("im.read"));
        }
    },
    /*------------请求最近10条消息--------------*/
    ajxaLateHistorical: function(gagaID, receiveHeadimg) {
        var that = this;
        //gid：组ID
        var data = {
            rid: gagaID
        };
        $.ajax({
            type: "post",
            url: ctx + "/im/getChatTop10",
            data: data,
            async: true,
            dataType: "json",
            success: function(reg) {
                //console.log("最近10条:" + JSON.stringify(reg));
                //console.log("最近10条:" + reg);
                that.timeArr[gagaID] = "";
            
                var noReadNum = reg.obj.fwds;
                var dataMSG = reg.obj.news;
                var nowTime = $.fn.returnTime(reg.attributes.currDate, "full", "YYYY-MM-DD hh:mm");

                if (dataMSG.length > 9) {
                    $("#chatBox .lowerRight").children("[data-gagaID = " + gagaID + "]").find(".moreNews").show();
                }
                //for (var i = (dataMSG.length - 1); i > -1; i--) {
                for (var i = 0; i < dataMSG.length; i++) {
            
                	//敏感信息跳出
                    /*if(dataMSG[i].cot.status =="1"){
                       continue;
                    }*/
                	
                	
                    var chatContentDiv = '';
                    //var getDate = new Date(dataMSG[i].ct).Format("yyyy-MM-dd hh:mm");
                    var getDate = $.fn.returnTime(dataMSG[i].ct, "full", "YYYY-MM-DD hh:mm");
                    //console.log(getDate);
                    var tm = TimeDifference2(getDate, that.timeArr[gagaID],nowTime);
                    if (tm != "") {
                       /* if(!((dataMSG[i].sid == myId && (dataMSG[i].cot.isPl == 11 || dataMSG[i].cot.isPl == 12)) || (dataMSG[i].sid != myId && (dataMSG[i].cot.isPl == 9 || dataMSG[i].cot.isPl == 10))) ){*/
                        if(dataMSG[i].cot.isPl == 0 || dataMSG[i].cot.isPl == 14 ||(dataMSG[i].sid == myId &&( dataMSG[i].cot.isPl == 15 || dataMSG[i].cot.isPl == 16))){
                             that.timeArr[gagaID] = getDate;
                             chatContentDiv += '<p class="chatTime">' + tm + '</p>';
                        }
                        if((dataMSG[i].sid != myId && ( dataMSG[i].cot.isPl == 9 || dataMSG[i].cot.isPl == 10 || dataMSG[i].cot.isPl == 11 || dataMSG[i].cot.isPl == 12) ) && dataMSG[i].cot.status =="0"){
                            
                            
                             that.timeArr[gagaID] = getDate;
                             chatContentDiv += '<p class="chatTime">' + tm + '</p>';
                        }
                        
                    }


                    if (dataMSG[i].sid == myId) {
                        if (dataMSG[i].cot.isPl == 0) {

                            chatContentDiv += '<div class="sendMessage'+(dataMSG[i].cot.hb?' redPacket-box':'')+'" data-MSGsendID="'+dataMSG[i].sid+'" data-ranid="' + dataMSG[i].id + '"><i class="sendHead chatConHead fr"><img class="sendHeadImg " src="' + qiniuImgURL + sendHeadImgUrl + '"></i>' +
                                '<div class="sendContainer msgContent fr">';

                            if (dataMSG[i].cot.hb) {
                                chatContentDiv += '<div class="redPacket-main" data-msg="'+dataMSG[i].cot.hb.msg+'" data-money="'+dataMSG[i].cot.hb.mn+'" data-open="'+dataMSG[i].cot.hb.isop+'"><span class="RedEnvelopeImg"></span><span class="RedEnvelopeWord">'+$.t("Letter.checkred")+'</span></div>';
                            } else {
                                if (dataMSG[i].cot.msg.content) {
                                    chatContentDiv += '<i class="sendHorn"></i><p class="sendOriginal originalLan">' + that.replace_em(dataMSG[i].cot.msg.content) + '</p>';
                                }                                                        
                            }  
                            if (dataMSG[i].cot.tl != "" && dataMSG[i].cot.tl != null && dataMSG[i].cot.tl.tr) {                                
                                chatContentDiv += '<div class="sendTranslationContainer translationContainer"><p class="sendTranslation translationLan">' + dataMSG[i].cot.tl.tr + '</p></div>';
                            } else {
                                chatContentDiv += '<div class="sendTranslationContainer translationContainer" style="display:none"><p class="sendTranslation translationLan"></p></div>';
                            }
                            if (dataMSG[i].cot.msg.img) {
                                    chatContentDiv += '<span class="bigImgBtn"><img class="sendImg" src="' + dataMSG[i].cot.msg.img + '"></span>';
                            }
                            if (!dataMSG[i].cot.tl  && dataMSG[i].cot.msg.content != "" && that.deleteQQFace(dataMSG[i].cot.msg.content).trim() != "") {
                                chatContentDiv += '<i class="sendTranslateBtn translateBtn"></i><div class="sendlanChoice lanChoice" style="display:none"><i class="lanI"></i>' + that.languageListStr + '<div class="clear"></div></div>';
                            }
                            if (dataMSG[i].cot.hb && dataMSG[i].cot.hb.msg && !dataMSG[i].cot.tl) {
                                chatContentDiv += '<i class="sendTranslateBtn translateBtn"></i><div class="sendlanChoice lanChoice" style="display:none"><i class="lanI"></i>' + that.languageListStr + '<div class="clear"></div></div>';                                                        
                            }
                            chatContentDiv += '</div>';                          

                            if (myMemberGrade == "3") {
                            
                                if((dataMSG.length - i )<= noReadNum){
                               // if (noReadNum > 0) {
                                    chatContentDiv += '<div class="readContainer" style="display:block"><i class="readImg" style="display:none"></i><span class="read">' + $.t("im.noRead") + '</span></div>';
                                   // noReadNum--;
                                } else {
                                    chatContentDiv += '<div class="readContainer" style="display:block"><i class="readImg"></i><span class="read">' + $.t("im.read") + '</span></div>';
                                }
                            } else {
                                chatContentDiv += '<div class="readContainer" style="display:none"><i class="readImg"></i><span class="read"></span></div>';
                            }
                            chatContentDiv += '<div class="sendFailTip" style="display:none"></div><div class="clear"></div></div>';

                        } else if (dataMSG[i].cot.isPl == 14) {
                            chatContentDiv += '<div class="likeEachOther"><span class="likeEachOtherSpan">' + $.t("im.likeEachOther") + '</span></div>';
                        } else if (dataMSG[i].cot.isPl == 15) {
                            if (dataMSG[i].sid == myId) {
                                chatContentDiv += '<div class="likeEachOther"><span class="likeEachOtherSpan">' + $.t("im.shieldGroup") + '</span></div>';
                            }
                        } else if (dataMSG[i].cot.isPl == 16) {
                            if (dataMSG[i].sid == myId) {
                                chatContentDiv += '<div class="likeEachOther"><span class="likeEachOtherSpan">' + $.t("im.cancelShieldGroup") + '</span></div>';
                            }
                        }
                        $("#chatBox .lowerRight").children("[data-gagaID = " + gagaID + "]").find(".chatCon").append(chatContentDiv);

                    } else {
                        //敏感信息跳出
                        if(dataMSG[i].cot.status =="1"){
                           continue;
                        }
                        
                        /*--------聊天记录----系统提示-------*/
                        /* * 0	不是
                         * 9	屏蔽对方提示
                         * 10	取消屏蔽对方提示
                         * 11	退出群提示
                         * 12	邀请好友进入群提示
                         * 14   我们是彼此喜欢的人*/
                        if (dataMSG[i].cot.isPl == 0) {
                            if (dataMSG[i].sidImage) {
                                receiveHeadimg = qiniuImgURL + dataMSG[i].sidImage;
                            }
                            chatContentDiv += '<div class="receiveMessage'+(dataMSG[i].cot.hb?' redPacket-box':'')+'" data-MSGsendID="'+dataMSG[i].sid+'" data-ranid="' + dataMSG[i].id + '">' +
                                '<i class="receiveHead chatConHead fl"><img class="receiveHeadImg" src="' + receiveHeadimg + '"></i>' +
                                '<div class="receiveContainer msgContent fl">';
                            if (dataMSG[i].cot.hb) {
                                chatContentDiv += '<div class="redPacket-main" data-msg="'+dataMSG[i].cot.hb.msg+'" data-money="'+dataMSG[i].cot.hb.mn+'" data-open="'+dataMSG[i].cot.hb.isop+'"><span class="RedEnvelopeImg"></span><span class="RedEnvelopeWord">'+(dataMSG[i].cot.hb.isop == 1?$.t("Letter.redPacketsReceive"):$.t("Letter.nowOpenRed"))+'</span></div>';
                            } else {
                                if (dataMSG[i].cot.msg.content != "" && dataMSG[i].cot.msg.content != null) {
                                    chatContentDiv += ' <i class="receiveHorn"></i><p class="receiveOriginal originalLan">' + that.replace_em(dataMSG[i].cot.msg.content) + '</p>';
                                }                                                
                            }

                            //if (dataMSG[i].cot.tl.tr != "" && dataMSG[i].cot.msg.content != "" && dataMSG[i].cot.msg.content != null) {
                            if (dataMSG[i].cot.tl && ((dataMSG[i].cot.msg && dataMSG[i].cot.msg.content) || (dataMSG[i].cot.hb && dataMSG[i].cot.hb.msg)) ) {
                                chatContentDiv += '<div class="receiveTranslationContainer translationContainer"> <p class="receiveTranslation translationLan">' + that.replace_em(dataMSG[i].cot.tl.tr) + '</p></div>';
                            }else{
                                chatContentDiv += '<div class="receiveTranslationContainer translationContainer" style="display:none"> <p class="receiveTranslation translationLan" ></p></div>';
                            }

                           
                            if (dataMSG[i].cot.msg.img) {
                                    chatContentDiv += '<span class="bigImgBtn"><img class="receiveImg" src="' + dataMSG[i].cot.msg.img + '"></span>';
                            }
                            //if (dataMSG[i].cot.tl.tr == "" && dataMSG[i].cot.msg.content != "" && dataMSG[i].cot.msg.content != null && that.deleteQQFace(dataMSG[i].cot.msg.content).trim() != "") {
                            if (!dataMSG[i].cot.tl && dataMSG[i].cot.msg.content != "" && dataMSG[i].cot.msg.content != null && that.deleteQQFace(dataMSG[i].cot.msg.content).trim() != "") {
                                chatContentDiv += '<i class="receiveTranslateBtn translateBtn"></i><div class="receivelanChoice lanChoice" style="display:none"><i class="lanI"></i>' + that.languageListStr + '<div class="clear"></div></div>';
                            }

                            if (dataMSG[i].cot.hb && dataMSG[i].cot.hb.msg && !dataMSG[i].cot.tl) {
                                chatContentDiv += '<i class="receiveTranslateBtn translateBtn"></i><div class="receivelanChoice lanChoice" style="display:none"><i class="lanI"></i>' + that.languageListStr + '<div class="clear"></div></div>';
                            }

                            chatContentDiv += '</div><div class="clear"></div></div>';

                        } else if (dataMSG[i].cot.isPl == 9) {
                            chatContentDiv += '<div class="likeEachOther"><span class="likeEachOtherSpan">' + $.t("im.shieldEachOther") + '</span></div>';
                        } else if (dataMSG[i].cot.isPl == 10) {
                            chatContentDiv += '<div class="likeEachOther"><span class="likeEachOtherSpan">' + $.t("im.cancelShieldEachOther") + '</span></div>';
                        } else if (dataMSG[i].cot.isPl == 11) {
                            chatContentDiv += '<div class="likeEachOther"><span class="likeEachOtherSpan">' + dataMSG[i].cot.msg.content + $.t("im.backFromGroup") + '</span></div>';
                        } else if (dataMSG[i].cot.isPl == 12) {
                            chatContentDiv += '<div class="likeEachOther"><span class="likeEachOtherSpan">' + dataMSG[i].cot.msg.content + $.t("im.joinGroup") + '</span></div>';
                        } else if (dataMSG[i].cot.isPl == 14) {
                            chatContentDiv += '<div class="likeEachOther"><span class="likeEachOtherSpan">' + $.t("im.likeEachOther") + '</span></div>';
                        }
                        $("#chatBox .lowerRight").children("[data-gagaID = " + gagaID + "]").find(".chatCon").append(chatContentDiv);

                    }
                }
                $("#chatBox .lowerRight").children("[data-gagaID = " + gagaID + "]").children(".chatContent").mCustomScrollbar({});
                $("#chatBox .lowerRight").children("[data-gagaID = " + gagaID + "]").children(".chatContent").mCustomScrollbar("update");
                $("#chatBox .lowerRight").children("[data-gagaID = " + gagaID + "]").children(".chatContent").mCustomScrollbar("scrollTo", "bottom");
            },
            error: function() {}
        });

    },

    ajxaHistorical: function(gagaID, currentpage) {
        //gid：组ID
        var that = this;
        $(".chatHistorical .IMnoChat").hide();
        $("#chatBox .historicalCon").html("");
        var data = {
            rid: gagaID,
            offset: currentpage,
            size: "10"
        };
        $.ajax({
            type: "post",
            url: ctx + "/im/getChat",
            data: data,
            async: true,
            dataType: "json",
            success: function(reg) {
                that.PageCount = reg.obj.totalPage;
                var dataMSG = reg.obj.news;
               // console.log("lishi:" + that.PageCount);
               // console.log("lishi:" + JSON.stringify(reg));
                // console.log("lishi:" + reg);
                /* * 0	不是
                 * 9	屏蔽对方提示
                 * 10	取消屏蔽对方提示
                 * 11	退出群提示
                 * 12	邀请好友进入群提示
                 * 14   我们是彼此喜欢的人*/
                if (dataMSG.length == 0) {
                    $(".chatHistorical .IMnoChat").show();
                }
                for (var i = 0; i < dataMSG.length; i++) {
                	
                	if(dataMSG[i].cot.status ==1){
                        continue;
                     }
                	
                	
                    var historicalDiv = '';
                    if (dataMSG[i].sid == myId) {
                        historicalDiv = '<div class="historicalContent">';
                        if (dataMSG[i].cot.isPl == 0) {
                            historicalDiv += '<p class="historicalTitle historicalSend "><span class="historicalRemarkName">' + myNickname + '</span><span class="historicalTime">' + /*new Date(dataMSG[i].ct).Format("yyyy-MM-dd hh:mm")*/ $.fn.returnTime(dataMSG[i].ct, "full", "YYYY-MM-DD hh:mm") + '</span></p>';
                            historicalDiv += '<div class="historicalChatCon">';
                            if (dataMSG[i].cot.msg.content) {
                                historicalDiv += '<p class="historicalOriginal">' + that.replace_em(dataMSG[i].cot.msg.content) + '</p>';
                            }
                            if (dataMSG[i].cot.hb) {
                                historicalDiv += '<div class="historicalRedPocket send" data-msg="'+dataMSG[i].cot.hb.msg+'" data-money="'+dataMSG[i].cot.hb.mn+'" data-open="'+dataMSG[i].cot.hb.isop+'" data-ranid="'+dataMSG[i].id+'"><span class="RedEnvelopeImg"></span><span class="RedEnvelopeWord">'+$.t("Letter.checkred")+'</span></div>';
                            }
                            //if (dataMSG[i].cot.tl.tr) {
                            if (dataMSG[i].cot.tl && dataMSG[i].cot.tl.tr) {
                                historicalDiv += '<div class="historicalTranslationCon"><i class="historicalTranslationHorn"></i><p class="historicalTranslation">' + that.replace_em(dataMSG[i].cot.tl.tr) + '</p></div>';
                            }
                            if (dataMSG[i].cot.msg.img) {
                                historicalDiv += '<span class="bigImgBtn"><img class="historicalImg" src="' + dataMSG[i].cot.msg.img + '" /></span>';
                            }
                            historicalDiv += '</div></div>';
                        } else if (dataMSG[i].cot.isPl == 14) {
                            historicalDiv += '<div class="textCenter marT5"><p class="historicalTime textCenter marT5">' + /*new Date(dataMSG[i].ct).Format("yyyy-MM-dd hh:mm")*/ $.fn.returnTime(dataMSG[i].ct, "full", "YYYY-MM-DD hh:mm") + '</p><div class="systemTips textCenter marT5">' + $.t("im.likeEachOther") + '</div></div>';
                        } else if (dataMSG[i].cot.isPl == 15) {
                            historicalDiv += '<div class="textCenter marT5"><p class="historicalTime">' + /*new Date(dataMSG[i].ct).Format("yyyy-MM-dd hh:mm")*/ $.fn.returnTime(dataMSG[i].ct, "full", "YYYY-MM-DD hh:mm") + '</p><div class="systemTips">' + $.t("im.shieldGroup") + '</div></div>';
                        } else if (dataMSG[i].cot.isPl == 16) {

                            historicalDiv += '<div class="textCenter marT5"><p class="historicalTime textCenter marT5">' + /*new Date(dataMSG[i].ct).Format("yyyy-MM-dd hh:mm")*/ $.fn.returnTime(dataMSG[i].ct, "full", "YYYY-MM-DD hh:mm") + '</p><div class="systemTips textCenter marT5">' + $.t("im.cancelShieldGroup") + '</div></div>';
                        }

                    } else {
                           //敏感词
                            if(dataMSG[i].cot.status ==1){
                                continue;
                            }
                        
                        historicalDiv = '<div class="historicalContent">';
                        if (dataMSG[i].cot.isPl == 0) {
                            historicalDiv += '<p class="historicalTitle historicalReceive"><span class="historicalRemarkName">'
                            if (that.signID == "people") {
                                historicalDiv += $.IM.remarkName;
                                /* + dataMSG[i].sid + */
                            } else {
                                historicalDiv += dataMSG[i].sidmembNickname;
                            }
                            historicalDiv += '</span><span class="historicalTime">' + /*new Date(dataMSG[i].ct).Format("yyyy-MM-dd hh:mm")*/ $.fn.returnTime(dataMSG[i].ct, "full", "YYYY-MM-DD hh:mm") + '</span></p>';
                            historicalDiv += '<div class="historicalChatCon">';
                            if (dataMSG[i].cot.msg.content) {
                                historicalDiv += '<p class="historicalOriginal">' + that.replace_em(dataMSG[i].cot.msg.content) + '</p>';
                            }
                            if (dataMSG[i].cot.hb) {
                                historicalDiv += '<div class="historicalRedPocket receive" data-msg="'+dataMSG[i].cot.hb.msg+'" data-money="'+dataMSG[i].cot.hb.mn+'" data-open="'+dataMSG[i].cot.hb.isop+'" data-ranid="'+dataMSG[i].id+'"><span class="RedEnvelopeImg"></span><span class="RedEnvelopeWord">'+(dataMSG[i].cot.hb.isop == 1?$.t("Letter.redPacketsReceive"):$.t("Letter.nowOpenRed"))+'</span></div>';
                            }
                            //if (dataMSG[i].cot.tl.tr) {
                            if (dataMSG[i].cot.tl && dataMSG[i].cot.tl.tr) {
                                historicalDiv += '<div class="historicalTranslationCon"><i class="historicalTranslationHorn"></i><p class="historicalTranslation">' + that.replace_em(dataMSG[i].cot.tl.tr) + '</p></div>';
                            }
                            if (dataMSG[i].cot.msg.img) {
                                historicalDiv += '<span class="bigImgBtn"><img class="historicalImg" src="' + dataMSG[i].cot.msg.img + '" /></span>';
                            }
                            historicalDiv += '</div></div>';
                        } else if (dataMSG[i].cot.isPl == 9) {
                            historicalDiv += '<div class="textCenter marT5"><p class="historicalTime">' + /*new Date(dataMSG[i].ct).Format("yyyy-MM-dd hh:mm")*/ $.fn.returnTime(dataMSG[i].ct, "full", "YYYY-MM-DD hh:mm") + '</p><div class="systemTips">' + $.t("im.shieldEachOther") + '</div></div>';
                        } else if (dataMSG[i].cot.isPl == 10) {
                            historicalDiv += '<div class="textCenter marT5"><p class="historicalTime textCenter marT5">' + /*new Date(dataMSG[i].ct).Format("yyyy-MM-dd hh:mm")*/ $.fn.returnTime(dataMSG[i].ct, "full", "YYYY-MM-DD hh:mm") + '</p><div class="systemTips textCenter marT5">' + $.t("im.cancelShieldEachOther") + '</div></div>';
                        } else if (dataMSG[i].cot.isPl == 11) {
                            historicalDiv += '<div class="textCenter marT5"><p class="historicalTime textCenter marT5">' + /*new Date(dataMSG[i].ct).Format("yyyy-MM-dd hh:mm")*/ $.fn.returnTime(dataMSG[i].ct, "full", "YYYY-MM-DD hh:mm") + '</p><div class="systemTips textCenter marT5">' + dataMSG[i].cot.msg.content + $.t("im.backFromGroup") + '</div></div>';
                        } else if (dataMSG[i].cot.isPl == 12) {
                            historicalDiv += '<div class="textCenter marT5"><p class="historicalTime textCenter marT5">' + /*new Date(dataMSG[i].ct).Format("yyyy-MM-dd hh:mm")*/ $.fn.returnTime(dataMSG[i].ct, "full", "YYYY-MM-DD hh:mm") + '</p><div class="systemTips textCenter marT5">' + dataMSG[i].cot.msg.content + $.t("im.joinGroup") + '</div></div>';
                        } else if (dataMSG[i].cot.isPl == 14) {
                            historicalDiv += '<div class="textCenter marT5"><p class="historicalTime textCenter marT5">' + /*new Date(dataMSG[i].ct).Format("yyyy-MM-dd hh:mm")*/ $.fn.returnTime(dataMSG[i].ct, "full", "YYYY-MM-DD hh:mm") + '</p><div class="systemTips textCenter marT5">' + $.t("im.likeEachOther") + '</div></div>';
                        }
                    }
                    $("#chatBox .historicalCon").append(historicalDiv);
                }

                if (that.currentpage >= that.PageCount) {
                    $(".chatHistorical .firstPage").css("background-position", "-255px -22px");
                    $(".chatHistorical .previousPage").css("background-position", "-280px -22px");
                } else {
                    $(".chatHistorical .firstPage").css("background-position", "-255px 0px");
                    $(".chatHistorical .previousPage").css("background-position", "-280px 0px");
                }
                if (that.currentpage <= 1) {
                    $(".chatHistorical .lastPage").css("background-position", "-327px  0px");
                    $(".chatHistorical .nextPage").css("background-position", "-305px 0px");
                } else {
                    $(".chatHistorical .lastPage").css("background-position", "-327px  -22px");
                    $(".chatHistorical .nextPage").css("background-position", "-305px -22px");
                }
                $(".historicalContainer").mCustomScrollbar("update");
                $(".historicalContainer").mCustomScrollbar("scrollTo", "bottom");
            },
            error: function() {
                layer.msg($.t("im.requestFailure"), {
                    time: 2000
                }, function() {});
            }
        });
    },
    /*--------创建群----------*/
    createGrounp: function(GroupsMemberNames, callback) {
        if (GroupsMemberNames == '') {
            layer.msg($.t('im.createGroupError'));
            return;
        }
        var data = {
            "uids": GroupsMemberNames
        };
        //console.log(data);
        $.ajax({
            type: "post",
            url: ctx + "/im/createGroup",
            data: data,
            async: true,
            dataType: "json",
            success: function(reg) {
                //console.log("建群:" + JSON.stringify(reg));
                //console.log("建群:" + reg);
                if (reg.success) {

                    var groupLi = '<li class="showContent" data-signid="group" data-gagaid="' + reg.attributes.gid + '" data-remarkname="' + reg.attributes.gnam + '" data-nickName="' + reg.attributes.gnam + '" data-onLine="0" data-Language="" data-shield="0">' +
                        '<div class="showHead"> <img class="headImg" src="' + staticCtx + 'img/group.png"><img class="headLine" src="' + staticCtx + 'img/shield.png" style="display:none"></div><span class="showRemarkName">' + reg.attributes.gnam + '</span><span class="newsNum newsNumSingle" style="display:none">0</span></li>';
                    $("#js-groupScrollBar .groupContainer").append(groupLi);
                    var num = $("#js-groupScrollBar .groupCon .groupNum").text();
                    num++;
                    $("#js-groupScrollBar .groupCon .groupNum").text(num);
                    if (callback) {
                        callback();
                    }

                } else {
                    if (reg.msg == -2) {
                        layer.msg($.t("im.groupReachUpLimit"), {
                            time: 2000
                        }, function() {});
                    } else {
                        layer.msg($.t('global.zoneApiError'));
                    }
                }

            },
            error: function() {
                layer.msg($.t('global.zoneApiError'));
            }
        });
    },
    /*--------创建新群通知-----加人通知-----*/
    createGroupNotice: function(msg) {
        //console.log("创建新群通知"+JSON.stringify(msg));
        //console.log("创建新群通知"+msg);
        if ($("#groupGroup .groupContainer").children("[data-gagaid=" + msg.gid + "]").html()) {
            var chatPeopleUl = $(".chatBoxLower .lowerLeft");
            if (chatPeopleUl.children("[data-gagaID = " + msg.gid + "]").html()) {
                if (chatPeopleUl.children(".chatPeopleChoiced").attr("data-gagaID") == msg.gid) {
                    var newPeopleArr = msg.nm;
                    var GroupMembContentLi = '';
                    var onLineNum = 0;
                    for (var i = 0; i < newPeopleArr.length; i++) {
                        GroupMembContentLi += ' <li class="GroupMembContent" data-gagaID="' + newPeopleArr[i].fid + '"><div class="GroupMembHead">' +
                            '<img class="GroupMembHeadImg" src="' + qiniuImgURL + newPeopleArr[i].member.membBigimg + '">' +
                            '<img class="GroupMembHeadLine" src="' + staticCtx + 'img/On-line.png" style="display:' + newPeopleArr[i].member.online + '">' +
                            '</div><span class="GroupMembRemarkName">' + newPeopleArr[i].member.membNickname + '</span></li>';
                        onLineNum++;
                    }
                    $("#chatBox .chatGroupMembers .GroupMembContainer").append(GroupMembContentLi);
                    var totalNum = parseInt($("#chatBox .chatGroupMembers .chatGroupTotalNum").text());
                    totalNum += newPeopleArr.length;
                    $("#chatBox .chatGroupMembers .chatGroupTotalNum").text(totalNum);
                    onLineNum += parseInt($("#chatBox .chatGroupMembers .chatGroupNum").text());
                    $("#chatBox .chatGroupMembers .chatGroupNum").text(onLineNum);
                }
            }
        } else {
            var groupLi = '<li class="showContent" data-signID="group" data-gagaID="' + msg.gid + '" data-remarkname="' + msg.gnam + '"  data-nickName="' + msg.gnam + '" data-onLine="0"   data-Languag="" data-shield="0">' +
                '<div class="showHead"><img class="headImg" src="' + staticCtx + 'img/group.png"><img class="headLine" src="' + staticCtx + 'img/shield.png" style="display:none">' +
                '</div><span class="showRemarkName">' + msg.gnam + '</span>' +
                '<span class="newsNum newsNumSingle" style="display:none">0</span></li>';
            $("#groupGroup .groupContainer").append(groupLi);
            var groupNum = $("#groupGroup .groupTitle .groupNum").text();
            groupNum++;
            $("#groupGroup .groupTitle .groupNum").text(groupNum);
        }
    },
    /*---------退群-------------*/
    backGroup: function(gagaID, th, remarkName) {
        var that = this;
        var data = {
            gid: gagaID
        };
        //console.log(data);
        $.ajax({
            type: "post",
            url: ctx + "/im/quitGroup",
            data: data,
            async: true,
            dataType: "json",
            success: function(reg) {
                //console.log("退群:"+JSON.stringify(reg));
                //console.log("退群:"+reg);      	

                that.closedChatPeople(th);
                $("#recentlyGroup .showContent").each(function() {
                    if ($(this).attr("data-gagaid") == gagaID) {
                        $(this).remove();
                        var num = $("#recentlyGroup .recentlyNum").text();
                        num--;
                        $("#recentlyGroup .recentlyNum").text(num);
                        $("#js-contactsScrollBar").mCustomScrollbar("update");
                    }
                });
                $("#js-groupScrollBar .groupContainer li").each(function() {
                    if ($(this).attr("data-gagaid") == gagaID) {
                        $(this).remove();
                        var num = $("#js-groupScrollBar .groupNum").text();
                        num--;
                        $("#js-groupScrollBar .groupNum").text(num);
                        $("#js-groupScrollBar").mCustomScrollbar("update");
                    }
                });
                layer.msg($.t("im.youBack") + remarkName + $.t("im.group"), {
                    time: 2000
                }, function() {});



            },
            error: function() {}
        });
    },
    /*---------退群通知----------------*/
    backGroupNotice: function(msg) {
        /*{"content":{"id":"bd1ecbe5ce81492b9d4cae7dda102613","message":{"type":6.0,"content":{"gid":"89b866501d2d401f90859d76705779b7"
        	,"uid":"23"}},"type":"9"},"code":0,"msg":"success"}*/
        //console.log("退群通知:"+JSON.stringify(msg));
        //console.log("退群通知:"+msg);
        var chatPeopleUl = $(".chatBoxLower .lowerLeft");
        if (chatPeopleUl.children("[data-gagaID = " + msg.gid + "]").html()) {
            if (chatPeopleUl.children(".chatPeopleChoiced").attr("data-gagaID") == msg.gid) {
                $("#chatBox .chatGroupMembers .GroupMembContainer").children("[data-gagaid=" + msg.uid + "]").remove();
                var totalNum = parseInt($("#chatBox .chatGroupMembers .chatGroupTotalNum").text());
                totalNum--;
                $("#chatBox .chatGroupMembers .chatGroupTotalNum").text(totalNum);
                var onLineNum = parseInt($("#chatBox .chatGroupMembers .chatGroupNum").text());
                onLineNum--;
                $("#chatBox .chatGroupMembers .chatGroupNum").text(onLineNum);
            }
        }

    },
    /*--------邀请好友----------*/
    invitationFriends: function(gagaID, GroupsMemberNames) {
        var data = {
            gid: gagaID,
            uids: GroupsMemberNames
        };
        //console.log(data);
        $.ajax({
            type: "post",
            url: ctx + "/im/addUsersToGroup",
            data: data,
            async: true,
            dataType: "json",
            success: function(reg) {
                //console.log("邀请好友:" + JSON.stringify(reg));
                //console.log("邀请好友:" + reg);
                if (reg.success) {
                    /*var MemberID = reg.attributes.uids;
                    if(MemberID){
                    	var arr = [];
                    	var GroupMembContentLi='';
                    	var onLineNum = 0;
                    	arr =MemberID.split(",");
                    	console.log(arr);
                    	console.log(arr.length);
                    	
                    	for(var i=0;i<arr.length;i++){
                    		GroupMembContentLi += '<li class="GroupMembContent" data-gagaid="'+arr[i]+'">'+
                    		'<div class="GroupMembHead">'+
                    		'<img class="GroupMembHeadImg" src="'+$("#friendGroup .friendContainer").children("[data-gagaid="+arr[i]+"]").find(".headImg").attr("src")+'">'+
                    		'<img class="GroupMembHeadLine" src="'+staticCtx+'img/On-line.png" style="display:'+$("#friendGroup .friendContainer").children("[data-gagaid="+arr[i]+"]").find(".headLine").css("display")+'">'+
                    		'</div><span class="GroupMembRemarkName">'+$("#friendGroup .friendContainer").children("[data-gagaid="+arr[i]+"]").attr("data-remarkname")+'</span>'+
                    		'</li>';
                    		if($("#friendGroup .friendContainer").children("[data-gagaid="+arr[i]+"]").find(".headLine").css("display")=="block"){
                    			onLineNum++;
                    		}
                    	}
                    	$("#chatBox .chatGroupMembers .GroupMembContainer").append(GroupMembContentLi);
                    	var totalNum = parseInt($("#chatBox .chatGroupMembers .chatGroupTotalNum").text());
                    	totalNum += arr.length;
                    	$("#chatBox .chatGroupMembers .chatGroupTotalNum").text(totalNum);
                    	onLineNum += parseInt($("#chatBox .chatGroupMembers .chatGroupNum").text());
                    	$("#chatBox .chatGroupMembers .chatGroupNum").text(onLineNum);
                    }*/
                } else {
                    if (reg.msg == -1) {
                        layer.msg($.t("im.memberReachUpLimit"), {
                            time: 2000
                        }, function() {});
                    }

                }

            },
            error: function() {}
        });
    },
    /*-------获取群成员------*/
    getGroupMember: function(gagaID) {
        var that = this;
        var data = {
            "gid": gagaID
        };
        $.ajax({
            type: "post",
            url: ctx + "/im/getGroupUsers",
            data: data,
            async: true,
            dataType: "json",
            success: function(reg) {
                //console.log("获取群成员:" + JSON.stringify(reg));
                //console.log("获取群成员:" + reg);
                $(".chatBoxLower .GroupMembContainer").html("");
                if (reg.success) {
                    var GroupMembLi = '';
                    for (var i = 0; i < reg.obj.length; i++) {
                        that.originalGroupsMember.push("" + reg.obj[i].member.membGagaid);
                        GroupMembLi += '<li class="GroupMembContent" data-gagaid="' + reg.obj[i].member.membGagaid + '"><div class="GroupMembHead">';
                        GroupMembLi += '<img class="GroupMembHeadImg" src="' + qiniuImgURL + reg.obj[i].member.membBigimg + '">';
                        if (reg.obj[i].online == 1) {
                            GroupMembLi += '<img class="GroupMembHeadLine" src="' + staticCtx + 'img/On-line.png">';
                        } else {
                            GroupMembLi += '<img class="GroupMembHeadLine" src="' + staticCtx + 'img/On-line.png" style="display:none">';
                        }
                        GroupMembLi += '</div><span class="GroupMembRemarkName">' + reg.obj[i].member.membNickname + '</span></li>';
                    }
                    $(".chatBoxLower .GroupMembContainer").html(GroupMembLi);
                    $(".chatBoxLower .chatGroupMembers .chatGroupNum").text(reg.attributes.onlineNum);
                    $(".chatBoxLower .chatGroupMembers .chatGroupTotalNum").text(reg.attributes.tolNum);
                } else {}

            },
            error: function() {}
        });
    },
    /*----------------删除好友------------*/
    deleteFriends: function(gagaID, th) {
        var that = this;
        var data = {
            friGagaid: gagaID
        };
        $.ajax({
            type: "post",
            url: ctx + "/Member/Friend/delFriend",
            data: data,
            async: false,
            dataType: "json",
            success: function(reg) {
                if (reg.success) {
                    if(th){
                     //个人主页删好友判断
                      that.closedChatPeople(th);
                    }
                   
                    $("#recentlyGroup .showContent").each(function() {
                        if ($(this).attr("data-gagaid") == gagaID) {
                            $(this).remove();
                            var num = $("#recentlyGroup .recentlyNum").text();
                            num--;
                            $("#recentlyGroup .recentlyNum").text(num);
                            $("#js-contactsScrollBar").mCustomScrollbar("update");
                        }
                    });
                    $("#friendGroup .showContent").each(function() {
                        if ($(this).attr("data-gagaid") == gagaID) {
                            if ($(this).attr("data-online") == "1") {
                                var friendNum = $("#friendGroup .friendNum").text();
                                friendNum--;
                                $("#friendGroup .friendNum").text(friendNum);
                            }

                            var num = $("#friendGroup .friendNumTotal").text();
                            num--;
                            $("#friendGroup .friendNumTotal").text(num);
                            $(this).remove();
                            $("#js-contactsScrollBar").mCustomScrollbar("update");
                        }
                    });
                    $("#onLineGroup .showContent").each(function() {
                        if ($(this).attr("data-gagaid") == gagaID) {
                            var onLineNum = $("#onLineGroup .onLineNum").text();
                            onLineNum--;
                            $("#onLineGroup .onLineNum").text(onLineNum);
                            $(this).remove();
                            $("#js-contactsScrollBar").mCustomScrollbar("update");
                        }
                    });
                    $("#hiddenIM .hiddenContactsCon .content").each(function() {
                        if ($(this).attr("data-gagaid") == gagaID) {
                            $(this).remove();
                            $("#js-hiddenScrollBar").mCustomScrollbar("update");
                        }
                    });
                } else {

                }
            },
            error: function() {}
        });
    },
    /*---------发送后单条翻译---收费提示 -------*/
    SendAfterTranslationDeductMoney: function(gagaID,MSGsendID, msgId, content, language, th) {
        var that = this;
        var msgMoney = content;
        var data = {
            msg: msgMoney
        };
        $.ajax({
            type: "post",
            url: ctx + "/im/getTranGold",
            data: data,
            async: false,
            dataType: "json",
            success: function(reg) {
                // console.log("发送后单条翻译扣金币："+JSON.stringify(reg));
                //console.log("发送后单条翻译扣金币："+reg);
                //1:扣费1员，0：不扣费；-1：余额不足；3：需要提示；4：不需要提示
                if (reg.success) {
                    if (reg.obj == 0 || reg.obj == 4) {
                        that.SendAfterTranslation(gagaID,MSGsendID, msgId, content, language, th);
                    } else if (reg.obj == -1) {
                        var contentTip = '<div class="textCenter marT5">' + $.t("im.goldLack")  + '</div>';
                        layer.open({
                            title: false,
                            content: contentTip,
                            skin: 'noTitleTips',
                            btn: [$.t("im.ToRecharge")],
                            yes: function(index, layero) {
                                window.location.href = ctx + "/pay/recharge";
                                layer.close(index);
                            }
                        });
                    } else if( reg.obj == 3){
                        var contentTip = '<div class="textCenter marT5"><div class="deductMoneyTXT">' + $.t("im.translationNeeds") + $.t("im.goldContinue") + '</div></div>';
                        layer.open({
                            title: false,
                            content: contentTip,
                            skin: 'noTitleTips',
                            btn: [$.t("global.ok"), $.t("global.cancel")],
                            yes: function(index, layero) {
                                $.post(ctx + "/im/okTransTip",function(msg){})
                                $.IM.SendAfterTranslation(gagaID, MSGsendID,msgId, content, language, th);
                                layer.close(index);
                            },
                            cancel: function(index) {
                                layer.close(index);
                            },
                        });
                    }

                } else {}



            },
            error: function() {}
        });
    },
    /*---------发送后单条翻译----------*/
    SendAfterTranslation: function(gagaID,MSGsendID, msgId, content, language, th) {
        var that = this;
        var data = {
            sendid:MSGsendID,
            rid: gagaID,
            msgId: msgId,
            msg: content,
            to: language
        };
        //console.log(data);
        if (!content) {
            layer.msg($.t("im.translationFailed"), {time: 2000 }, function() {});
            return;
        }
        $.ajax({
            url: ctx + "/im/translate",
            data: data,
            type: 'post',
            cache: false,
            dataType: 'json',
            success: function(reg) {
                // console.log("发送后单条翻译" + JSON.stringify(reg));
                //console.log("发送后单条翻译" + reg);

                if (reg.success) {
                    that.getMoneyNum();
                    that.getTranslationCharacterNum();
                    th.parents(".msgContent").find(".translateBtn").hide();
                    th.parents(".msgContent").find(".translationContainer").show();
                    th.parents(".msgContent").find(".translationLan").html(that.replace_em(reg.obj.result)).css("color", "#333").show();

                } else {
                    layer.msg($.t("im.translationFailed"), {time: 2000 }, function() {});
                }
            },
            error: function() {

            }
        });
    },
    /*-------------加好友通知-----------*/
    addFriendNoticeFun: function(reg) {
        //console.log("添加好友："+JSON.stringify(reg));
        
        if (!$("#friendGroup .FoldContainer").children("[data-gagaID = " + reg.frieFriendgagaid + "]").html()) {
            var that = this;
            var totalNum = $("#hiddenIM .hiddenContactsCon .content").length;
           // var recentlyShowLi="";
            var friendShowLi = "";
            var friendHideLi = "";
            friendShowLi += '<li class="showContent" data-signID="people" data-gagaID="' + reg.frieFriendgagaid + '" data-remarkname="' + reg.frieNickname + '"  data-nickName="' + reg.frieNickname + '" data-shield="0" data-onLine="' + reg.online + '" data-Language="' + reg.member.membLanguage + '">' + '<div class="showHead"> <img class="headImg" src="' + qiniuImgURL + reg.member.membBigimg + '">';
           // recentlyShowLi = friendShowLi;
            if (totalNum / 2 == 1) {
                friendHideLi += '<li class="content singleNum" data-signID="people" data-gagaID="' + reg.frieFriendgagaid + '" data-remarkname="' + reg.frieNickname + '" data-nickName="' + reg.frieNickname + '" data-shield="0" data-onLine="' + reg.online + '" data-Language="' + reg.member.membLanguage + '">';
            } else {
                friendHideLi += '<li class="content bothNum" data-signID="people" data-gagaID="' + reg.frieFriendgagaid + '" data-remarkname="' + reg.frieNickname + '" data-nickName="' + reg.frieNickname + '" data-shield="0" data-onLine="' + reg.online + '" data-Language="' + reg.member.membLanguage + '">';
            }
            friendHideLi += '<div class="headDiv"><img class="headImg" src="' + qiniuImgURL + reg.member.membBigimg + '">';
            if (reg.frieIsshield == 1) {
                that.shieldArr.push("" + reg.frieFriendgagaid);
                friendShowLi += '<img class="headLine" src="' + staticCtx + 'img/shield.png" style="display:block">';
               //  recentlyShowLi = friendShowLi;
                friendHideLi += '<img class="headLine" src="' + staticCtx + 'img/shield.png" style="display:block">';
            } else {
                if (reg.online == "1") {
                    friendShowLi += '<img class="headLine" src="' + staticCtx + 'img/On-line.png" style="display:block">';
                   // recentlyShowLi = friendShowLi;
                    friendHideLi += '<img class="headLine" src="' + staticCtx + 'img/On-line.png" style="display:block">';
                } else {
                    friendShowLi += '<img class="headLine" src="' + staticCtx + 'img/On-line.png" style="display:none">';
                   // recentlyShowLi = friendShowLi;
                    friendHideLi += '<img class="headLine" src="' + staticCtx + 'img/On-line.png" style="display:none">';
                }
            }
            
            friendShowLi += '</div><span class="showRemarkName">' + reg.frieNickname + '</span><span class="newsNum newsNumSingle" style="display:none">0</span></li>';
          //  recentlyShowLi+= '</div><span class="showRemarkName">' + reg.frieNickname + '</span><span class="newsNum newsNumSingle" style="display:none">0</span></li>';
            friendHideLi += '</div></li>';
           // $("#recentlyGroup .FoldContainer").prepend(recentlyShowLi);
            $("#friendGroup .friendContainer").append(friendShowLi);
            $("#hiddenIM .hiddenContactsCon").append(friendHideLi);
            if(reg.online == 1){
                $("#onLineGroup .onLineContainer").append(friendShowLi);
                 var onLineNum = $("#onLineGroup .onLineNum").text();
                onLineNum++;
                $("#onLineGroup .onLineNum").text(onLineNum);
            }
            
           /* var recentlyNumTotal = $("#recentlyGroup .recentlyNum").text();
            recentlyNumTotal++;
            $("#recentlyGroup .recentlyNum").text(recentlyNumTotal);*/
            /*---------------------*/
            var friendNumTotal = $("#friendGroup .friendNumTotal").text();
            friendNumTotal++;
            $("#friendGroup .friendNumTotal").text(friendNumTotal);
            /*---------------------*/
            if (reg.online == "1") {
                var friendNum = $("#friendGroup .friendNum").text();
                friendNum++;
                $("#friendGroup .friendNum").text(friendNum);
            }
            //----------------右侧--隐藏时显示提示---------------------
            $("#js-contactsScrollBar").mCustomScrollbar("update");
            $("#js-hiddenScrollBar").mCustomScrollbar("update");
        }
    },
    /*---------发送后单条翻译-----接受对方推的译文----------*/
    SendAfterTranslationPush: function(msg) {
        var that = this;
        var div = $("#chatBox .lowerRight").children("[data-gagaID = " + msg.rid + "]").find("[data-ranid=" + msg.msgid + "]");
        div.find(".translateBtn").hide();
        div.find(".translationContainer").show();
        div.find(".translationLan").text(that.replace_em(msg.result));

    },
    /*------修改备注--------*/
    modifyRemarkName: function(th, gagaID, RemarkName,reduction) {
        var data = {
            fid: gagaID,
            nickname: RemarkName,
            isReduction:reduction
        };
        //console.log(data)
        $.ajax({
            url: ctx + "/im/updateFAndGName",
            data: data,
            type: 'post',
            cache: false,
            dataType: 'json',
            success: function(reg) {
                // console.log("修改备注" + JSON.stringify(reg));
                // console.log("修改备注" + reg);
                if (reg.success) {
                    th.parent().hide();
                    th.parent().prev().find(".chatRemarkNameIng").text(RemarkName);
                    th.parent().prev().show();
                    if ($(".chatBoxLower .lowerLeft").children("[data-gagaid=" + gagaID + "]").html()) {
                        $(".chatBoxLower .lowerLeft").children("[data-gagaid=" + gagaID + "]").attr("data-remarkname", RemarkName);
                        $(".chatBoxLower .lowerLeft").children("[data-gagaid=" + gagaID + "]").children(".chatRemarkName").text(RemarkName);
                    }

                    $("#recentlyGroup .showContent").each(function() {
                        if ($(this).attr("data-gagaid") == gagaID) {
                            $(this).attr("data-remarkname", RemarkName);
                            $(this).children(".showRemarkName").text(RemarkName);
                        }
                    });
                    $("#friendGroup .showContent").each(function() {
                        if ($(this).attr("data-gagaid") == gagaID) {
                            $(this).attr("data-remarkname", RemarkName);
                            $(this).children(".showRemarkName").text(RemarkName);
                        }
                    });
                    $("#onLineGroup .showContent").each(function() {
                        if ($(this).attr("data-gagaid") == gagaID) {
                            $(this).attr("data-remarkname", RemarkName);
                            $(this).children(".showRemarkName").text(RemarkName);
                        }
                    });
                    $("#groupGroup .groupContainer .showContent").each(function() {
                        if ($(this).attr("data-gagaid") == gagaID) {
                            $(this).attr("data-remarkname", RemarkName);
                            $(this).children(".showRemarkName").text(RemarkName);
                        }
                    });
                    $("#hiddenIM .hiddenContactsCon .content").each(function() {
                        if ($(this).attr("data-gagaid") == gagaID) {
                            $(this).attr("data-remarkname", RemarkName);
                        }
                    });
                } else {}
            },
            error: function() {

            }
        });
    },
    /*------------屏蔽----------------*/
    ShieldFun: function(gagaID, shield, th) {
        var that = this;
        var data = {
            fid: gagaID,
            pb: shield
        };
        $.ajax({
            url: ctx + "/im/pbFriend",
            data: data,
            type: 'post',
            cache: false,
            dataType: 'json',
            success: function(reg) {
                // console.log("屏蔽" + JSON.stringify(reg));
                // console.log("屏蔽" + reg);
                if (reg.success) {
                    if (shield == 1) {
                        that.shieldArr.push("" + gagaID);
                        th.attr("data-shield", "0").text($.t("im.cancelShield"));

                        if ($(".chatBoxLower .lowerLeft").children("[data-gagaid=" + gagaID + "]").html()) {
                            $(".chatBoxLower .lowerLeft").children("[data-gagaid=" + gagaID + "]").attr("data-shield", shield);
                            $(".chatBoxLower .lowerLeft").children("[data-gagaid=" + gagaID + "]").find(".headLine").attr("src", staticCtx + "img/shield.png").show();

                            var signID = $(".chatBoxLower .lowerLeft").children("[data-gagaid=" + gagaID + "]").attr("data-signid");
                            var receiveMessageDiv = '';
                            if (signID == "people") {
                                receiveMessageDiv = '<div class="likeEachOther"><span class="likeEachOtherSpan">' + $.t("im.shieldEachOther") + '</span></div>';
                            } else {
                                receiveMessageDiv = '<div class="likeEachOther"><span class="likeEachOtherSpan">' + $.t("im.shieldGroup") + '</span></div>';
                            }
                            $(".lowerRight").children("[data-gagaID = " + gagaID + "]").find(".chatCon").append(receiveMessageDiv);
                        }
                        $("#recentlyGroup .showContent").each(function() {
                            if ($(this).attr("data-gagaid") == gagaID) {
                                $(this).attr("data-shield", shield);
                                $(this).find(".headLine").attr("src", staticCtx + "img/shield.png").show();
                            }
                        });
                        $("#friendGroup .showContent").each(function() {
                            if ($(this).attr("data-gagaid") == gagaID) {
                                $(this).attr("data-shield", shield);
                                $(this).find(".headLine").attr("src", staticCtx + "img/shield.png").show();
                            }
                        });
                        $("#onLineGroup .showContent").each(function() {
                            if ($(this).attr("data-gagaid") == gagaID) {
                                $(this).attr("data-shield", shield);
                                $(this).find(".headLine").attr("src", staticCtx + "img/shield.png").show();
                            }
                        });
                        $("#groupGroup .groupContainer .showContent").each(function() {
                            if ($(this).attr("data-gagaid") == gagaID) {
                                $(this).attr("data-shield", shield);
                                $(this).find(".headLine").attr("src", staticCtx + "img/shield.png").show();
                            }
                        });
                        $("#hiddenIM .hiddenContactsCon .content").each(function() {
                            if ($(this).attr("data-gagaid") == gagaID) {
                                $(this).attr("data-shield", shield);
                                $(this).find(".headLine").attr("src", staticCtx + "img/shield.png").show();
                            }
                        });
                    } else {
                        that.shieldArr.splice($.inArray(gagaID, that.shieldArr), 1);
                        th.attr("data-shield", "1").text($.t("im.Shield"));


                        if ($(".chatBoxLower .lowerLeft").children("[data-gagaid=" + gagaID + "]").html()) {
                            $(".chatBoxLower .lowerLeft").children("[data-gagaid=" + gagaID + "]").attr("data-shield", shield);
                            if ($(".chatBoxLower .lowerLeft").children("[data-gagaid=" + gagaID + "]").attr("data-online") == 1) {
                                $(".chatBoxLower .lowerLeft").children("[data-gagaid=" + gagaID + "]").find(".headLine").attr("src", staticCtx + "img/On-line.png").show();
                            } else {
                                $(".chatBoxLower .lowerLeft").children("[data-gagaid=" + gagaID + "]").find(".headLine").attr("src", staticCtx + "img/On-line.png").hide();
                            }

                            var signID = $(".chatBoxLower .lowerLeft").children("[data-gagaid=" + gagaID + "]").attr("data-signid");
                            var receiveMessageDiv = '';
                            if (signID == "people") {
                                receiveMessageDiv = '<div class="likeEachOther"><span class="likeEachOtherSpan">' + $.t("im.cancelShieldEachOther") + '</span></div>';
                            } else {
                                receiveMessageDiv = '<div class="likeEachOther"><span class="likeEachOtherSpan">' + $.t("im.cancelShieldGroup") + '</span></div>';
                            }
                            $(".lowerRight").children("[data-gagaID = " + gagaID + "]").find(".chatCon").append(receiveMessageDiv);
                        }

                        $("#recentlyGroup .showContent").each(function() {
                            if ($(this).attr("data-gagaid") == gagaID) {
                                $(this).attr("data-shield", shield);
                                if ($(this).attr("data-online") == 1) {
                                    $(this).find(".headLine").attr("src", staticCtx + "img/On-line.png").show();
                                } else {
                                    $(this).find(".headLine").attr("src", staticCtx + "img/On-line.png").hide();
                                }
                            }
                        });
                        $("#friendGroup .showContent").each(function() {
                            if ($(this).attr("data-gagaid") == gagaID) {
                                $(this).attr("data-shield", shield);
                                if ($(this).attr("data-online") == 1) {
                                    $(this).find(".headLine").attr("src", staticCtx + "img/On-line.png").show();
                                } else {
                                    $(this).find(".headLine").attr("src", staticCtx + "img/On-line.png").hide();
                                }
                            }
                        });
                        $("#onLineGroup .showContent").each(function() {
                            if ($(this).attr("data-gagaid") == gagaID) {
                                $(this).attr("data-shield", shield);
                                if ($(this).attr("data-online") == 1) {
                                    $(this).find(".headLine").attr("src", staticCtx + "img/On-line.png").show();
                                } else {
                                    $(this).find(".headLine").attr("src", staticCtx + "img/On-line.png").hide();
                                }
                            }
                        });
                        $("#groupGroup .groupContainer .showContent").each(function() {
                            if ($(this).attr("data-gagaid") == gagaID) {
                                $(this).attr("data-shield", shield);
                                $(this).find(".headLine").attr("src", staticCtx + "img/On-line.png").hide();
                            }
                        });
                        $("#hiddenIM .hiddenContactsCon .content").each(function() {
                            if ($(this).attr("data-gagaid") == gagaID) {
                                $(this).attr("data-shield", shield);
                                if ($(this).attr("data-online") == 1) {
                                    $(this).find(".headLine").attr("src", staticCtx + "img/On-line.png").show();
                                } else {
                                    $(this).find(".headLine").attr("src", staticCtx + "img/On-line.png").hide();
                                }
                            }
                        });
                    }
                    $(".lowerRight [data-gagaID = " + gagaID + "]").children(".chatContent").mCustomScrollbar("update");
                    $(".lowerRight [data-gagaID = " + gagaID + "]").children(".chatContent").mCustomScrollbar("scrollTo", "bottom");
                } else {}
            },
            error: function() {}
        });
    },
    /*----------用户上线-------------*/
    userOnline: function(gagaID) {
        //console.log("用户上线:"+JSON.stringify(gagaID));
        // console.log("用户上线:"+gagaID);

        if ($("#friendGroup .FoldContainer").children("[data-gagaid=" + gagaID + "]").html()) {
            if ($("#friendGroup .FoldContainer").children("[data-gagaid=" + gagaID + "]").attr("data-online") == 0) {
                if ($(".chatBoxLower .lowerLeft").children("[data-gagaid=" + gagaID + "]").html()) {
                    $(".chatBoxLower .lowerLeft").children("[data-gagaid=" + gagaID + "]").attr("data-online", "1");

                    if ($(".chatBoxLower .lowerLeft").children("[data-gagaid=" + gagaID + "]").attr("data-shield") == 0) {
                        $(".chatBoxLower .lowerLeft").children("[data-gagaid=" + gagaID + "]").find(".headLine").attr("src", staticCtx + "img/On-line.png").show();
                    }
                }
                if ($(".chatBoxLower .GroupMembContainer").children("[data-gagaid=" + gagaID + "]").html()) {
                    $(".chatBoxLower .GroupMembContainer").children("[data-gagaid=" + gagaID + "]").find(".GroupMembHeadLine").show();
                }

                $("#recentlyGroup .showContent").each(function() {
                    if ($(this).attr("data-gagaid") == gagaID) {
                        $(this).attr("data-online", "1");
                        if ($(this).attr("data-shield") == 0) {
                            $(this).find(".headLine").attr("src", staticCtx + "img/On-line.png").show();
                        }
                    }
                });
                $("#friendGroup .showContent").each(function() {
                    if ($(this).attr("data-gagaid") == gagaID) {
                        $(this).attr("data-online", "1");
                        var num = $("#friendGroup .friendNum").text();
                        num++;
                        $("#friendGroup .friendNum").text(num);
                        if ($(this).attr("data-shield") == 0) {
                            $(this).find(".headLine").attr("src", staticCtx + "img/On-line.png").show();
                        }
                        
                        var onLineNum = $("#onLineGroup .onLineNum").text();
                        onLineNum++;
                        $("#onLineGroup .onLineNum").text(onLineNum);
                        $("#onLineGroup .FoldContainer").prepend($(this).clone());
                    }
                });
                $("#hiddenIM .hiddenContactsCon .content").each(function() {
                    if ($(this).attr("data-gagaid") == gagaID) {
                        $(this).attr("data-online", "1");
                        if ($(this).attr("data-shield") == 0) {
                            $(this).find(".headLine").attr("src", staticCtx + "img/On-line.png").show();
                        }
                    }
                });

            }
        }


    },
    /*----------用户下线-------------*/
    userOffline: function(userArr) {
        //console.log("用户下线:"+JSON.stringify(userArr));
        // console.log("用户下线:"+userArr);
        $(".chatBoxLower .lowerLeft").children("li").each(function() {
            var gagaID = $(this).attr("data-gagaid");
            if ($.inArray(gagaID, userArr) > -1) {
                if ($(this).attr("data-online") == 1) {
                    $(this).attr("data-online", "0");
                }
                if ($(this).attr("data-shield") == 0) {
                    $(this).find(".headLine").hide();
                }
            }
        });
        $("#chatBox .GroupMembContainer .GroupMembContent").each(function() {
            var gagaID = $(this).attr("data-gagaid");
            if ($.inArray(gagaID, userArr) > -1) {
                if ($(this).attr("data-online") == 1) {
                    $(this).attr("data-online", "0");
                }
                $(this).find(".GroupMembHeadLine").hide();

            }
        });



        $("#recentlyGroup .showContent").each(function() {
            var gagaID = $(this).attr("data-gagaid");
            if ($.inArray(gagaID, userArr) > -1) {
                if ($(this).attr("data-online") == 1) {
                    $(this).attr("data-online", "0");
                }
                if ($(this).attr("data-shield") == 0) {
                    $(this).find(".headLine").hide();
                }
            }
        });
        $("#friendGroup .showContent").each(function() {
            var gagaID = $(this).attr("data-gagaid");
            if ($.inArray(gagaID, userArr) > -1) {
                if ($(this).attr("data-online") == 1) {
                    $(this).attr("data-online", "0");
                    var num = $("#friendGroup .friendNum").text();
                    num--;
                    $("#friendGroup .friendNum").text(num);
                }
                if ($(this).attr("data-shield") == 0) {
                    $(this).find(".headLine").hide();
                }
            }
        });
        $("#onLineGroup .showContent").each(function(){
            var gagaID = $(this).attr("data-gagaid");
             if ($.inArray(gagaID, userArr) > -1) {
                 $(this).remove();
                  var onLineNum = $("#onLineGroup .onLineNum").text();
                    onLineNum--;
                    $("#onLineGroup .onLineNum").text(onLineNum);
             }
        });
        
        $("#hiddenIM .hiddenContactsCon .content").each(function() {
            var gagaID = $(this).attr("data-gagaid");
            if ($.inArray(gagaID, userArr) > -1) {
                if ($(this).attr("data-online") == 1) {
                    $(this).attr("data-online", "0");
                }
                if ($(this).attr("data-shield") == 0) {
                    $(this).find(".headLine").hide();
                }
            }
        });
    },
    /*---------删除历史纪录-----------*/
    historicalDeleteFun: function(gagaID) {
        var data = {
            rid: gagaID
        };
        $.ajax({
            url: ctx + "/im/delChat",
            data: data,
            type: 'post',
            cache: false,
            dataType: 'json',
            success: function(reg) {
                /* console.log("删除历史纪录" + JSON.stringify(reg));
		         console.log("删除历史纪录" + reg);*/
                if (reg.success) {
                    $.IM.timeArr[gagaID] = "";
                    $("#chatBox .chatHistorical .historicalCon").html("");
                    $("#chatBox .lowerRight").children("[data-gagaid=" + gagaID + "]").find(".chatCon").html("");



                } else {}
            },
            error: function() {}
        });
    },
    /*------------举报-------------------*/
    reportFun: function(gagaID, TXT, signID) {
        if (signID == "people") {
            var data = {
                type: "I",
                id: "-1",
                isGagaId: gagaID,
                reason: TXT
            };
        } else {
            var data = {
                type: "I",
                id: gagaID,
                isGagaId: "-1",
                reason: TXT
            };
        }
        $.ajax({
            url: ctx + "/Report/report",
            data: data,
            type: 'post',
            cache: false,
            dataType: 'json',
            success: function(reg) {
                //console.log("举报："+JSON.stringify(reg));
                //console.log("举报："+reg);
                if (reg.success) {
                    layer.msg(reg.msg, {
                        time: 1000
                    }, function() {});
                } else {
                    layer.msg(reg.msg, {
                        time: 1000
                    }, function() {});
                }
            },
            error: function() {}
        });
    },
    /*------------发送时有翻译---扣金币提示---------*/
    deductMoney: function(gagaID, inputBoxVal, inputBoxContent, imgUrl, targetLan, signId) {
        var that = this;
        var msgMoney = that.deleteQQFace(inputBoxVal).trim();
        var data = {
            msg: msgMoney
        };
        $.ajax({
            type: "post",
            url: ctx + "/im/getTranGold",
            data: data,
            async: false,
            dataType: "json",
            success: function(reg) {
                // console.log("翻译字符扣金币："+JSON.stringify(reg));
                // console.log("翻译字符扣金币："+reg);
                //1:扣费1员，0：不扣费；-1：余额不足；3：需要提示；4：不需要提示
                if (reg.success) {
                    if (reg.obj == 0 ||reg.obj == 4) {
                        that.SendMessage(gagaID, inputBoxVal, inputBoxContent, imgUrl, targetLan, signId);
                    } else if (reg.obj == -1) {
                        var contentTip = '<div class="textCenter marT5">' + $.t("im.goldLack")  + '</div>';
                        layer.open({
                            title: false,
                            content: contentTip,
                            skin: 'noTitleTips',
                            btn: [$.t("im.ToRecharge")],
                            yes: function(index, layero) {
                                window.location.href = ctx + "/pay/recharge";
                                layer.close(index);
                            }
                        });
                    } else if(reg.obj == 3){
                        var contentTip = '<div class="textCenter marT5"><div class="deductMoneyTXT">' + $.t("im.translationNeeds") + $.t("im.goldContinue") + '</div></div>';
                        layer.open({
                            title: false,
                            content: contentTip,
                            skin: 'noTitleTips',
                            btn: [$.t("global.ok"), $.t("global.cancel")],
                            yes: function(index, layero) {
                                $.post(ctx + "/im/okTransTip",function(msg){})
                                that.SendMessage(gagaID, inputBoxVal, inputBoxContent, imgUrl, targetLan, signId);
                                layer.close(index);
                            },
                            cancel: function(index) {
                                layer.close(index);
                            },
                        });
                    }

                } else {}



            },
            error: function() {}
        });
    },
    /*------------------对话框拖动------移动端/PC--------------*/
    mobileDragEvent: function(dragTarget, moveTarget) {
        var dragextend = {
            //判断设备是否支持touch事件
            touch: ('ontouchstart' in window) || window.DocumentTouch && document instanceof DocumentTouch,
            slider: document.getElementById(dragTarget),
            //事件
            events: {
                handleEvent: function(event) {
                    var self = this; //this指events对象
                    if (event.type == 'touchstart') {
                        self.start(event);
                    } else if (event.type == 'touchmove') {
                        self.move(event);
                    } else if (event.type == 'touchend') {
                        self.end(event);
                    }
                },
                //开始
                start: function(event) {
                    var touch = event.targetTouches[0]; //touches数组对象获得屏幕上所有的touch，取第一个touch
                    startPos = {
                        x: touch.pageX - $("#" + dragTarget).offset().left,
                        y: touch.pageY - $("#" + dragTarget).offset().top
                    }; //取第一个touch的坐标值
                    document.getElementById(dragTarget).addEventListener('touchmove', this, false);
                    document.getElementById(dragTarget).addEventListener('touchend', this, false);
                },
                //移动
                move: function(event) {
                    event.preventDefault();
                    //当屏幕有多个touch或者页面被缩放过，就不执行move操作
                    if (event.targetTouches.length > 1 || event.scale && event.scale !== 1) return;
                    var touch = event.targetTouches[0];
                    endPos = {
                        x: touch.pageX - startPos.x - $(document).scrollLeft(),
                        y: touch.pageY - startPos.y - $(document).scrollTop()
                    };
                    var obj = $("#" + moveTarget);
                    obj.css({
                        'left': endPos.x,
                        'top': endPos.y
                    });
                },
                //释放
                end: function(event) {
                    //解绑事件
                    document.getElementById(dragTarget).removeEventListener('touchmove', this, false);
                    document.getElementById(dragTarget).removeEventListener('touchend', this, false);
                }
            },
            //初始化
            init: function() {
                var self = this; //this指slider对象
                if (!!self.touch) self.slider.addEventListener('touchstart', self.events, false); //addEventListener第二个参数可以传一个对象，会调用该对象的handleEvent属性
            }
        };
        dragextend.init();
    },
    dragEvent: function(dragTarget, moveTarget) {
        $(dragTarget).mousedown(function(e) {
            var isMove = true;
            var abs_x = e.pageX - $(moveTarget).offset().left;
            var abs_y = e.pageY - $(moveTarget).offset().top;
            $(document).mousemove(function(e) {
                $.IM.isClick = false;
                if (isMove) {
                    var obj = $(moveTarget);
                    obj.css({
                        'left': e.pageX - abs_x,
                        'top': e.pageY - (abs_y + $(document).scrollTop())
                    });
                }
                return false;
            }).mouseup(function(e) {
                $.IM.isClick = true;
                isMove = false;
                $(document).unbind('mousemove');
                $(document).unbind('mouseup');
            });
           //return false;
        });
    },
    /*-----查看大图------*/
    bigImgPreview: function(th) {
        var imgDIV = '<img src="' + $(th).attr("src") + '" style="max-width:600px;max-height:600px;border-radius: 10px;">';
        layer.open({
            type: 1,
            title: false,
            maxWidth: 650,
            skin: 'bigImgClosed-class',
            content: imgDIV
        });
    },
    /*--------关闭--showIM--中对应gagaID的人的新消息提醒----------*/
    closedShowMSGTip: function(gagaID) {
        if ($("#showIM").find("[data-gagaID = " + gagaID + "]").html()) {
            var th = $("#showIM").find("[data-gagaID = " + gagaID + "]");
            if(th.children(".newsNum").hasClass("newsNumDouble")){
                th.children(".newsNum").removeClass("newsNumDouble").addClass("newsNumSingle");
            }
            
            th.children(".newsNum").hide().text("0");
        }
    },
    /*--------关闭--hiddenIM--中新消息提醒----------*/
    closedHideMSGTip: function() {
        var newsArriveBool = false;
        $("#showIM .newsNum").each(function() {
            if ($(this).text() > 0) {
                newsArriveBool = true;
            }
        });
        if (newsArriveBool) {
            $("#js-newsArrive").show();
        } else {
            $("#js-newsArrive").hide();
        }
    },
    /*------判断点击的是人?组?客服------*/
    clickedPeopleORgroup: function(signID, gagaID) {
        if (signID == "people") {
            if (gagaID == "-1") {
                $(".chatBoxUpper .modifyBtn").hide();
                $(".chatBoxUpper .functionBtn").hide();
                $(".chatBoxUpper .createGroupBtn").hide();                
                $('#chatBox .service').removeClass('hide');
                $('#chatBox .normal').addClass('hide');     
            } else {
                $(".chatBoxUpper .modifyBtn").show();
                $(".chatBoxUpper .functionBtn").show();
                $(".chatBoxUpper .createGroupBtn").show();
                $('#chatBox .service').addClass('hide');
                $('#chatBox .normal').removeClass('hide');
                $('#chatBox .normal').removeClass('gp');
            }
            $(".chatBoxUpper .inviteFriends").hide();
            $(".chatBoxUpper .functionBack").hide();
            $(".chatBoxUpper .functionRelationState").show();
            $(".chatBoxLower .chatGroupMembers").hide();
            $(".upperRight").width(608);
            $("#chatBox").width(730);
        } else {
            $(".chatBoxUpper .modifyBtn").show();
            $(".chatBoxUpper .functionBtn").show();
            $(".chatBoxUpper .createGroupBtn").hide();
            $(".chatBoxUpper .functionRelationState").hide();
            $(".chatBoxUpper .inviteFriends").show();
            $(".chatBoxUpper .functionBack").show();
            $(".chatBoxLower .chatGroupMembers").show();
            $(".upperRight").width(729);
            $("#chatBox").width(850);
            $('#chatBox .service').addClass('hide');
            $('#chatBox .normal').removeClass('hide');
            $('#chatBox .normal').addClass('gp');
            $.IM.getGroupMember(gagaID);
        }
    },
    /*----------人物聊天切换时恢复默认---------------*/
    resetChatBoxStyles: function(signID,Language) {
        $(".FunBtncontainer .sendBtn").css({
            "color": "#696969",
            "background-color": "#fff"
        });
        $(".chatBoxLower .inputBox").val($.t("im.enterKeySend"));
        $(".chatBoxLower .HistoricalRecords").css("display","block");
        $(".chatBoxLower .HistoricalRecordsClosed").css("display","none");
        $(".chatHistorical").hide();
        $(".chatBoxUpper .modifyContent").show();
        $(".chatBoxUpper .modifyContainer").hide();
        
        if(sendGender =="1" && signID == "people"){
            switch(Language){ 
                    case "en":
                        $(".languageOptions .language").attr("langs-lang", "en").text("English");
                        break;
                    case "zh":
                        $(".languageOptions .language").attr("langs-lang", "zh").text("简体中文");
                        break;
                    case "cht":
                        $(".languageOptions .language").attr("langs-lang", "cht").text("繁體中文");
                        break;
                    case "kor":
                        $(".languageOptions .language").attr("langs-lang", "kor").text("한국어");
                        break;
                    case "ru":
                        $(".languageOptions .language").attr("langs-lang", "ru").text("Pусский");
                        break;
                    case "de":
                        $(".languageOptions .language").attr("langs-lang", "de").text("Deutsch");
                        break;
                    case "spa":
                        $(".languageOptions .language").attr("langs-lang", "spa").text("Español");
                        break;
                    case "jp":
                        $(".languageOptions .language").attr("langs-lang", "jp").text("日本語");
                        break;
                    default:
                        $(".languageOptions  .language").attr("langs-lang", "").text("不翻译");
                        break;
                }
        }else{
             $(".languageOptions .language").attr("langs-lang", "").text($.t("im.noTranslate"));
        }
    },
    /*----------人物聊天切换时屏蔽显示---------------*/
    shieldState: function(shield) {
        if (shield == 0) {
            $("#chatBox .functionShieldState").attr("data-shield", "1").text($.t("im.Shield"));
        } else {
            $("#chatBox .functionShieldState").attr("data-shield", "0").text($.t("im.cancelShield"));
        }
    },
    RestoreDefaultsCreateGroup: function() {
        var PopupCreateGroup = $("#PopupCreateGroup");
        PopupCreateGroup.find(".searchInput").val($.t("im.searchContacts"));
        PopupCreateGroup.find(".PeopleNum").text("1");
        PopupCreateGroup.find(".SelectedPeople").empty();
        $("#CreateGroupRecently .CreateGroupRecentlyContainer").html("");
        $("#CreateGroupFriend .CreateGroupFriendContainer").html("");

    },
    /*------------------建群------加好友---------------------*/
    createGroupAndaddFriends: function() {
        var that = this;
        that.RestoreDefaultsCreateGroup();
        var PopupCreateGroup = $("#PopupCreateGroup");
        PopupCreateGroup.show();
        PopupCreateGroup.css({
            "top": ((that.winH - PopupCreateGroup.height()) / 2),
            "left": ((that.winW - PopupCreateGroup.width()) / 2)
        });
        if (PopupCreateGroup.attr("data-CreateGroup") == "true") {
            var Li = '<li class="CreateGroupContent"  data-gagaID="' + myId + '" data-remarkname="' + myNickname + '">' +
                '<div class="CreateGroupHead">' +
                '<img class="CreateGroupHeadImg" src="' + qiniuImgURL + sendHeadImgUrl + '">' +
                '<img class="CreateGroupHeadLine" src="' + staticCtx + 'img/On-line.png" style="display:block"></div>' +
                '<span class="CreateGroupRemarkName">' + myNickname + '</span></li>';
            $(".CreateGroupRight .SelectedPeople").append(Li);
        }



        var recentlyNum = 0;
        var recentlyLi = '';
        var friendLi = '';
        $("#js-contactsScrollBar .recentlyContainer .showContent:not('[data-signid=group]')").each(function() {
            var th = $(this);
            recentlyLi += ' <li class="CreateGroupContent" data-gagaid="' + th.attr("data-gagaid") + '" data-remarkname="' + th.attr("data-remarkname") + '"><div class="CreateGroupHead">' +
                '<img class="CreateGroupHeadImg" src="' + th.find(".headImg").attr("src") + '">' +
                '<img class="CreateGroupHeadLine" style="display:' + th.find(".headLine").css("display") + '" src="' + th.find(".headLine").attr("src") + '"></div>';
            if ($.inArray(th.attr("data-gagaid"), $.IM.originalGroupsMember) == -1) {
                recentlyLi += '<span class="CreateGroupRemarkName">' + th.children(".showRemarkName").text() + '</span></li>';
            } else {
                recentlyLi += '<span class="CreateGroupRemarkName c-DCDCDC">' + th.children(".showRemarkName").text() + '</span></li>';
            }
            recentlyNum++;
        });

        $("#PopupCreateGroup .CreateGroupRecentlyContainer").append(recentlyLi);
        $("#js-contactsScrollBar .friendContainer .showContent").each(function() {
            var th = $(this);
            friendLi += '<li class="CreateGroupContent" data-gagaid="' + th.attr("data-gagaid") + '" data-remarkname="' + th.attr("data-remarkname") + '"><div class="CreateGroupHead">' +
                '<img class="CreateGroupHeadImg" src="' + th.find(".headImg").attr("src") + '">' +
                '<img class="CreateGroupHeadLine" style="display:' + th.find(".headLine").css("display") + '" src="' + th.find(".headLine").attr("src") + '"></div>';
            if ($.inArray(th.attr("data-gagaid"), $.IM.originalGroupsMember) == -1) {
                friendLi += '<span class="CreateGroupRemarkName">' + th.attr("data-remarkname") + '</span></li>';
            } else {
                friendLi += '<span class="CreateGroupRemarkName c-DCDCDC">' + th.attr("data-remarkname") + '</span></li>';
            }

        });
        $("#PopupCreateGroup .CreateGroupFriendContainer").append(friendLi);
        $("#PopupCreateGroup .recentlyNum").text(recentlyNum);
        $("#PopupCreateGroup .friendNum").text($("#friendGroup .friendNum").text());
        $("#PopupCreateGroup .friendNumTotal").text($("#friendGroup .friendNumTotal").text());
    },
    /*---------点击人关闭对话框--------删除好友--退群----*/
    closedChatPeople: function(th) {
        var chatPeopleNum = $(".chatBoxLower .lowerLeft").children("li").length;
        var count = th.parent("li").index();
        var gagaID = "";
        var closedgagaID = th.parent("li").attr("data-gagaID");
        if (chatPeopleNum == 1) {
            $("#chatBox").hide();
        } else {
            count++;
            if (count == chatPeopleNum) {
                count = count - 2;
            }
            if (th.parent("li").hasClass("chatPeopleChoiced")) {
                $(".chatBoxLower .lowerLeft").children("li:eq(" + count + ")").attr("class", "chatPeopleChoiced");
                gagaID = $(".chatBoxLower .lowerLeft").children("li:eq(" + count + ")").attr("data-gagaID");
            } else {
                gagaID = $(".lowerLeft").children(".chatPeopleChoiced").attr("data-gagaID");
            }
            var remarkname = $(".lowerLeft").children("[data-gagaID = " + gagaID + "]").attr("data-remarkname");

            $(".chatBoxLower .lowerLeft").children("[data-gagaID = " + gagaID + "]").children(".newsNum").hide();
            $("#chatBox .chatHeadHeadIng").attr("src", $(".lowerLeft").children("[data-gagaID = " + gagaID + "]").find(".headImg").attr("src"));
            $("#chatBox .chatRemarkNameIng").attr("data-gagaID", gagaID).text(remarkname);
        }
        th.parent("li").remove();
        $("#chatBox .lowerRight").children("[data-gagaID = " + closedgagaID + "]").remove();
        $("#chatBox .lowerRight").children("[data-gagaID = " + gagaID + "]").show();
        if (gagaID) {
            $("#chatBox .lowerRight").children("[data-gagaID=" + gagaID + "]").children(".chatContent").mCustomScrollbar("scrollTo", "bottom");
        }
        var signID = $(".lowerLeft").children("[data-gagaID = " + gagaID + "]").attr("data-signid");
        /*-------是否已经屏蔽-----*/
        var shield = $(".chatBoxLower .lowerLeft").children("[data-gagaID = " + gagaID + "]").attr("data-shield");
        var Language = $(".chatBoxLower .lowerLeft").children("[data-gagaID = " + gagaID + "]").attr("data-language");
        $.IM.postCurrentChatPeople(gagaID);
        /*---------改变聊天人数----------------*/
        var peopleNum = $("#peopleNum").text();
        peopleNum--;
        $("#peopleNum").text(peopleNum);

        $.IM.clickedPeopleORgroup(signID, gagaID);
        $.IM.shieldState(shield);
        $.IM.resetChatBoxStyles(signID,Language);

    },
    /*----------请求金币数-------*/
    getMoneyNum: function(callback) {
        var that = this;
        $.ajax({
            url: ctx + "/im/getMemberGold",
            // data: data,
            type: 'get',
            cache: false,
            async: false,
            dataType: 'json',
            success: function(reg) {
                //console.log("金额:" + JSON.stringify(reg));
                //console.log("金额:" + reg);
                if (reg.success) {
                    that.myMoneyNum = reg.obj;
                    
                    $("#totalMoney").text(reg.obj);
                    $("#totalMoney").parent().attr("data-explain",reg.obj+ ' ' + $("#totalMoney").parent().attr("data-suffix"));
                    if (callback) {
                        callback(reg.obj);
                    }
                } else {}
            },
            error: function() {}
        });
    },
    /*----------请求翻译字符数-------*/
    getTranslationCharacterNum: function(callback) {
        var that = this;
        $.ajax({
            url: ctx + "/im/getMefiTranslate",
            // data: data,
            type: 'get',
            cache: false,
            async: false,
            dataType: 'json',
            success: function(reg) {
                //console.log("字符数:" + JSON.stringify(reg));
                //console.log("字符数:" + reg);
                if (reg.success) {
                    that.myCharacterNum = reg.obj;
                     $("#totalTranslate").text(reg.obj);
                     $("#totalTranslate").parent().attr("data-explain",reg.obj + ' ' + $("#totalTranslate").parent().attr("data-suffix"));
                    if (callback) {
                        callback(reg.obj);
                    }
                } else {}
            },
            error: function() {}
        });
    },
    /*---------替换QQ表情-----------*/
    replace_em: function (str) {
        if (str) {
            if (str.indexOf('&nbsp;') != -1) {
                str = str.replace(/&nbsp;/g, ' ');
            }  
            str = str.replace(/\</g, '&lt;');
            str = str.replace(/\>/g, '&gt;');
            str = str.replace(/\n/g, '<br/>');
            if (str.indexOf("em_") != -1) {
                str = str.replace(/\[em_([0-9]*)\]/g, '<img src="' + staticCtx + 'img/qqFace/$1.gif" border="0" />');
            }
            if (str.indexOf("[") != -1) {
                var nameArr = str.match(/\[([A-Za-z\u4e00-\u9fa5\s]*)\]/g);
                if (nameArr && nameArr.length) {
                    $.each(nameArr, function (i, n) {
                        if ($.IM.qqOld.emCn.hasOwnProperty(n) || $.IM.qqOld.emEn.hasOwnProperty(n)) {
                            var nameType = $.IM.qqOld.emCn.hasOwnProperty(n) ? 'emCn' : 'emEn';
                            str = str.replace(n, '<img src="' + staticCtx + 'img/qqFace/' + $.IM.qqOld[nameType][n] + '.gif" border="0" />');
                        }
                    });
                }                
            }
        }
        return str;
        
    },
    /*---------删除表情-----------*/
    deleteQQFace: function(str) {
        if (str) {
            if (str.indexOf('&nbsp;') != -1) {
                str = str.replace(/&nbsp;/g, ' ');
            }  
            str = str.replace(/\</g, '&lt;');
            str = str.replace(/\>/g, '&gt;');
            str = str.replace(/\n/g, '<br/>');
            if (str.indexOf("em_") != -1) {
                str = str.replace(/\[em_([0-9]*)\]/g, '');
            }
            if (str.indexOf("[") != -1) {
                var nameArr = str.match(/\[([A-Za-z\u4e00-\u9fa5\s]*)\]/g);
                if (nameArr) {
                    $.each(nameArr, function (i, n) {
                        if ($.IM.qqOld.emCn.hasOwnProperty(n) || $.IM.qqOld.emEn.hasOwnProperty(n)) {
                            var nameType = $.IM.qqOld.emCn.hasOwnProperty(n) ? 'emCn' : 'emEn';
                            str = str.replace(n, '');
                        }
                    });
                }                
            }
        }
        return str;
    },
    /*------------计算表情数-------------------*/
    numQQFace: function(str) {
        if (str) {
            str = str.replace(/\</g, '&lt;');
            str = str.replace(/\>/g, '&gt;');
            str = str.replace(/\n/g, '<br/>');
            str = str.replace(/\[em_([0-9]*)\]/g, '1');
        }
        return str;
    },
    /*字数计算*/
    /* wordCount("#sendContent","#chatConBottom  .characterNum","500")*/
    wordCount: function(input, txt, num) {
        var that = this;
        $(input).keyup(function() {
            var counter = 0;
            var texts = $(input).val();
            if (typeof(texts) != "undefined") {
                counter = texts.length; //获取文本域的字符串长度
            }
            if (txt) {
                texts = that.numQQFace(texts);
                counter = texts.length;
                $(txt).text(counter); 
            }
            if (counter > num) {
                var newtext = texts.substring(0, num);
                $(input).val(newtext);
                if (txt) {
                    $(txt).text(num);
                }

            }
        });
    },    
   /*---------鼠标滑过显示文字提示-----------*/
    txtTipsFun:function(target){
    	$(target).mouseenter(function(e){
               var th = $(this);
               var width = parseInt(th.width());
               var height = parseInt(th.height());
               var left = th.offset().left+width/2-5;
               var top = th.offset().top - $(document).scrollTop() + height;
               var div = '<div class="txtTips" style="top:'+top+'px;left:'+left+'px"><div class="triangle-top"></div><div class="triangle-bg"></div><div class="explainTXT">'+th.attr("data-Explain")+' </div></div>';
               $("body").append(div);
           // console.log(e.type);
        });
        $(target).mouseleave(function(e){
        	 //console.log(e.type);
            $(".txtTips").remove();
        });
         
    },
    conversionLanguage: function(lan) {
        /**
         * 百度语言种类
         * 
         * 中文		zh	英语		en
         * 日语		jp	韩语		kor
         * 西班牙语	spa	法语		fra
         * 泰语		th	阿拉伯语	ara
         * 俄罗斯语	ru	葡萄牙语	pt
         * 粤语		yue	文言文	wyw
         * 白话文		zh	自动检测	auto
         * 德语		de	意大利语	it
         * 荷兰语		nl	希腊语	el
         * 
         * @author xingdongyang
         *
         */

        switch (lan) {
            case "en"://en-us
                return "en";
                break;
            case "cn"://zh-cn
                return "zh";
                break;
            case "tr": //繁体中文 zh-tw
                return "cht";
                break;
            case "ko": //韩文 ko-kr
                return "kor";
                break;
            case "rs": //俄语 ru-ru' Pусский
                return "ru";
                break;
            case "gm": //德语 de-de Deutsch
                return "de";
                break;
            case "sp": //西班牙语 es-es Español
                return "spa";
                break;
            case "jp": //日语 ja-jp
                return "jp";
                break;

        }

    },
    /*IM红包*/
    SendRedPackets: function(gagaID, moneyNum, content, imgUrl, lan, wordsId) {
        var that = this;
        //mn红包数
        var data = {
            toid: gagaID,
            to: lan,
            msg: content,
            image: imgUrl,
            mn: moneyNum,
            uuid: wordsId
        };
        console.log(data);
        $.ajax({
            url: ctx + "/im/sendMsg",
            data: data,
            type: 'post',
            cache: false,
            dataType: 'json',
            success: function(reg) {
                // console.log("发红包:" + JSON.stringify(reg));
                // console.log("发红包:" + reg);
                //var sendDiv = $("#chatMiddle").children("[data-gagaID = " + gagaID+ "]").find("[data-ranid = " + reg.attributes.uuid + "]");
                if (reg.success) {
                    $.IM.getMoneyNum();

                    var wordsId = reg.obj.newsModel.id;
                    var read = reg.obj.isRead;
                    var sendState = reg.success;
                    var getSendTime = $.fn.returnTime(reg.obj.newsModel.ct, "full", "YYYY-MM-DD hh:mm");

                    that.addSendRedMessage(gagaID, moneyNum, content, getSendTime, wordsId, sendState, read);
                } else {
                    if (reg.msg == "1") {
                        $("#chatBox .upgradeTips").show();
                        var OvertimeHide = setTimeout(function() {
                            $("#chatBox .upgradeTips").hide();
                            clearTimeout(OvertimeHide);
                        }, 2000);
                    } else {}
                }
                $("#chatBox .lowerRight").children("[data-gagaid = " + gagaID + "]").find(".chatCon").mCustomScrollbar("update");
                $("#chatBox .lowerRight").children("[data-gagaid = " + gagaID + "]").find(".chatCon").mCustomScrollbar("scrollTo", "bottom");
            },
            error: function() {}
        });

    },
    /*发送红包成功，显示到页面*/
    addSendRedMessage: function(gagaID, moneyNum, content, getSendTime, wordsId, sendState, read ) {
        var that = this;
        var sendTime = TimeDifference2(getSendTime, that.timeArr[gagaID]);
        var sendMessageDiv = "";
        if (sendTime != "") {
            that.timeArr[gagaID] = getSendTime;
            sendMessageDiv += '<p class="chatTime">' + getSendTime.substr(11, 5)+ '</p>';
        }
        sendMessageDiv += '<div class="sendMessage redPacket-box" data-MSGsendID="'+myId+'" data-ranid="' + wordsId + '"><i class="sendHead chatConHead fr"><img class="sendHeadImg " src="' + qiniuImgURL + sendHeadImgUrl + '"></i>' +
            '<div class="sendContainer msgContent fr">';

        //红包框
        sendMessageDiv += '<div class="redPacket-main" data-msg="'+content+'" data-money="'+moneyNum+'" data-open="0"><span class="RedEnvelopeImg"></span><span class="RedEnvelopeWord">'+$.t("Letter.checkred")+'</span></div>';
        
        /*---翻译内容显示框--*/
        sendMessageDiv += '<div class="sendTranslationContainer translationContainer" style="display:none"><p class="sendTranslation translationLan"></p></div>';
        
        //翻译按钮
        sendMessageDiv += '<i class="sendTranslateBtn translateBtn"></i><div class="sendlanChoice lanChoice" style="display:none"><i class="lanI"></i>' + that.languageListStr + '<div class="clear"></div></div>';
        
        sendMessageDiv += '</div>';

        if (sendState) {
            if (read == 0) {
                sendMessageDiv += '<div class="readContainer" style="display:block"><i class="readImg" style="display:none"></i><span class="read">' + $.t("im.noRead") + '</span></div>';
            } else if (read == 1) {
                sendMessageDiv += '<div class="readContainer" style="display:block"><i class="readImg"></i><span class="read">' + $.t("im.read") + '</span></div>';
            } else if (read == -1) {
                sendMessageDiv += '<div class="readContainer" style="display:none"><i class="readImg"></i><span class="read"></span></div>';
            }
        }

        if (!sendState) {
            sendMessageDiv += '<div class="sendFailTip" style="background:url(' + staticCtx + 'img/IMicon.png) 0 -170px no-repeat"></div>';
        }
        sendMessageDiv += '<div class="clear"></div></div>';

        $("#chatBox .lowerRight").children("[data-gagaID = " + gagaID + "]").find(".chatCon").append(sendMessageDiv);
        $("#chatBox .lowerRight").children("[data-gagaID = " + gagaID + "]").children(".chatContent").mCustomScrollbar("update");
        $("#chatBox .lowerRight").children("[data-gagaID = " + gagaID + "]").children(".chatContent").mCustomScrollbar("scrollTo", "bottom");

        /*-------------------排序---------------------------*/
        if ($("#recentlyGroup .FoldContainer").children("[data-gagaID=" + gagaID + "]").html()) {
            var showContentLi = $("#recentlyGroup .FoldContainer").children("[data-gagaID=" + gagaID + "]");
            $("#recentlyGroup .FoldContainer").prepend(showContentLi);
        } else {
            var showContent = "";
            showContent = $("#friendGroup .FoldContainer").children("[data-gagaID=" + gagaID + "]");
            $("#recentlyGroup .FoldContainer").prepend(showContent.clone());
            var peopleNum = $("#recentlyGroup .recentlyNum").text();
            peopleNum++;
            $("#recentlyGroup .recentlyNum").text(peopleNum);
        }

    },
    /*-----------查看红包--------*/
    checkRedEnvelopeClick: function(th) {
        var open = th.attr("data-open");
        var moneyNum = th.attr("data-money");
        var content = th.attr("data-msg");
        var RedEnvelopeOpen = $(".RedEnvelopeOpen");
        
       
        
        RedEnvelopeOpen.find(".name").text(myNickname);
        RedEnvelopeOpen.find(".MoneyCount").text(moneyNum);
        RedEnvelopeOpen.find(".headImg").attr("src", qiniuImgURL + sendHeadImgUrl);
        RedEnvelopeOpen.find(".RedEnvelopeContent").text(content);
        RedEnvelopeOpen.find(".getRedEnvelopeBtn").hide();
        if (open == "1") {
            RedEnvelopeOpen.find(".RedEnvelopeExplain").text($.t("Letter.redStateReceive"));
        } else {
            RedEnvelopeOpen.find(".RedEnvelopeExplain").text($.t("Letter.redStating"));
        }
        RedEnvelopeOpen.show();
         var topH = ($.IM.winH - RedEnvelopeOpen.children(".RedEnvelopeOpenContainer").height())/2
        RedEnvelopeOpen.children(".RedEnvelopeOpenContainer").css("top",topH);
        //console.log("$.IM.winH:"+$.IM.winH+"{}"+"aa"+RedEnvelopeOpen.children(".RedEnvelopeOpenContainer").height())
    },
    /*-------打开红包---------------*/
    openRedEnvelopeClick: function(th, ContactsUl, position) {
        var open = th.attr("data-open");
        var gagaID = ContactsUl.attr("data-gagaID");
        var headimg = ContactsUl.find(".headImg").attr("src");
        var nickname = ContactsUl.attr("data-nickname");
        var RedID = th.closest('.redPacket-box').attr("data-ranid");
        if (position=="historyCon") {
            RedID = th.attr("data-ranid");
        }
        var moneyNum = th.attr("data-money");
        var content = th.attr("data-msg");
        var RedEnvelopeOpen = $(".RedEnvelopeOpen.im");
        RedEnvelopeOpen.find(".name").text(nickname);
        RedEnvelopeOpen.find(".MoneyCount").text(moneyNum);
        RedEnvelopeOpen.find(".headImg").attr("src", headimg);
        RedEnvelopeOpen.find(".RedEnvelopeContent").text(content);
        RedEnvelopeOpen.find(".RedEnvelopeExplain").text($.t("Letter.redExplain"));
        RedEnvelopeOpen.show();
        var topH = ($.IM.winH - RedEnvelopeOpen.children(".RedEnvelopeOpenContainer").height())/2
        RedEnvelopeOpen.children(".RedEnvelopeOpenContainer").css("top",topH);
       // console.log("$.IM.winH:"+$.IM.winH+"{}"+"aa"+RedEnvelopeOpen.children(".RedEnvelopeOpenContainer").height())

        if (open == "1") {
            RedEnvelopeOpen.find(".getRedEnvelopeBtn").css("background-position", "0px -31px").text($.t("Letter.redreceived")).show();
        } else {
            RedEnvelopeOpen.find(".getRedEnvelopeBtn").addClass("openRed").css("background-position", "0px -82px").text($.t("Letter.redGet"));
            RedEnvelopeOpen.undelegate(".openRed", "click").delegate(".openRed", "click", function() {
                $.IM.getRedEnvelope(gagaID, RedID, th, RedEnvelopeOpen, position);
            });
        }
    },
    /*---------领取红包-------*/
    getRedEnvelope: function(gagaID, RedID, th, RedEnvelopeOpen, position) {
        var data = {
            fid: gagaID,
            msgId: RedID
        };
        //console.log("领取红包:"+data);
        $.ajax({
            url: ctx + "/im/openHb",
            data: data,
            type: 'post',
            cache: false,
            dataType: 'json',
            success: function(reg) {
                //console.log("领取红包:" + JSON.stringify(reg));
                //console.log("领取红包:" + reg);
                if (reg.success) {
                    $.IM.getMoneyNum();
                    if (position == "historyCon") {
                        $("#chatBox .chatCon").children("[data-gagaID =" + gagaID + "]").find("[data-ranid =" + RedID + "]").attr("data-open", "1")
                        $("#chatBox .chatCon").children("[data-gagaID =" + gagaID + "]").find("[data-ranid =" + RedID + "]").find(".RedEnvelopeWord").text($.t("Letter.redPacketsReceive"));
                        th.attr("data-open", "1");
                    }
                    th.parent().attr("data-open", "1");
                    th.find(".RedEnvelopeWord").text($.t("Letter.redPacketsReceive"));
                    RedEnvelopeOpen.find(".getRedEnvelopeBtn").css("background-position", "0px -31px").text($.t("Letter.redreceived"));
                    RedEnvelopeOpen.find(".getRedEnvelopeBtn").removeClass("openRed");

                } else {}
            },
            error: function() {}
        });

    }



}
